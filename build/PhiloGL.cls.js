/*

 Copyright (c) 2011 Sencha Inc. - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
(function(){function v(w){return document.getElementById(w)}this.PhiloGL=null;(function(){PhiloGL=function(w,m){function l(a,b,d){b.$$family=="program"&&b.use();var j=a.canvas,n=new PhiloGL.Camera(g.fov,j.width/j.height,g.near,g.far,g);n.update();var s=new PhiloGL.Scene(b,n,i);Y=new PhiloGL.App({gl:a,canvas:j,program:b,scene:s,camera:n});f&&PhiloGL.Events.create(Y,v.extend(f,{bind:Y}));if(h.src.length)new PhiloGL.IO.Textures(b,v.extend(h,{onComplete:function(){d(Y)}}));else d(Y)}m=v.merge({context:{},
camera:{fov:45,near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:v.empty,onError:v.empty},m||{});var k=m.context,g=m.camera,f=m.events,h=m.textures,c=v.splat(m.program),i=m.scene;r=PhiloGL.WebGL.getContext(w,k);if(!r){m.onError();return null}var p={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},o=c.length,u=function(){var a=o,b={},d=false;return{onSuccess:function(j,n){b[n.id||o-a]=
j;a--;if(a==0&&!d)l(r,o==1?j:b,function(s){m.onLoad(s)})},onError:function(){a--;m.onError(m.id);d=true}}}();c.forEach(function(a){var b=a.from,d;for(d in p)if(b==d){program=PhiloGL.Program[p[d]](v.extend(u,a));break}if(program)u.onSuccess(program,a)})}})();PhiloGL.unpack=function(w){w=w||window||global;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx"].forEach(function(m){w[m]=PhiloGL[m]})};PhiloGL.version="1.1.1";var r,Y;v.empty=function(){};
v.time=Date.now||function(){return+new Date};v.uid=function(){var w=v.time();return function(){return w++}}();v.extend=function(w,m){for(var l in m)w[l]=m[l];return w};v.type=function(){var w=Object.prototype.toString;return function(m){var l;l=w.call(m);l=l.substr(8,l.length-9).toLowerCase();if(l!="object")return l;if(m.$$family)return m.$$family;return m&&m.nodeName&&m.nodeType==1?"element":l}}();(function(){function w(m){var l=v.type(m);if(l=="object"){l={};for(var k in m)l[k]=w(m[k]);return l}else if(l==
"array"){l=[];k=0;for(var g=m.length;k<g;k++)l[k]=w(m[k]);return l}else return m}v.merge=function(){for(var m={},l=0,k=arguments.length;l<k;l++){var g=arguments[l];if(v.type(g)=="object")for(var f in g){var h=g[f],c=m[f];m[f]=c&&v.type(h)=="object"&&v.type(c)=="object"?v.merge(c,h):w(h)}}return m}})();v.splat=function(){var w=Array.isArray;return function(m){return w(m)&&m||[m]}}();(function(){function w(m){for(var l in m)this[l]=m[l];this.buffers={};this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo=
{};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}w.prototype={$$family:"application",setBuffer:function(m,l,k){if(k===false||k===null){(k=this.bufferMemo[l])&&r.bindBuffer(k.bufferType,null);var g=k&&k.attribute||l;m=m.attributes[g];m!==undefined&&r.disableVertexAttribArray(m)}else{k=v.merge({bufferType:r.ARRAY_BUFFER,size:1,dataType:r.FLOAT,stride:0,offset:0,drawType:r.STATIC_DRAW},this.bufferMemo[l]||{},k||{});g=k.attribute||l;var f=k.bufferType,h=l in this.buffers,
c=h?this.buffers[l]:r.createBuffer(),i="value"in k,p=k.value,o=k.size,u=k.dataType,a=k.stride,b=k.offset,d=k.drawType;m=m.attributes[g];var j=m!==undefined;h||(this.buffers[l]=c);j&&r.enableVertexAttribArray(m);r.bindBuffer(f,c);i&&r.bufferData(f,p,d);j&&r.vertexAttribPointer(m,o,u,false,a,b);delete k.value;this.bufferMemo[l]=k;if(j)this.bufferMemo[g]=k;return this}},setBuffers:function(m,l){for(var k in l)this.setBuffer(m,k,l[k]);return this},setFrameBuffer:function(m,l){if(typeof l!="object")r.bindFramebuffer(r.FRAMEBUFFER,
l?this.frameBuffers[m]:null);else{l=v.merge({width:0,height:0,bindToTexture:false,textureOptions:{attachment:r.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:r.DEPTH_ATTACHMENT}},this.frameBufferMemo[m]||{},l||{});var k=l.bindToTexture,g=l.bindToRenderBuffer,f=m in this.frameBuffers,h=f?this.frameBuffers[m]:r.createFramebuffer(r.FRAMEBUFFER);r.bindFramebuffer(r.FRAMEBUFFER,h);f||(this.frameBuffers[m]=h);if(k){k=v.merge({data:{width:l.width,height:l.height}},v.type(k)==
"object"?k:{});f=m+"-texture";h=l.textureOptions;this.setTexture(f,k);r.framebufferTexture2D(r.FRAMEBUFFER,h.attachment,this.textureMemo[f].textureType,this.textures[f],0)}if(g){g=v.merge({width:l.width,height:l.height},v.type(g)=="object"?g:{});k=m+"-renderbuffer";f=l.renderBufferOptions;this.setRenderBuffer(k,g);r.framebufferRenderbuffer(r.FRAMEBUFFER,f.attachment,r.RENDERBUFFER,this.renderBuffers[k])}r.bindTexture(r.TEXTURE_2D,null);r.bindRenderbuffer(r.RENDERBUFFER,null);r.bindFramebuffer(r.FRAMEBUFFER,
null);this.frameBufferMemo[m]=l;return this}},setFrameBuffers:function(m){for(var l in m)this.setFrameBuffer(l,m[l]);return this},setRenderBuffer:function(m,l){if(typeof l!="object")r.bindRenderbuffer(r.RENDERBUFFER,l?this.renderBufferMemo[m]:null);else{l=v.merge({storageType:r.DEPTH_COMPONENT16,width:0,height:0},this.renderBufferMemo[m]||{},l||{});var k=m in this.renderBuffers,g=k?this.renderBuffers[m]:r.createRenderbuffer(r.RENDERBUFFER);k||(this.renderBuffers[m]=g);r.bindRenderbuffer(r.RENDERBUFFER,
g);r.renderbufferStorage(r.RENDERBUFFER,l.storageType,l.width,l.height);this.renderBufferMemo[m]=l;return this}},setRenderBuffers:function(m){for(var l in m)this.setRenderBuffer(l,m[l]);return this},setTexture:function(m,l){if(!l||typeof l!="object"){r.activeTexture(l||r.TEXTURE0);r.bindTexture(this.textureMemo[m].textureType||r.TEXTURE_2D,this.textures[m])}else{l=v.merge({textureType:r.TEXTURE_2D,pixelStore:[{name:r.UNPACK_FLIP_Y_WEBGL,value:true}],parameters:[{name:r.TEXTURE_MAG_FILTER,value:r.NEAREST},
{name:r.TEXTURE_MIN_FILTER,value:r.NEAREST}],data:{format:r.RGBA,value:false,width:0,height:0,border:0}},this.textureMemo[m]||{},l||{});var k="textureType"in l?l.textureType:r.TEXTURE_2D,g=m in this.textures,f=g?this.textures[m]:r.createTexture(),h=l.pixelStore,c=l.parameters,i=l.data,p=!!l.data.value;g||(this.textures[m]=f);r.bindTexture(k,f);g||h.forEach(function(o){o.name=typeof o.name=="string"?r[o.name]:o.name;r.pixelStorei(o.name,o.value)});if(p)r.texImage2D(k,0,i.format,i.format,r.UNSIGNED_BYTE,
i.value);else if(i.width||i.height)r.texImage2D(k,0,i.format,i.width,i.height,i.border,i.format,r.UNSIGNED_BYTE,null);g||c.forEach(function(o){o.name=r.get(o.name);o.value=r.get(o.value);r.texParameteri(k,o.name,o.value);o.generateMipmap&&r.generateMipmap(k)});delete l.data;this.textureMemo[m]=l;return this}},setTextures:function(m){for(var l in m)this.setTexture(l,m[l]);return this},use:function(m){r.useProgram(m);this.usedProgram=m;return this}};PhiloGL.App=w})();(function(){var w=Math.sqrt,m=Math.sin,
l=Math.cos,k=Math.tan,g=Math.PI,f=Array.prototype.slice,h=function(a,b,d){this.x=a||0;this.y=b||0;this.z=d||0},c={setVec3:function(a,b){a.x=b.x;a.y=b.y;a.z=b.z;return a},set:function(a,b,d,j){a.x=b;a.y=d;a.z=j;return a},add:function(a,b){return new h(a.x+b.x,a.y+b.y,a.z+b.z)},$add:function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;return a},add2:function(a,b,d){a.x=b.x+d.x;a.y=b.y+d.y;a.z=b.z+d.z;return a},sub:function(a,b){return new h(a.x-b.x,a.y-b.y,a.z-b.z)},$sub:function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;
return a},sub2:function(a,b,d){a.x=b.x-d.x;a.y=b.y-d.y;a.z=b.z-d.z;return a},scale:function(a,b){return new h(a.x*b,a.y*b,a.z*b)},$scale:function(a,b){a.x*=b;a.y*=b;a.z*=b;return a},neg:function(a){return new h(-a.x,-a.y,-a.z)},$neg:function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a},unit:function(a){var b=h.norm(a);if(b>0)return h.scale(a,1/b);return h.clone(a)},$unit:function(a){var b=h.norm(a);if(b>0)return h.$scale(a,1/b);return a},cross:function(a,b){var d=a.x,j=a.y,n=a.z,s=b.x,q=b.y,t=b.z;return new h(j*
t-n*q,n*s-d*t,d*q-j*s)},$cross:function(a,b){var d=a.x,j=a.y,n=a.z,s=b.x,q=b.y,t=b.z;a.x=j*t-n*q;a.y=n*s-d*t;a.z=d*q-j*s;return a},distTo:function(a,b){var d=a.x-b.x,j=a.y-b.y,n=a.z-b.z;return w(d*d,j*j,n*n)},distToSq:function(a,b){var d=a.x-b.x,j=a.y-b.y,n=a.z-b.z;return d*d+j*j+n*n},norm:function(a){var b=a.x,d=a.y;a=a.z;return w(b*b+d*d+a*a)},normSq:function(a){var b=a.x,d=a.y;a=a.z;return b*b+d*d+a*a},dot:function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},clone:function(a){return new h(a.x,a.y,a.z)}},
i=h.prototype={},p;for(p in c){h[p]=c[p];i[p]=function(a){return function(){var b=f.call(arguments);b.unshift(this);return h[a].apply(h,b)}}(p)}var o=function(a,b,d,j,n,s,q,t,x,y,z,E,D,B,C,G){typeof a=="number"?this.set(a,b,d,j,n,s,q,t,x,y,z,E,D,B,C,G):this.id()};c={id:function(a){a.n11=a.n22=a.n33=a.n44=1;a.n12=a.n13=a.n14=0;a.n21=a.n23=a.n24=0;a.n31=a.n32=a.n34=0;a.n41=a.n42=a.n43=0;return a},set:function(a,b,d,j,n,s,q,t,x,y,z,E,D,B,C,G,H){a.n11=b;a.n12=d;a.n13=j;a.n14=n;a.n21=s;a.n22=q;a.n23=t;
a.n24=x;a.n31=y;a.n32=z;a.n33=E;a.n34=D;a.n41=B;a.n42=C;a.n43=G;a.n44=H;return a},mulVec3:function(a,b){var d=b.x,j=b.y,n=b.z;return new h(a.n11*d+a.n12*j+a.n13*n+a.n14,a.n21*d+a.n22*j+a.n23*n+a.n24,a.n31*d+a.n32*j+a.n33*n+a.n34)},$mulVec3:function(a,b){var d=b.x,j=b.y,n=b.z;b.x=a.n11*d+a.n12*j+a.n13*n+a.n14;b.y=a.n21*d+a.n22*j+a.n23*n+a.n24;b.z=a.n31*d+a.n32*j+a.n33*n+a.n34;return b},mulMat42:function(a,b,d){var j=b.n11,n=b.n12,s=b.n13,q=b.n14,t=b.n21,x=b.n22,y=b.n23,z=b.n24,E=b.n31,D=b.n32,B=b.n33,
C=b.n34,G=b.n41,H=b.n42,F=b.n43;b=b.n44;var I=d.n11,J=d.n12,K=d.n13,R=d.n14,O=d.n21,L=d.n22,M=d.n23,N=d.n24,S=d.n31,P=d.n32,Q=d.n33,A=d.n34,T=d.n41,W=d.n42,V=d.n43;d=d.n44;a.n11=j*I+n*O+s*S+q*T;a.n12=j*J+n*L+s*P+q*W;a.n13=j*K+n*M+s*Q+q*V;a.n14=j*R+n*N+s*A+q*d;a.n21=t*I+x*O+y*S+z*T;a.n22=t*J+x*L+y*P+z*W;a.n23=t*K+x*M+y*Q+z*V;a.n24=t*R+x*N+y*A+z*d;a.n31=E*I+D*O+B*S+C*T;a.n32=E*J+D*L+B*P+C*W;a.n33=E*K+D*M+B*Q+C*V;a.n34=E*R+D*N+B*A+C*d;a.n41=G*I+H*O+F*S+b*T;a.n42=G*J+H*L+F*P+b*W;a.n43=G*K+H*M+F*Q+b*V;
a.n44=G*R+H*N+F*A+b*d;return a},mulMat4:function(a,b){var d=a.n11,j=a.n12,n=a.n13,s=a.n14,q=a.n21,t=a.n22,x=a.n23,y=a.n24,z=a.n31,E=a.n32,D=a.n33,B=a.n34,C=a.n41,G=a.n42,H=a.n43,F=a.n44,I=b.n11,J=b.n12,K=b.n13,R=b.n14,O=b.n21,L=b.n22,M=b.n23,N=b.n24,S=b.n31,P=b.n32,Q=b.n33,A=b.n34,T=b.n41,W=b.n42,V=b.n43,X=b.n44,U=new o;U.n11=d*I+j*O+n*S+s*T;U.n12=d*J+j*L+n*P+s*W;U.n13=d*K+j*M+n*Q+s*V;U.n14=d*R+j*N+n*A+s*X;U.n21=q*I+t*O+x*S+y*T;U.n22=q*J+t*L+x*P+y*W;U.n23=q*K+t*M+x*Q+y*V;U.n24=q*R+t*N+x*A+y*X;U.n31=
z*I+E*O+D*S+B*T;U.n32=z*J+E*L+D*P+B*W;U.n33=z*K+E*M+D*Q+B*V;U.n34=z*R+E*N+D*A+B*X;U.n41=C*I+G*O+H*S+F*T;U.n42=C*J+G*L+H*P+F*W;U.n43=C*K+G*M+H*Q+F*V;U.n44=C*R+G*N+H*A+F*X;return U},$mulMat4:function(a,b){var d=a.n11,j=a.n12,n=a.n13,s=a.n14,q=a.n21,t=a.n22,x=a.n23,y=a.n24,z=a.n31,E=a.n32,D=a.n33,B=a.n34,C=a.n41,G=a.n42,H=a.n43,F=a.n44,I=b.n11,J=b.n12,K=b.n13,R=b.n14,O=b.n21,L=b.n22,M=b.n23,N=b.n24,S=b.n31,P=b.n32,Q=b.n33,A=b.n34,T=b.n41,W=b.n42,V=b.n43,X=b.n44;a.n11=d*I+j*O+n*S+s*T;a.n12=d*J+j*L+n*
P+s*W;a.n13=d*K+j*M+n*Q+s*V;a.n14=d*R+j*N+n*A+s*X;a.n21=q*I+t*O+x*S+y*T;a.n22=q*J+t*L+x*P+y*W;a.n23=q*K+t*M+x*Q+y*V;a.n24=q*R+t*N+x*A+y*X;a.n31=z*I+E*O+D*S+B*T;a.n32=z*J+E*L+D*P+B*W;a.n33=z*K+E*M+D*Q+B*V;a.n34=z*R+E*N+D*A+B*X;a.n41=C*I+G*O+H*S+F*T;a.n42=C*J+G*L+H*P+F*W;a.n43=C*K+G*M+H*Q+F*V;a.n44=C*R+G*N+H*A+F*X;return a},add:function(a,b){var d=new o;d.n11=a.n11+b.n11;d.n12=a.n12+b.n12;d.n13=a.n13+b.n13;d.n14=a.n14+b.n14;d.n21=a.n21+b.n21;d.n22=a.n22+b.n22;d.n23=a.n23+b.n23;d.n24=a.n24+b.n24;d.n31=
a.n31+b.n31;d.n32=a.n32+b.n32;d.n33=a.n33+b.n33;d.n34=a.n34+b.n34;d.n41=a.n41+b.n41;d.n42=a.n42+b.n42;d.n43=a.n43+b.n43;d.n44=a.n44+b.n44;return d},$add:function(a,b){a.n11+=b.n11;a.n12+=b.n12;a.n13+=b.n13;a.n14+=b.n14;a.n21+=b.n21;a.n22+=b.n22;a.n23+=b.n23;a.n24+=b.n24;a.n31+=b.n31;a.n32+=b.n32;a.n33+=b.n33;a.n34+=b.n34;a.n41+=b.n41;a.n42+=b.n42;a.n43+=b.n43;a.n44+=b.n44;return a},transpose:function(a){return new o(a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,
a.n34,a.n44)},$transpose:function(a){return o.set(a,a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44)},rotateAxis:function(a,b,d){var j=m(b);b=l(b);var n=1-b,s=d.x,q=d.y;d=d.z;j=new o(s*s*n+b,s*q*n-d*j,s*d*n+q*j,0,q*s*n+d*j,q*q*n+b,q*d*n-s*j,0,s*d*n-q*j,q*d*n+s*j,d*d*n+b,0,0,0,0,1);return o.mulMat4(a,j)},$rotateAxis:function(a,b,d){var j=m(b);b=l(b);var n=1-b,s=d.x,q=d.y;d=d.z;j=new o(s*s*n+b,s*q*n-d*j,s*d*n+q*j,0,q*s*n+d*j,q*q*n+b,q*d*n-s*j,0,s*d*n-
q*j,q*d*n+s*j,d*d*n+b,0,0,0,0,1);return o.$mulMat4(a,j)},rotateXYZ:function(a,b,d,j){b=new o(l(d)*l(j),-l(b)*m(j)+m(b)*m(d)*l(j),m(b)*m(j)+l(b)*m(d)*l(j),0,l(d)*m(j),l(b)*l(j)+m(b)*m(d)*m(j),-m(b)*l(j)+l(b)*m(d)*m(j),0,-m(d),m(b)*l(d),l(b)*l(d),0,0,0,0,1);return o.mulMat4(a,b)},$rotateXYZ:function(a,b,d,j){b=new o(l(d)*l(j),-l(b)*m(j)+m(b)*m(d)*l(j),m(b)*m(j)+l(b)*m(d)*l(j),0,l(d)*m(j),l(b)*l(j)+m(b)*m(d)*m(j),-m(b)*l(j)+l(b)*m(d)*m(j),0,-m(d),m(b)*l(d),l(b)*l(d),0,0,0,0,1);return o.$mulMat4(a,b)},
translate:function(a,b,d,j){b=new o(1,0,0,b,0,1,0,d,0,0,1,j,0,0,0,1);return o.mulMat4(a,b)},$translate:function(a,b,d,j){b=new o(1,0,0,b,0,1,0,d,0,0,1,j,0,0,0,1);return o.$mulMat4(a,b)},scale:function(a,b,d,j){b=new o(b,0,0,0,0,d,0,0,0,0,j,0,0,0,0,1);return o.mulMat4(a,b)},$scale:function(a,b,d,j){b=new o(b,0,0,0,0,d,0,0,0,0,j,0,0,0,0,1);return o.$mulMat4(a,b)},invert:function(a){var b=new o,d=a.n11,j=a.n12,n=a.n13,s=a.n14,q=a.n21,t=a.n22,x=a.n23,y=a.n24,z=a.n31,E=a.n32,D=a.n33,B=a.n34,C=a.n41,G=
a.n42,H=a.n43;a=a.n44;var F=d*t-j*q,I=d*x-n*q,J=d*y-s*q,K=j*x-n*t,R=j*y-s*t,O=n*y-s*x,L=z*G-E*C,M=z*H-D*C,N=z*a-B*C,S=E*H-D*G,P=E*a-B*G,Q=D*a-B*H,A=1/(F*Q-I*P+J*S+K*N-R*M+O*L);b.n11=(+t*Q-x*P+y*S)*A;b.n12=(-j*Q+n*P-s*S)*A;b.n13=(+G*O-H*R+a*K)*A;b.n14=(-E*O+D*R-B*K)*A;b.n21=(-q*Q+x*N-y*M)*A;b.n22=(+d*Q-n*N+s*M)*A;b.n23=(-C*O+H*J-a*I)*A;b.n24=(+z*O-D*J+B*I)*A;b.n31=(+q*P-t*N+y*L)*A;b.n32=(-d*P+j*N-s*L)*A;b.n33=(+C*R-G*J+a*F)*A;b.n34=(-z*R+E*J-B*F)*A;b.n41=(-q*S+t*M-x*L)*A;b.n42=(+d*S-j*M+n*L)*A;b.n43=
(-C*K+G*I-H*F)*A;b.n44=(+z*K-E*I+D*F)*A;return b},$invert:function(a){var b=a.n11,d=a.n12,j=a.n13,n=a.n14,s=a.n21,q=a.n22,t=a.n23,x=a.n24,y=a.n31,z=a.n32,E=a.n33,D=a.n34,B=a.n41,C=a.n42,G=a.n43,H=a.n44,F=b*q-d*s,I=b*t-j*s,J=b*x-n*s,K=d*t-j*q,R=d*x-n*q,O=j*x-n*t,L=y*C-z*B,M=y*G-E*B,N=y*H-D*B,S=z*G-E*C,P=z*H-D*C,Q=E*H-D*G,A=1/(F*Q-I*P+J*S+K*N-R*M+O*L);a.n11=(+q*Q-t*P+x*S)*A;a.n12=(-d*Q+j*P-n*S)*A;a.n13=(+C*O-G*R+H*K)*A;a.n14=(-z*O+E*R-D*K)*A;a.n21=(-s*Q+t*N-x*M)*A;a.n22=(+b*Q-j*N+n*M)*A;a.n23=(-B*O+
G*J-H*I)*A;a.n24=(+y*O-E*J+D*I)*A;a.n31=(+s*P-q*N+x*L)*A;a.n32=(-b*P+d*N-n*L)*A;a.n33=(+B*R-C*J+H*F)*A;a.n34=(-y*R+z*J-D*F)*A;a.n41=(-s*S+q*M-t*L)*A;a.n42=(+b*S-d*M+j*L)*A;a.n43=(-B*K+C*I-G*F)*A;a.n44=(+y*K-z*I+E*F)*A;return a},lookAt:function(a,b,d,j){d=h.sub(b,d);d.$unit();j=h.cross(j,d);j.$unit();var n=h.cross(d,j);n.$unit();return o.set(a,j.x,j.y,j.z,-j.dot(b),n.x,n.y,n.z,-n.dot(b),d.x,d.y,d.z,-d.dot(b),0,0,0,1)},frustum:function(a,b,d,j,n,s,q){return o.set(a,2*s/(d-b),0,(d+b)/(d-b),0,0,2*s/(n-
j),(n+j)/(n-j),0,0,0,-(q+s)/(q-s),-2*q*s/(q-s),0,0,-1,0)},perspective:function(a,b,d,j,n){b=j*k(b*g/360);var s=-b;return o.frustum(a,s*d,b*d,s,b,j,n)},ortho:function(a,b,d,j,n,s,q){var t=d-b,x=n-j,y=q-s;return o.set(a,2/t,0,0,-((d+b)/t),0,2/x,0,-((n+j)/x),0,0,-2/y,-((q+s)/y),0,0,0,1)},toFloat32Array:function(a){return new Float32Array([a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44])}};i=o.prototype={};for(p in c){o[p]=c[p];i[p]=function(a){return function(){var b=
f.call(arguments);b.unshift(this);return o[a].apply(o,b)}}(p)}var u=function(a,b,d,j){this.x=a||0;this.y=b||0;this.z=d||0;this.w=j||0};c={setQuat:function(a,b){a.x=b.x;a.y=b.y;a.z=b.z;a.w=b.w;return a},set:function(a,b,d,j,n){a.x=b||0;a.y=d||0;a.z=j||0;a.w=n||0;return a},clone:function(a){return new u(a.x,a.y,a.z,a.w)},neg:function(a){return new u(-a.x,-a.y,-a.z,-a.w)},$neg:function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;a.w=-a.w;return a},add:function(a,b){return new u(a.x+b.x,a.y+b.y,a.z+b.z,a.w+b.w)},$add:function(a,
b){a.x+=b.x;a.y+=b.y;a.z+=b.z;a.w+=b.w;return a},sub:function(a,b){return new u(a.x-b.x,a.y-b.y,a.z-b.z,a.w-b.w)},$sub:function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;a.w-=b.w;return a},scale:function(a,b){return new u(a.x*b,a.y*b,a.z*b,a.w*b)},$scale:function(a,b){a.x*=b;a.y*=b;a.z*=b;a.w*=b;return a},mulQuat:function(a,b){var d=a.x,j=a.y,n=a.z,s=a.w,q=b.x,t=b.y,x=b.z,y=b.w;return new u(s*q+d*y+j*x-n*t,s*t+j*y+n*q-d*x,s*x+n*y+d*t-j*q,s*y-d*q-j*t-n*x)},$mulQuat:function(a,b){var d=a.x,j=a.y,n=a.z,s=a.w,
q=b.x,t=b.y,x=b.z,y=b.w;a.a=s*q+d*y+j*x-n*t;a.b=s*t+j*y+n*q-d*x;a.c=s*x+n*y+d*t-j*q;a.d=s*y-d*q-j*t-n*x;return a},divQuat:function(a,b){var d=a.x,j=a.y,n=a.z,s=a.w,q=b.x,t=b.y,x=b.z,y=b.w,z=1/(y*y+q*q+t*t+x*x);return new u((d*y-s*q-j*x+n*t)*z,(d*x-s*t+j*y-n*q)*z,(j*q+n*y-s*x-d*t)*z,(s*y+d*q+j*t+n*x)*z)},$divQuat:function(a,b){var d=a.x,j=a.y,n=a.z,s=a.w,q=b.x,t=b.y,x=b.z,y=b.w,z=1/(y*y+q*q+t*t+x*x);a.a=(d*y-s*q-j*x+n*t)*z;a.b=(d*x-s*t+j*y-n*q)*z;a.c=(j*q+n*y-s*x-d*t)*z;a.d=(s*y+d*q+j*t+n*x)*z;return a},
invert:function(a){var b=a.x,d=a.y,j=a.z;a=a.w;var n=1/(b*b+d*d+j*j+a*a);return new u(-b*n,-d*n,-j*n,a*n)},$invert:function(a){var b=a.x,d=a.y,j=a.z,n=a.w,s=1/(b*b+d*d+j*j+n*n);a.a=-b*s;a.b=-d*s;a.c=-j*s;a.d=n*s;return a},norm:function(a){var b=a.x,d=a.y,j=a.z;a=a.w;return w(b*b+d*d+j*j+a*a)},normSq:function(a){var b=a.x,d=a.y,j=a.z;a=a.w;return b*b+d*d+j*j+a*a},unit:function(a){return u.scale(a,1/u.norm(a))},$unit:function(a){return u.$scale(a,1/u.norm(a))},conjugate:function(a){return new u(-a.x,
-a.y,-a.z,a.w)},$conjugate:function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a}};i=u.prototype={};for(p in c){u[p]=c[p];i[p]=function(a){return function(){var b=f.call(arguments);b.unshift(this);return u[a].apply(u,b)}}(p)}h.fromQuat=function(a){return new h(a.x,a.y,a.z)};u.fromVec3=function(a,b){return new u(a.x,a.y,a.z,b||0)};u.fromMat4=function(a){var b,d,j;if(a.n11>a.n22&&a.n11>a.n33){b=0;d=1;j=2}else if(a.n22>a.n11&&a.n22>a.n33){b=1;d=2;j=0}else{b=2;d=0;j=1}var n=w(1+a["n"+b+""+b]-a["n"+d+""+d]-
a["n"+j+""+j]),s=new u,q=["x","y","z"];s[q[b]]=0.5*n;s[q[d]]=0.5*(a["n"+d+""+b]+a["n"+b+""+d])/n;s[q[j]]=0.5*(a["n"+b+""+j]+a["n"+j+""+b])/n;s.w=0.5*(a["n"+d+""+j]-a["n"+j+""+d])/n;return s};u.fromXRotation=function(a){return new u(m(a/2),0,0,l(a/2))};u.fromYRotation=function(a){return new u(0,m(a/2),0,l(a/2))};u.fromZRotation=function(a){return new u(0,0,m(a/2),l(a/2))};u.fromAxisRotation=function(a,b){var d=a.x,j=a.y,n=a.z,s=1/w(d*d+j*j+n*n),q=m(b/2),t=l(b/2);return new u(q*d*s,q*j*s,q*n*s,t)};
o.fromQuat=function(a){var b=a.w,d=a.x,j=a.y;a=a.z;return new o(b*b+d*d-j*j-a*a,2*d*j-2*b*a,2*d*a+2*b*j,0,2*d*j+2*b*a,b*b-d*d+j*j-a*a,2*j*a-2*b*d,0,2*d*a-2*b*j,2*j*a+2*b*d,b*b-d*d-j*j+a*a,0,0,0,0,1)};PhiloGL.Vec3=h;PhiloGL.Mat4=o;PhiloGL.Quat=u})();(function(){function w(f){return f!==true?f:false}var m=function(f){var h=function(c){for(var i={x:0,y:0};c&&!/^(?:body|html)$/i.test(c.tagName);){i.x+=c.offsetLeft;i.y+=c.offsetTop;c=c.offsetParent}return i}(f);f=function(c){for(var i={x:0,y:0};c&&!/^(?:body|html)$/i.test(c.tagName);){i.x+=
c.scrollLeft;i.y+=c.scrollTop;c=c.parentNode}return i}(f);return{x:h.x-f.x,y:h.y-f.y}},l={get:function(f,h){return f||(h||window).event},getWheel:function(f){return f.wheelDelta?f.wheelDelta/120:-(f.detail||0)/3},getKey:function(f){var h=f.which||f.keyCode,c;a:{c=g.Keys;for(var i in c)if(c[i]==h){c=i;break a}c=void 0}i=h-111;if(i>0&&i<13)c="f"+i;c=c||String.fromCharCode(h).toLowerCase();return{code:h,key:c,shift:f.shiftKey,control:f.ctrlKey,alt:f.altKey,meta:f.metaKey}},isRightClick:function(f){return f.which==
3||f.button==2},getPos:function(f,h){h=h||window;f=f||h.event;var c=h.document;c=c.documentElement||c.body;if(f.touches&&f.touches.length)f=f.touches[0];return{x:f.pageX||f.clientX+c.scrollLeft,y:f.pageY||f.clientY+c.scrollTop}},stop:function(f){f.stopPropagation&&f.stopPropagation();f.cancelBubble=true;if(f.preventDefault)f.preventDefault();else f.returnValue=false}},k=function(f,h){var c=f.canvas;this.scene=f.scene;this.domElem=c;this.pos=m(c);this.opt=this.callbacks=h;this.size={width:c.width||
c.offsetWidth,height:c.height||c.offsetHeight};this.attachEvents()};k.prototype={hovered:false,pressed:false,touched:false,touchMoved:false,moved:false,attachEvents:function(){var f=this.domElem,h=this;if(this.opt.disableContextMenu)f.oncontextmenu=function(){return false};["mouseup","mousedown","mousemove","mouseover","mouseout","touchstart","touchmove","touchend"].forEach(function(i){f.addEventListener(i,function(p,o){h[i](h.eventInfo(i,p,o))},false)});["keydown","keyup"].forEach(function(i){document.addEventListener(i,
function(p,o){h[i](h.eventInfo(i,p,o))},false)});var c="";c=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";f.addEventListener(c,function(i,p){h.mousewheel(h.eventInfo("mousewheel",i,p))},false)},eventInfo:function(f,h,c){var i=this.domElem,p=this.scene,o=this.opt,u=this.getSize(),a=o.relative,b=o.centerOrigin,d=o.cachePosition&&this.pos||m(i),j=l.get(h,c),n=l.getPos(h,c);h={};c=n.x;i=n.y;if(a){c-=d.x;i-=d.y;if(b){c-=u.width/2;i-=u.height/2;i*=-1}}switch(f){case "mousewheel":h.wheel=
l.getWheel(j);break;case "keydown":v.extend(h,l.getKey(j));break;case "mouseup":h.isRightClick=l.isRightClick(j)}var s;v.extend(h,{x:c,y:i,cache:false,stop:function(){l.stop(j)},getTarget:function(){if(s)return s;return s=!o.picking||p.pick(n.x-d.x,n.y-d.y)||true}});h.event=j;return h},getSize:function(){if(this.cacheSize)return this.size;var f=this.domElem;return{width:f.width||f.offsetWidth,height:f.height||f.offsetHeight}},mouseup:function(f){if(!this.moved)if(f.isRightClick)this.callbacks.onRightClick(f,
this.hovered);else this.callbacks.onClick(f,w(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(f,w(this.pressed));else this.callbacks.onDragCancel(f,w(this.pressed));this.pressed=this.moved=false}},mouseout:function(f){for(var h=f.relatedTarget,c=this.domElem;h&&h.parentNode;){if(c==h.parentNode)return;h=h.parentNode}if(this.hovered){this.callbacks.onMouseLeave(f,this.hovered);this.hovered=false}},mouseover:function(){},mousemove:function(f){if(this.pressed){this.moved=true;
this.callbacks.onDragMove(f,w(this.pressed))}else if(this.hovered){var h=w(f.getTarget());if(this.hovered!=h){this.callbacks.onMouseLeave(f,this.hovered);if(this.hovered=h)this.callbacks.onMouseEnter(f,this.hovered)}else this.callbacks.onMouseMove(f,this.hovered)}else if(this.hovered=w(f.getTarget()))this.callbacks.onMouseEnter(f,this.hovered)},mousewheel:function(f){this.callbacks.onMouseWheel(f)},mousedown:function(f){this.pressed=f.getTarget();this.callbacks.onDragStart(f,w(this.pressed))},touchstart:function(f){this.touched=
f.getTarget();this.callbacks.onTouchStart(f,w(this.touched))},touchmove:function(f){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(f,w(this.touched))}},touchend:function(f){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(f,w(this.touched));else this.callbacks.onTouchCancel(f,w(this.touched));this.touched=this.touchMoved=false}},keydown:function(f){this.callbacks.onKeyDown(f)},keyup:function(f){this.callbacks.onKeyUp(f)}};var g={};g.create=function(f,h){h=v.merge({cachePosition:true,
cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,onClick:v.empty,onRightClick:v.empty,onDragStart:v.empty,onDragMove:v.empty,onDragEnd:v.empty,onDragCancel:v.empty,onTouchStart:v.empty,onTouchMove:v.empty,onTouchEnd:v.empty,onTouchCancel:v.empty,onMouseMove:v.empty,onMouseEnter:v.empty,onMouseLeave:v.empty,onMouseWheel:v.empty,onKeyDown:v.empty,onKeyUp:v.empty},h||{});var c=h.bind;if(c)for(var i in h)i.match(/^on[a-zA-Z0-9]+$/)&&function(p,o){h[p]=function(){return o.apply(c,
Array.prototype.slice.call(arguments))}}(i,h[i]);new k(f,h)};g.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};PhiloGL.Events=g})();(function(){function w(){return arguments.length==2?{vs:arguments[0],fs:arguments[1]}:arguments[0]||{}}var m=function(g,f,h){var c=g.createShader(h);if(c==null)throw"Error creating the shader with shader type: "+h;g.shaderSource(c,f);g.compileShader(c);if(!g.getShaderParameter(c,g.COMPILE_STATUS)){f=g.getShaderInfoLog(c);g.deleteShader(c);
throw"Error while compiling the shader "+f;}return c},l=function(g,f,h){var c=r.getUniformLocation(g,f.name);g=f.type;if(f.size>1&&h)switch(g){case r.FLOAT:return function(i){r.uniform1fv(c,new Float32Array(i))};case r.INT:case r.BOOL:return function(i){r.uniform1iv(c,new Uint16Array(i))}}switch(g){case r.FLOAT:return function(i){r.uniform1f(c,i)};case r.FLOAT_VEC2:return function(i){r.uniform2fv(c,new Float32Array(i))};case r.FLOAT_VEC3:return function(i){r.uniform3fv(c,new Float32Array(i))};case r.FLOAT_VEC4:return function(i){r.uniform4fv(c,
new Float32Array(i))};case r.INT:case r.BOOL:case r.SAMPLER_2D:case r.SAMPLER_CUBE:return function(i){r.uniform1i(c,i)};case r.INT_VEC2:case r.BOOL_VEC2:return function(i){r.uniform2iv(c,new Uint16Array(i))};case r.INT_VEC3:case r.BOOL_VEC3:return function(i){r.uniform3iv(c,new Uint16Array(i))};case r.INT_VEC4:case r.BOOL_VEC4:return function(i){r.uniform4iv(c,new Uint16Array(i))};case r.FLOAT_MAT2:return function(i){r.uniformMatrix2fv(c,false,i.toFloat32Array())};case r.FLOAT_MAT3:return function(i){r.uniformMatrix3fv(c,
false,i.toFloat32Array())};case r.FLOAT_MAT4:return function(i){r.uniformMatrix4fv(c,false,i.toFloat32Array())}}throw"Unknown type: "+g;},k=function(g,f){var h=r,c=h.createProgram();h.attachShader(c,m(h,g,h.VERTEX_SHADER));h.attachShader(c,m(h,f,h.FRAGMENT_SHADER));h.linkProgram(c);if(!h.getProgramParameter(c,h.LINK_STATUS))throw"Error linking the shader: "+h.getProgramInfoLog(c);if(!c)return false;h={};for(var i={},p=r.getProgramParameter(c,r.ACTIVE_ATTRIBUTES),o=0;o<p;o++){var u=r.getActiveAttrib(c,
o),a=u.name;u=r.getAttribLocation(c,u.name);h[a]=u}p=r.getProgramParameter(c,r.ACTIVE_UNIFORMS);for(o=0;o<p;o++){u=r.getActiveUniform(c,o);a=u.name;a=a[a.length-1]=="]"?a.substr(0,a.length-3):a;i[a]=l(c,u,u.name!=a)}this.program=c;this.attributes=h;this.uniforms=i};k.prototype={$$family:"program",setUniform:function(g,f){if(this.uniforms[g])this.uniforms[g](f);return this},setUniforms:function(g){for(var f in g)this.setUniform(f,g[f]);return this}};["setBuffer","setBuffers","use"].forEach(function(g){k.prototype[g]=
function(){var f=Array.prototype.slice.call(arguments);f.unshift(this);return Y[g].apply(Y,f)}});["setFrameBuffer","setFrameBuffers","setRenderBuffer","setRenderBuffers","setTexture","setTextures"].forEach(function(g){k.prototype[g]=function(){return Y[g].apply(Y,arguments)}});k.fromShaderIds=function(){var g=w.apply({},arguments),f=v(g.vs);g=v(g.fs);return new k(f.innerHTML,g.innerHTML)};k.fromShaderSources=function(g){g=w.apply({},arguments);return new k(g.vs,g.fs)};k.fromDefaultShaders=function(){var g=
w.apply({},arguments),f=PhiloGL.Shaders;return PhiloGL.Program.fromShaderSources(f.Vertex[g.vs||"Default"],f.Fragment[g.fs||"Default"])};k.fromShaderURIs=function(g){g=v.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:v.empty,onError:v.empty},g||{});var f=g.path+g.fs,h=PhiloGL.IO.XHR;(new h({url:g.path+g.vs,noCache:g.noCache,onError:function(c){g.onError(c)},onSuccess:function(c){(new h({url:f,noCache:g.noCache,onError:function(i){g.onError(i)},onSuccess:function(i){g.onSuccess(k.fromShaderSources(c,
i),g)}})).send()}})).send()};PhiloGL.Program=k})();(function(){var w={},m=function(g){this.opt=g=v.merge({url:"http://sencha.com/",method:"GET",async:true,noCache:false,sendAsBinary:false,onProgress:v.empty,onSuccess:v.empty,onError:v.empty,onAbort:v.empty,onComplete:v.empty},g||{});this.initXHR()};m.State={};["UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(g,f){m.State[g]=f});m.prototype={initXHR:function(){var g=this.req=new XMLHttpRequest,f=this;["Progress","Error",
"Abort","Load"].forEach(function(h){g.addEventListener(h.toLowerCase(),function(c){f["handle"+h](c)},false)})},send:function(g){var f=this.req,h=this.opt,c=h.async;if(h.noCache)h.url+=(h.url.indexOf("?")>=0?"&":"?")+v.uid();f.open(h.method,h.url,c);if(c)f.onreadystatechange=function(){if(f.readyState==m.State.COMPLETED)if(f.status==200)h.onSuccess(f.responseText);else h.onError(f.status)};h.sendAsBinary?f.sendAsBinary(g||h.body||null):f.send(g||h.body||null);if(!c)if(f.status==200)h.onSuccess(f.responseText);
else h.onError(f.status)},setRequestHeader:function(g,f){this.req.setRequestHeader(g,f);return this},handleProgress:function(g){if(g.lengthComputable)this.opt.onProgress(g,Math.round(g.loaded/g.total*100));else this.opt.onProgress(g,-1)},handleError:function(g){this.opt.onError(g)},handleAbort:function(){this.opt.onAbort(e)},handleLoad:function(g){this.opt.onComplete(g)}};var l=function(g){g=v.merge({url:"http://sencha.com/",data:{},noCache:false,onComplete:v.empty,callbackKey:"callback"},g||{});
var f=l.counter++,h=[],c;for(c in g.data)h.push(c+"="+g.data[c]);h=h.join("&");if(g.noCache)h+=(h.indexOf("?")>=0?"&":"?")+v.uid();h=g.url+(g.url.indexOf("?")>-1?"&":"?")+g.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+f+(h.length>0?"&"+h:"");var i=document.createElement("script");i.type="text/javascript";i.src=h;l.requests["request_"+f]=function(p){g.onComplete(p);i.parentNode&&i.parentNode.removeChild(i);i.clearAttributes&&i.clearAttributes()};document.getElementsByTagName("head")[0].appendChild(i)};
l.counter=0;l.requests={};var k=function(g){g=v.merge({src:[],noCache:false,onProgress:v.empty,onComplete:v.empty},g||{});var f=0,h=g.src.length,c=function(){g.onProgress(Math.round(++f/h*100));if(f==h)g.onComplete(u)},i=function(){if(++f==h)g.onComplete(u)},p=g.noCache,o=v.uid(),u=g.src.map(function(a,b){var d=new Image;d.index=b;d.onload=c;d.onerror=i;d.src=a+(p?(a.indexOf("?")>=0?"&":"?")+o:"");return d});return u};w.XHR=m;w.JSONP=l;w.Images=k;w.Textures=function(g,f){f=v.merge({src:[],noCache:false,
onComplete:v.empty},f||{});k({src:f.src,noCache:f.noCache,onComplete:function(h){var c={};h.forEach(function(p,o){c[f.src[o]]=v.merge({data:{value:p}},f)});if(v.type(g)=="object")for(var i in g)g[i].setTextures(c);else g.setTextures(c);f.onComplete()}})};PhiloGL.IO=w})();(function(){var w=PhiloGL.Vec3,m=PhiloGL.Mat4,l=function(k,g,f,h,c){c=c||{};var i=c.position,p=c.target;c=c.up;this.near=f;this.far=h;this.position=i&&new w(i.x,i.y,i.z)||new w;this.target=p&&new w(p.x,p.y,p.z)||new w;this.up=c&&
new w(c.x,c.y,c.z)||new w(0,1,0);this.projection=(new m).perspective(k,g,f,h);this.modelView=new m};l.prototype={update:function(){this.modelView.lookAt(this.position,this.target,this.up)}};PhiloGL.Camera=l})();(function(){(function(){try{var w=document.createElement("canvas");PhiloGL.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(w.getContext("webgl")||w.getContext("experimental-webgl")))}}catch(m){PhiloGL.hasWebGL=function(){return false}}})();PhiloGL.WebGL={getContext:function(w,m){w=
typeof w=="string"?v(w):w;var l;(l=w.getContext("experimental-webgl",m))||(l=w.getContext("webgl",m));if(l&&m&&m.debug){r={};for(var k in l){var g=l[k];r[k]=typeof g=="function"?function(f,h){return function(){console.log(f,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var c=h.apply(l,arguments)}catch(i){throw f+" "+i;}for(var p=[],o;(o=l.getError())!==l.NO_ERROR;)p.push(o);if(p.length)throw p.join();return c}}(k,g):g}}else r=l;if(r)r.get=function(f){return typeof f==
"string"?r[f]:f};return r}}})();(function(){var w=PhiloGL.Vec3,m=PhiloGL.Mat4,l=Math.cos,k=Math.sin,g=Math.PI,f=function(c){if(c&&c.length&&v.type(c[0])=="array")return[].concat.apply([],c);return c},h={};h.Model=function(c){this.id=c.id||v.uid();this.pickable=!!c.pickable;this.vertices=f(c.vertices);this.faces=f(c.faces);this.normals=f(c.normals);this.textures=c.textures&&v.splat(c.textures);this.centroids=f(c.centroids);this.colors=f(c.colors);this.indices=f(c.indices);this.shininess=c.shininess||
0;this.uniforms=c.uniforms||{};this.attributes=c.attributes||{};this.render=c.render;this.drawType=c.drawType;this.display="display"in c?c.display:true;if(c.texCoords)this.texCoords=v.type(c.texCoords)=="object"?c.texCoords:f(c.texCoords);this.onBeforeRender=c.onBeforeRender||v.empty;this.onAfterRender=c.onAfterRender||v.empty;if(c.program)this.program=c.program;this.position=new w;this.rotation=new w;this.scale=new w(1,1,1);this.matrix=new m;this.normalizeColors();c.computeCentroids&&this.computeCentroids();
c.computeNormals&&this.computeNormals()};h.Model.prototype={$$family:"model",update:function(){var c=this.matrix,i=this.position,p=this.rotation,o=this.scale;c.id();c.$translate(i.x,i.y,i.z);c.$rotateXYZ(p.x,p.y,p.z);c.$scale(o.x,o.y,o.z)},toFloat32Array:function(c){return new Float32Array(this[c])},toUint16Array:function(c){return new Uint16Array(this[c])},normalizeColors:function(){if(this.vertices){var c=this.vertices.length*4/3;if(this.colors&&this.colors.length<c){c/=this.colors.length;for(var i=
this.colors,p=i.slice();--c;)i.push.apply(i,p)}}},computeCentroids:function(){var c=this.vertices,i=[];this.faces.forEach(function(p){var o=[0,0,0],u=0;p.forEach(function(a){a=c[a];o[0]+=a[0];o[1]+=a[1];o[2]+=a[2];u++});o[0]/=u;o[1]/=u;o[2]/=u;i.push(o)});this.centroids=i},computeNormals:function(){var c=this.vertices,i=[];this.faces.forEach(function(p){var o=c[p[0]],u=c[p[1]];p=c[p[2]];o={x:o[0]-u[0],y:o[1]-u[1],z:o[2]-u[2]};w.$cross(o,{x:p[0]-u[0],y:p[1]-u[1],z:p[1]-u[2]});w.norm(o)>1.0E-6&&w.unit(o);
i.push([o.x,o.y,o.z])});this.normals=i}};v.extend(h.Model.prototype,{setUniforms:function(c){c.setUniforms(this.uniforms)},setAttributes:function(c){for(var i in attributes){var p=attributes[i],o=this.id+"-"+i;if(Object.keys(p).length){p.attribute=i;c.setBuffer(o,p);delete p.value}else c.setBuffer(o,true)}},unsetAttributes:function(c){for(var i in attributes)c.setBuffer(this.id+"-"+i,false)},setShininess:function(c){c.setUniform("shininess",this.shininess||0)},setVertices:function(c,i){if(this.vertices)i||
this.dynamic?c.setBuffer("vertices-"+this.id,{attribute:"position",value:this.toFloat32Array("vertices"),size:3}):c.setBuffer("vertices-"+this.id)},unsetVertices:function(c){c.setBuffer("vertices-"+this.id,false)},setNormals:function(c,i){if(this.normals)i||this.dynamic?c.setBuffer("normals-"+this.id,{attribute:"normal",value:this.toFloat32Array("normals"),size:3}):c.setBuffer("normals-"+this.id)},unsetNormals:function(c){c.setBuffer("normals-"+this.id,false)},setIndices:function(c,i){if(this.indices)i||
this.dynamic?c.setBuffer("indices-"+this.id,{bufferType:r.ELEMENT_ARRAY_BUFFER,drawType:r.STATIC_DRAW,value:this.toUint16Array("indices"),size:1}):c.setBuffer("indices-"+this.id)},unsetIndices:function(c){c.setBuffer("indices-"+this.id,false)},setColors:function(c,i){if(this.colors)i||this.dynamic?c.setBuffer("colors-"+this.id,{attribute:"color",value:this.toFloat32Array("colors"),size:4}):c.setBuffer("colors-"+this.id)},unsetColors:function(c){c.setBuffer("colors-"+this.id,false)},setTexCoords:function(c,
i){if(this.texCoords){var p=this.id;if(i||this.dynamic)v.type(this.texCoords)=="object"?this.textures.forEach(function(o,u){c.setBuffer("texCoords-"+u+"-"+p,{attribute:"texCoord"+(u+1),value:new Float32Array(this.texCoords[o]),size:2})}):c.setBuffer("texCoords-"+p,{attribute:"texCoord1",value:this.toFloat32Array("texCoords"),size:2});else v.type(this.texCoords)=="object"?this.textures.forEach(function(o,u){c.setBuffer("texCoords-"+u+"-"+p)}):c.setBuffer("texCoords-"+p)}},unsetTexCoords:function(c){c.setBuffer("texCoords-"+
this.id,false)},setTextures:function(c){this.textures=this.textures?v.splat(this.textures):[];for(var i=0,p=this.textures,o=p.length,u=PhiloGL.Scene.MAX_TEXTURES;i<u;i++)if(i<o){c.setUniform("hasTexture"+(i+1),true);c.setUniform("sampler"+(i+1),i);c.setTexture(p[i],r["TEXTURE"+i])}else c.setUniform("hasTexture"+(i+1),false)}});h.Cube=function(c){h.Model.call(this,v.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,
-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c||{}))};h.Cube.prototype=Object.create(h.Model.prototype);
h.Sphere=function(c){var i=c.nlat||10,p=c.nlong||10,o=c.radius||1,u=g-0,a=2*g-0,b=[],d=[],j=[],n=[];c.onAddVertex=c.onAddVertex||v.empty;if(typeof o=="number"){var s=o;o=function(){return s}}for(var q=0;q<=p;q++)for(var t=1;t<=i;t++){var x=q/p,y=t/i,z=a*x,E=u*y,D=k(z),B=l(z),C=k(E),G=l(E);B*=C;D*=C;C=o(B,G,D,x,y);var H=C*B,F=C*G,I=C*D;b.push(H,F,I);d.push(B,G,D);j.push(y,x);c.onAddVertex({rho:C,theta:z,phi:E,lat:q,lon:t,x:H,y:F,z:I,nx:B,ny:G,nz:D,u:x,v:y})}o=i+1;for(q=0;q<p;q++)for(t=0;t<i;t++){n.push(q*
o+t,q*o+t+1,(q+1)*o+t);n.push((q+1)*o+t,q*o+t+1,(q+1)*o+t+1)}h.Model.call(this,v.extend({vertices:b,indices:n,normals:d,texCoords:j},c||{}))};h.Sphere.prototype=Object.create(h.Model.prototype);h.IcoSphere=function(c){var i=c.iterations||0,p=[],o=[],u=[],a=[],b=Math.sqrt,d=Math.acos,j=Math.atan2,n=Math.PI,s=n*2;c.onAddVertex=c.onAddVertex||v.empty;var q=(1+b(5))/2,t=b(1+q*q);p.push(-1/t,q/t,0,1/t,q/t,0,-1/t,-q/t,0,1/t,-q/t,0,0,-1/t,q/t,0,1/t,q/t,0,-1/t,-q/t,0,1/t,-q/t,q/t,0,-1/t,q/t,0,1/t,-q/t,0,
-1/t,-q/t,0,1/t);u.push(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1);var x=function(){var Q={};return function(A,T){A*=3;T*=3;var W=(A<T?A:T)+"|"+(A>T?A:T);if(W in Q)return Q[W];var V=(p[A]+p[T])/2,X=(p[A+1]+p[T+1])/2,U=(p[A+2]+p[T+2])/2,Z=b(V*V+X*X+U*U);V/=Z;X/=Z;U/=Z;p.push(V,X,U);return Q[W]=p.length/3-1}}();for(q=0;q<i;q++){var y=[],z=0;for(t=u.length;z<t;z+=3){var E=x(u[z],u[z+1]),D=x(u[z+1],u[z+2]),B=x(u[z+
2],u[z]);y.push(u[z],E,B,u[z+1],D,E,u[z+2],B,D,E,D,B)}u=y}q=0;for(t=u.length;q<t;q+=3){z=u[q];E=u[q+1];D=u[q+2];i=z*3;x=E*3;y=D*3;z*=2;E*=2;D*=2;B=p[i];var C=p[i+1],G=p[i+2],H=d(G/b(B*B+C*C+G*G)),F=j(C,B);H/=n;F=1-F/s;var I=p[x],J=p[x+1],K=p[x+2],R=d(K/b(I*I+J*J+K*K)),O=j(J,I);R/=n;O=1-O/s;var L=p[y],M=p[y+1],N=p[y+2],S=d(N/b(L*L+M*M+N*N)),P=j(M,L);S/=n;P=1-P/s;B=w.cross({x:L-I,y:M-J,z:N-K},{x:B-I,y:C-J,z:G-K}).$unit();o[i]=o[x]=o[y]=B.x;o[i+1]=o[x+1]=o[y+1]=B.y;o[i+2]=o[x+2]=o[y+2]=B.z;a[z]=F;a[z+
1]=H;a[E]=O;a[E+1]=R;a[D]=P;a[D+1]=S}h.Model.call(this,v.extend({vertices:p,indices:u,normals:o,texCoords:a},c||{}))};h.IcoSphere.prototype=Object.create(h.Model.prototype);h.TruncatedCone=function(c){var i=c.bottomRadius||0,p=c.topRadius||0,o=c.height||1,u=c.nradial||10,a=c.nvertical||10,b=!!c.topCap,d=!!c.bottomCap,j=(b?2:0)+(d?2:0),n=[],s=[],q=[],t=[],x=u+1,y=Math.atan2(i-p,o),z=Math,E=z.sin,D=z.cos;z=z.PI;var B=D(y);y=E(y);d=a+(d?2:0);for(b=b?-2:0;b<=d;b++){var C=b/a,G=o*C,H;if(b<0){G=0;C=1;H=
i}else if(b>a){G=o;C=1;H=p}else H=i+(p-i)*(b/a);if(b==-2||b==a+2)C=H=0;G-=o/2;for(var F=0;F<x;F++){var I=E(F*z*2/u),J=D(F*z*2/u);n.push(I*H,G,J*H);s.push(b<0||b>a?0:I*B,b<0?-1:b>a?1:y,b<0||b>a?0:J*B);q.push(F/u,C)}}for(b=0;b<a+j;b++)for(F=0;F<u;F++)t.push(x*(b+0)+0+F,x*(b+0)+1+F,x*(b+1)+1+F,x*(b+0)+0+F,x*(b+1)+1+F,x*(b+1)+0+F);h.Model.call(this,v.extend({vertices:n,normals:s,texCoords:q,indices:t},c||{}))};h.TruncatedCone.prototype=Object.create(h.Model.prototype);h.Cone=function(c){c.topRadius=0;
c.topCap=!!c.cap;c.bottomCap=!!c.cap;c.bottomRadius=c.radius||3;h.TruncatedCone.call(this,c)};h.Cone.prototype=Object.create(h.TruncatedCone.prototype);h.Cylinder=function(c){c.bottomRadius=c.radius;c.topRadius=c.radius;h.TruncatedCone.call(this,c)};h.Cylinder.prototype=Object.create(h.TruncatedCone.prototype);h.PlaneXZ=function(c){for(var i=c.width,p=c.height||0,o=c.nwidth||1,u=c.depth,a=c.ndepth||1,b=[],d=[],j=[],n=0;n<=a;n++)for(var s=0;s<=o;s++){var q=s/o,t=n/a;b.push(i*q-i*0.5,p,u*t-u*0.5);d.push(0,
1,0);j.push(q,t)}i=o+1;p=[];for(n=0;n<a;n++)for(s=0;s<o;s++){p.push((n+0)*i+s,(n+1)*i+s,(n+0)*i+s+1);p.push((n+1)*i+s,(n+1)*i+s+1,(n+0)*i+s+1)}h.Model.call(this,v.extend({vertices:b,normals:d,texCoords:j,indices:p},c))};h.PlaneXZ.prototype=Object.create(h.Model.prototype);h.id=v.time();PhiloGL.O3D=h})();(function(){var w={Vertex:{},Fragment:{}},m=w.Fragment;w.Vertex.Default="#define LIGHT_MAX 50\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec2 texCoord1;\nuniform mat4 modelViewMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 normalMatrix;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nvarying vec4 vColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nvec4 transformedNormal = normalMatrix * vec4(normal, 1.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nvColor = color;\nvTexCoord = texCoord1;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";
m.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool enablePicking;\nuniform vec3 pickColor;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif(!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif(enablePicking) {\ngl_FragColor = vec4(pickColor, 1.0);\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
PhiloGL.Shaders=w})();(function(){var w=PhiloGL.Vec3,m=PhiloGL.Mat4,l=function(k,g,f){f=v.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},f||{});this.program=f.program?k[f.program]:k;this.camera=g;this.models=[];this.config=f};l.prototype={add:function(){for(var k=0,g=this.models,f=arguments.length;k<f;k++){var h=arguments[k];h.id=h.id||v.uid();g.push(h);this.defineBuffers(h)}},remove:function(k){var g=this.models;
k=g.indexOf(k);k>-1&&g.splice(k,1)},getProgram:function(k){if(k&&k.program){k=this.program[k.program];k.use();return k}return this.program},defineBuffers:function(k){var g=this.getProgram(k);k.setVertices(g,true);k.setColors(g,true);k.setNormals(g,true);k.setTexCoords(g,true);k.setIndices(g,true)},beforeRender:function(k){this.setupLighting(k);this.setupEffects(k);var g=this.camera;k.setUniform("projectionMatrix",g.projection);k.setUniform("viewMatrix",g.modelView)},setupLighting:function(k){var g=
this.config.lights,f=g.ambient,h=g.directional,c=h.color,i=h.direction,p=g.enable;g=g.points&&v.splat(g.points)||[];h=g.length;var o=[],u=[],a=[],b=[];i=w.unit(i).$scale(-1);k.setUniform("enableLights",p);if(p){k.setUniform("ambientColor",[f.r,f.g,f.b]);k.setUniform("directionalColor",[c.r,c.g,c.b]);k.setUniform("lightingDirection",[i.x,i.y,i.z]);k.setUniform("numberPoints",h);for(f=0;f<h;f++){p=g[f];c=p.position;i=p.color||p.diffuse;p=p.specular;o.push(c.x,c.y,c.z);u.push(i.r,i.g,i.b);a.push(+!!p);
p?b.push(p.r,p.g,p.b):b.push(0,0,0)}k.setUniforms({pointLocation:o,pointColor:u});k.setUniforms({enableSpecular:a,pointSpecularColor:b})}},setupEffects:function(k){var g=this.config.effects.fog,f=g.color||{r:0.5,g:0.5,b:0.5};g?k.setUniforms({hasFog:true,fogNear:g.near,fogFar:g.far,fogColor:[f.r,f.g,f.b]}):k.setUniform("hasFog",false)},render:function(k){var g=this.camera,f=this.program,h=k.renderProgram,c=v.type(f),i=!h&&c=="object",p=v.merge({onBeforeRender:v.empty,onAfterRender:v.empty},k||{});
!i&&this.beforeRender(h||f);this.models.forEach(function(o,u){if(o.display){var a=h||this.getProgram(o);i&&this.beforeRender(a);o.onBeforeRender(a,g);p.onBeforeRender(o,u);this.renderObject(o,a);p.onAfterRender(o,u);o.onAfterRender(a,g)}},this)},renderToTexture:function(k,g){g=g||{};var f=Y.textures[k+"-texture"],h=Y.textureMemo[k+"-texture"];this.render(g);r.bindTexture(h.textureType,f);r.generateMipmap(h.textureType);r.bindTexture(h.textureType,null)},renderObject:function(k,g){var f=this.camera,
h=new m;k.setUniforms(g);k.setAttributes(g);k.setShininess(g);k.setVertices(g);k.setColors(g);k.setNormals(g);k.setTextures(g);k.setTexCoords(g);k.setIndices(g);h.mulMat42(f.modelView,k.matrix);g.setUniform("modelViewMatrix",h);g.setUniform("normalMatrix",h.invert().$transpose());if(k.render)k.render(r,g,f);else k.indices?r.drawElements(k.drawType!==undefined?r.get(k.drawType):r.TRIANGLES,k.indices.length,r.UNSIGNED_SHORT,0):r.drawArrays(r.get(k.drawType||"TRIANGLES"),0,k.vertices.length/3);k.unsetAttributes(g);
k.unsetVertices(g);k.unsetColors(g);k.unsetNormals(g);k.unsetTexCoords(g);k.unsetIndices(g)},setupPicking:function(){var k=PhiloGL.Program.fromDefaultShaders();k.setFrameBuffer("$picking",{width:1,height:1,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:true});k.setFrameBuffer("$picking",false);this.pickingProgram=k},pick:function(k,g){this.pickingProgram||this.setupPicking();var f={},h=Y.usedProgram,
c=this.pickingProgram,i=this.config,p=i.lights.enable,o=i.effects.fog,u=r.canvas.width,a=r.canvas.height,b=[],d=new Uint8Array(4),j=0,n;i.lights.enable=false;i.effects.fog=false;c.use();c.setUniform("enablePicking",true);c.setFrameBuffer("$picking",true);r.disable(r.BLEND);r.viewport(-k,g-a,u,a);r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,d);n=d[0]+d[1]*256+d[2]*65536;this.renderToTexture("$picking",{renderProgram:c,onBeforeRender:function(s,q){if(q==
n)j=1;var t=q+j;b[0]=t%256;b[1]=(t/256>>0)%256;b[2]=(t/65536>>0)%256;h.setUniform("pickColor",[b[0]/255,b[1]/255,b[2]/255]);f[String(b)]=s}});r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,d);u=f[String([d[0],d[1],d[2]])];c.setFrameBuffer("$picking",false);c.setUniform("enablePicking",false);i.lights.enable=p;i.effects.fog=o;h&&h.use();return u&&u.pickable&&u}};l.MAX_TEXTURES=3;l.MAX_POINT_LIGHTS=50;PhiloGL.Scene=l})();(function(){function w(m,l){for(var k=this.workers=[];l--;)k.push(new Worker(m))}
w.prototype={map:function(m){var l=this.workers,k=this.configs=[],g=0;for(l=l.length;g<l;g++)k.push(m&&m(g));return this},reduce:function(m){for(var l=m.reduceFn,k=this.workers,g=this.configs,f=k.length,h=m.initialValue,c=function(u){f--;h=h===undefined?u.data:l(h,u.data);if(f==0)m.onComplete(h)},i=0,p=f;i<p;i++){var o=k[i];o.onmessage=c;o.postMessage(g[i])}return this}};PhiloGL.WorkerGroup=w})();(function(){var w=function(g){this.opt=v.merge({duration:1E3,transition:function(f){return f},onCompute:v.empty,
onComplete:v.empty},g||{})};w.prototype={timer:null,time:null,start:function(g){this.opt=v.merge(this.opt,g||{});this.time=v.time();this.animating=true},step:function(){if(this.animating){var g=v.time(),f=this.time,h=this.opt;if(g<f+h.duration){g=h.transition((g-f)/h.duration);h.onCompute.call(this,g)}else{this.animating=false;h.onCompute.call(this,1);h.onComplete.call(this)}}}};w.compute=function(g,f,h){return g+(f-g)*h};w.Transition={linear:function(g){return g}};var m=w.Transition;(function(){var g=
function(c,i){i=v.splat(i);return v.extend(c,{easeIn:function(p){return c(p,i)},easeOut:function(p){return 1-c(1-p,i)},easeInOut:function(p){return p<=0.5?c(2*p,i)/2:(2-c(2*(1-p),i))/2}})},f={Pow:function(c,i){return Math.pow(c,i[0]||6)},Expo:function(c){return Math.pow(2,8*(c-1))},Circ:function(c){return 1-Math.sin(Math.acos(c))},Sine:function(c){return 1-Math.sin((1-c)*Math.PI/2)},Back:function(c,i){i=i[0]||1.618;return Math.pow(c,2)*((i+1)*c-i)},Bounce:function(c){for(var i,p=0,o=1;;p+=o,o/=2)if(c>=
(7-4*p)/11){i=o*o-Math.pow((11-6*p-11*c)/4,2);break}return i},Elastic:function(c,i){return Math.pow(2,10*--c)*Math.cos(20*c*Math.PI*(i[0]||1)/3)}},h;for(h in f)m[h]=g(f[h]);["Quad","Cubic","Quart","Quint"].forEach(function(c,i){m[c]=g(function(p){return Math.pow(p,[i+2])})})})();var l=self||window;if(l){var k=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(g){if(g in l){w.animationTime=function(){return l[g]};
k=true}});if(!k)w.animationTime=v.time;k=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(g){if(g in l){w.requestAnimationFrame=function(f){l[g](function(){f()})};k=true}});if(!k)w.requestAnimationFrame=function(g){setTimeout(function(){g()},1E3/60)}}PhiloGL.Fx=w})()})();
