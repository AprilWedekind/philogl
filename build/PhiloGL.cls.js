/*

 Copyright (c) 2011 Sencha Inc. - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
(function(){function v(w){return document.getElementById(w)}this.PhiloGL=null;(function(){PhiloGL=function(w,z){function m(s,x,u){var a=s.canvas,b=new PhiloGL.Camera(f.fov,a.width/a.height,f.near,f.far,f);b.update();var d=new PhiloGL.Scene(x,b,c);Z=new PhiloGL.WebGL.Application({gl:s,canvas:a,program:x,scene:d,camera:b});x.$$family=="program"&&x.use();i&&PhiloGL.Events.create(Z,v.extend(i,{bind:Z}));if(l.src.length)new PhiloGL.IO.Textures(v.extend(l,{onComplete:function(){u(Z)}}));else u(Z)}z=v.merge({context:{},
camera:{fov:45,near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:v.empty,onError:v.empty},z||{});var h=z.context,f=z.camera,i=z.events,l=z.textures,j=v.splat(z.program),c=z.scene;q=PhiloGL.WebGL.getContext(w,h);if(!q){z.onError("The WebGL context couldn't been initialized");return null}var k={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},p=j.length,o=function(){var s=p,x={},u=false;
return{onSuccess:function(a,b){x[b.id||p-s]=a;s--;if(s==0&&!u)m(q,p==1?a:x,function(d){z.onLoad(d)})},onError:function(){s--;z.onError(z.id);u=true}}}();j.forEach(function(s){var x=s.from,u;for(u in k)if(x==u){program=PhiloGL.Program[k[u]](v.extend(o,s));break}if(program)o.onSuccess(program,s)})}})();PhiloGL.unpack=function(w){w=w||window||self;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx"].forEach(function(z){w[z]=PhiloGL[z]})};PhiloGL.version=
"1.2.1";var q,Z;v.empty=function(){};v.time=Date.now||function(){return+new Date};v.uid=function(){var w=v.time();return function(){return w++}}();v.extend=function(w,z){for(var m in z)w[m]=z[m];return w};v.type=function(){var w=Object.prototype.toString;return function(z){var m;m=w.call(z);m=m.substr(8,m.length-9).toLowerCase();if(m!="object")return m;if(z.$$family)return z.$$family;return z&&z.nodeName&&z.nodeType==1?"element":m}}();(function(){function w(z){var m=v.type(z);if(m=="object"){m={};
for(var h in z)m[h]=w(z[h]);return m}else if(m=="array"){m=[];h=0;for(var f=z.length;h<f;h++)m[h]=w(z[h]);return m}else return z}v.merge=function(){for(var z={},m=0,h=arguments.length;m<h;m++){var f=arguments[m];if(v.type(f)=="object")for(var i in f){var l=f[i],j=z[i];z[i]=j&&v.type(l)=="object"&&v.type(j)=="object"?v.merge(j,l):w(l)}}return z}})();v.splat=function(){var w=Array.isArray;return function(z){return w(z)&&z||[z]}}();(function(){function w(m){for(var h in m)this[h]=m[h];this.buffers={};
this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}var z={getContext:function(m,h){m=typeof m=="string"?v(m):m;var f;(f=m.getContext("experimental-webgl",h))||(f=m.getContext("webgl",h));if(f&&h&&h.debug){q={};for(var i in f){var l=f[i];q[i]=typeof l=="function"?function(j,c){return function(){console.log(j,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var k=c.apply(f,
arguments)}catch(p){throw j+" "+p;}for(var o=[],s;(s=f.getError())!==f.NO_ERROR;)o.push(s);if(o.length)throw o.join();return k}}(i,l):l}}else q=f;if(q)q.get=function(j){return typeof j=="string"?q[j]:j};return q}};w.prototype={$$family:"application",setBuffer:function(m,h,f){if(f===false||f===null){(f=this.bufferMemo[h])&&q.bindBuffer(f.bufferType,null);var i=f&&f.attribute||h;m=m.attributes[i];m!==undefined&&q.disableVertexAttribArray(m)}else{f=v.merge({bufferType:q.ARRAY_BUFFER,size:1,dataType:q.FLOAT,
stride:0,offset:0,drawType:q.STATIC_DRAW},this.bufferMemo[h]||{},f||{});i=f.attribute||h;var l=f.bufferType,j=h in this.buffers,c=j?this.buffers[h]:q.createBuffer(),k="value"in f,p=f.value,o=f.size,s=f.dataType,x=f.stride,u=f.offset,a=f.drawType;m=m.attributes[i];var b=m!==undefined;j||(this.buffers[h]=c);b&&q.enableVertexAttribArray(m);q.bindBuffer(l,c);k&&q.bufferData(l,p,a);b&&q.vertexAttribPointer(m,o,s,false,x,u);delete f.value;this.bufferMemo[h]=f;if(b)this.bufferMemo[i]=f;return this}},setBuffers:function(m,
h){for(var f in h)this.setBuffer(m,f,h[f]);return this},setFrameBuffer:function(m,h){if(typeof h!="object")q.bindFramebuffer(q.FRAMEBUFFER,h?this.frameBuffers[m]:null);else{h=v.merge({width:0,height:0,bindToTexture:false,textureOptions:{attachment:q.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:q.DEPTH_ATTACHMENT}},this.frameBufferMemo[m]||{},h||{});var f=h.bindToTexture,i=h.bindToRenderBuffer,l=m in this.frameBuffers,j=l?this.frameBuffers[m]:q.createFramebuffer(q.FRAMEBUFFER);
q.bindFramebuffer(q.FRAMEBUFFER,j);l||(this.frameBuffers[m]=j);if(f){f=v.merge({data:{width:h.width,height:h.height}},v.type(f)=="object"?f:{});l=m+"-texture";j=h.textureOptions;this.setTexture(l,f);q.framebufferTexture2D(q.FRAMEBUFFER,j.attachment,this.textureMemo[l].textureType,this.textures[l],0)}if(i){i=v.merge({width:h.width,height:h.height},v.type(i)=="object"?i:{});f=m+"-renderbuffer";l=h.renderBufferOptions;this.setRenderBuffer(f,i);q.framebufferRenderbuffer(q.FRAMEBUFFER,l.attachment,q.RENDERBUFFER,
this.renderBuffers[f])}q.bindTexture(q.TEXTURE_2D,null);q.bindRenderbuffer(q.RENDERBUFFER,null);q.bindFramebuffer(q.FRAMEBUFFER,null);this.frameBufferMemo[m]=h;return this}},setFrameBuffers:function(m){for(var h in m)this.setFrameBuffer(h,m[h]);return this},setRenderBuffer:function(m,h){if(typeof h!="object")q.bindRenderbuffer(q.RENDERBUFFER,h?this.renderBufferMemo[m]:null);else{h=v.merge({storageType:q.DEPTH_COMPONENT16,width:0,height:0},this.renderBufferMemo[m]||{},h||{});var f=m in this.renderBuffers,
i=f?this.renderBuffers[m]:q.createRenderbuffer(q.RENDERBUFFER);f||(this.renderBuffers[m]=i);q.bindRenderbuffer(q.RENDERBUFFER,i);q.renderbufferStorage(q.RENDERBUFFER,h.storageType,h.width,h.height);this.renderBufferMemo[m]=h;return this}},setRenderBuffers:function(m){for(var h in m)this.setRenderBuffer(h,m[h]);return this},setTexture:function(m,h){if(!h||typeof h!="object"){q.activeTexture(h||q.TEXTURE0);q.bindTexture(this.textureMemo[m].textureType||q.TEXTURE_2D,this.textures[m])}else{h=v.merge({textureType:q.TEXTURE_2D,
pixelStore:[{name:q.UNPACK_FLIP_Y_WEBGL,value:true}],parameters:[{name:q.TEXTURE_MAG_FILTER,value:q.NEAREST},{name:q.TEXTURE_MIN_FILTER,value:q.NEAREST}],data:{format:q.RGBA,value:false,width:0,height:0,border:0}},this.textureMemo[m]||{},h||{});var f="textureType"in h?h.textureType:q.TEXTURE_2D,i=m in this.textures,l=i?this.textures[m]:q.createTexture(),j=h.pixelStore,c=h.parameters,k=h.data,p=!!h.data.value;i||(this.textures[m]=l);q.bindTexture(f,l);i||j.forEach(function(o){o.name=typeof o.name==
"string"?q[o.name]:o.name;q.pixelStorei(o.name,o.value)});if(p)q.texImage2D(f,0,k.format,k.format,q.UNSIGNED_BYTE,k.value);else if(k.width||k.height)q.texImage2D(f,0,k.format,k.width,k.height,k.border,k.format,q.UNSIGNED_BYTE,null);i||c.forEach(function(o){o.name=q.get(o.name);o.value=q.get(o.value);q.texParameteri(f,o.name,o.value);o.generateMipmap&&q.generateMipmap(f)});delete h.data;this.textureMemo[m]=h;return this}},setTextures:function(m){for(var h in m)this.setTexture(h,m[h]);return this},
use:function(m){q.useProgram(m.program);this.usedProgram=m;return this}};z.Application=w;(function(){try{var m=document.createElement("canvas");PhiloGL.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(m.getContext("webgl")||m.getContext("experimental-webgl")))}}catch(h){PhiloGL.hasWebGL=function(){return false}}})();PhiloGL.WebGL=z})();(function(){function w(a){return{get:function(){return this[a]},set:function(b){this[a]=b},configurable:false,enumerable:false}}var z=Math.sqrt,m=Math.sin,
h=Math.cos,f=Math.tan,i=Math.PI,l=Array.prototype.slice,j=function(){if(!Float32Array.call)return Array;try{Float32Array.call({},10)}catch(a){return Array}return Float32Array}(),c=j!=Array,k=function(a,b,d){if(c){Float32Array.call(this,3);this[0]=a||0;this[1]=b||0;this[2]=d||0}else this.push(a||0,b||0,d||0);this.typedContainer=new Float32Array(3)};k.prototype=Object.create(j.prototype,{x:w(0),y:w(1),z:w(2)});var p={setVec3:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,d,g){a[0]=
b;a[1]=d;a[2]=g;return a},add:function(a,b){return new k(a[0]+b[0],a[1]+b[1],a[2]+b[2])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a},add2:function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];return a},sub:function(a,b){return new k(a[0]-b[0],a[1]-b[1],a[2]-b[2])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return a},sub2:function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];return a},scale:function(a,b){return new k(a[0]*b,a[1]*b,a[2]*b)},$scale:function(a,
b){a[0]*=b;a[1]*=b;a[2]*=b;return a},neg:function(a){return new k(-a[0],-a[1],-a[2])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a},unit:function(a){var b=k.norm(a);if(b>0)return k.scale(a,1/b);return k.clone(a)},$unit:function(a){var b=k.norm(a);if(b>0)return k.$scale(a,1/b);return a},cross:function(a,b){var d=a[0],g=a[1],n=a[2],r=b[0],t=b[1],y=b[2];return new k(g*y-n*t,n*r-d*y,d*t-g*r)},$cross:function(a,b){var d=a[0],g=a[1],n=a[2],r=b[0],t=b[1],y=b[2];a[0]=g*y-n*t;a[1]=n*r-d*y;a[2]=
d*t-g*r;return a},distTo:function(a,b){var d=a[0]-b[0],g=a[1]-b[1],n=a[2]-b[2];return z(d*d,g*g,n*n)},distToSq:function(a,b){var d=a[0]-b[0],g=a[1]-b[1],n=a[2]-b[2];return d*d+g*g+n*n},norm:function(a){var b=a[0],d=a[1];a=a[2];return z(b*b+d*d+a*a)},normSq:function(a){var b=a[0],d=a[1];a=a[2];return b*b+d*d+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},clone:function(a){return new k(a[0],a[1],a[2])},toFloat32Array:function(){return c?function(a){var b=a.typedContainer;b[0]=a[0];b[1]=
a[1];b[2]=a[2];return b}:function(a){var b=a.typedContainer;b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}}()},o=k.prototype,s;for(s in p){k[s]=p[s];o[s]=function(a){return function(){var b=l.call(arguments);b.unshift(this);return k[a].apply(k,b)}}(s)}var x=function(a,b,d,g,n,r,t,y,A,B,D,F,C,G,J,K){j.call(this,16);this.length=16;typeof a=="number"?this.set(a,b,d,g,n,r,t,y,A,B,D,F,C,G,J,K):this.id();this.typedContainer=new Float32Array(16)};x.prototype=Object.create(j.prototype,{n11:w(0),n21:w(1),n31:w(2),
n41:w(3),n12:w(4),n22:w(5),n32:w(6),n42:w(7),n13:w(8),n23:w(9),n33:w(10),n43:w(11),n14:w(12),n24:w(13),n34:w(14),n44:w(15)});p={id:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){return new x(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])},set:function(a,b,d,g,n,r,t,y,A,B,D,F,C,G,J,K,I){a[0]=b;a[1]=r;a[2]=B;a[3]=G;a[4]=d;a[5]=t;a[6]=D;a[7]=J;a[8]=g;
a[9]=y;a[10]=F;a[11]=K;a[12]=n;a[13]=A;a[14]=C;a[15]=I;return a},mulVec3:function(a,b){var d=b[0],g=b[1],n=b[2];return new k(a[0]*d+a[4]*g+a[8]*n+a[12],a[1]*d+a[5]*g+a[9]*n+a[13],a[2]*d+a[6]*g+a[10]*n+a[14])},$mulVec3:function(a,b){var d=b[0],g=b[1],n=b[2];b[0]=a[0]*d+a[4]*g+a[8]*n+a[12];b[1]=a[1]*d+a[5]*g+a[9]*n+a[13];b[2]=a[2]*d+a[6]*g+a[10]*n+a[14];return b},mulMat42:function(a,b,d){var g=b[0],n=b[4],r=b[8],t=b[12],y=b[1],A=b[5],B=b[9],D=b[13],F=b[2],C=b[6],G=b[10],J=b[14],K=b[3],I=b[7],H=b[11];
b=b[15];var L=d[0],O=d[4],S=d[8],P=d[12],Q=d[1],R=d[5],V=d[9],T=d[13],U=d[2],M=d[6],N=d[10],E=d[14],W=d[3],X=d[7],Y=d[11];d=d[15];a[0]=g*L+n*Q+r*U+t*W;a[4]=g*O+n*R+r*M+t*X;a[8]=g*S+n*V+r*N+t*Y;a[12]=g*P+n*T+r*E+t*d;a[1]=y*L+A*Q+B*U+D*W;a[5]=y*O+A*R+B*M+D*X;a[9]=y*S+A*V+B*N+D*Y;a[13]=y*P+A*T+B*E+D*d;a[2]=F*L+C*Q+G*U+J*W;a[6]=F*O+C*R+G*M+J*X;a[10]=F*S+C*V+G*N+J*Y;a[14]=F*P+C*T+G*E+J*d;a[3]=K*L+I*Q+H*U+b*W;a[7]=K*O+I*R+H*M+b*X;a[11]=K*S+I*V+H*N+b*Y;a[15]=K*P+I*T+H*E+b*d;return a},mulMat4:function(a,
b){var d=a[0],g=a[4],n=a[8],r=a[12],t=a[1],y=a[5],A=a[9],B=a[13],D=a[2],F=a[6],C=a[10],G=a[14],J=a[3],K=a[7],I=a[11],H=a[15],L=b[0],O=b[4],S=b[8],P=b[12],Q=b[1],R=b[5],V=b[9],T=b[13],U=b[2],M=b[6],N=b[10],E=b[14],W=b[3],X=b[7],Y=b[11],aa=b[15],$=new x;$[0]=d*L+g*Q+n*U+r*W;$[4]=d*O+g*R+n*M+r*X;$[8]=d*S+g*V+n*N+r*Y;$[12]=d*P+g*T+n*E+r*aa;$[1]=t*L+y*Q+A*U+B*W;$[5]=t*O+y*R+A*M+B*X;$[9]=t*S+y*V+A*N+B*Y;$[13]=t*P+y*T+A*E+B*aa;$[2]=D*L+F*Q+C*U+G*W;$[6]=D*O+F*R+C*M+G*X;$[10]=D*S+F*V+C*N+G*Y;$[14]=D*P+F*T+
C*E+G*aa;$[3]=J*L+K*Q+I*U+H*W;$[7]=J*O+K*R+I*M+H*X;$[11]=J*S+K*V+I*N+H*Y;$[15]=J*P+K*T+I*E+H*aa;return $},$mulMat4:function(a,b){var d=a[0],g=a[4],n=a[8],r=a[12],t=a[1],y=a[5],A=a[9],B=a[13],D=a[2],F=a[6],C=a[10],G=a[14],J=a[3],K=a[7],I=a[11],H=a[15],L=b[0],O=b[4],S=b[8],P=b[12],Q=b[1],R=b[5],V=b[9],T=b[13],U=b[2],M=b[6],N=b[10],E=b[14],W=b[3],X=b[7],Y=b[11],aa=b[15];a[0]=d*L+g*Q+n*U+r*W;a[4]=d*O+g*R+n*M+r*X;a[8]=d*S+g*V+n*N+r*Y;a[12]=d*P+g*T+n*E+r*aa;a[1]=t*L+y*Q+A*U+B*W;a[5]=t*O+y*R+A*M+B*X;a[9]=
t*S+y*V+A*N+B*Y;a[13]=t*P+y*T+A*E+B*aa;a[2]=D*L+F*Q+C*U+G*W;a[6]=D*O+F*R+C*M+G*X;a[10]=D*S+F*V+C*N+G*Y;a[14]=D*P+F*T+C*E+G*aa;a[3]=J*L+K*Q+I*U+H*W;a[7]=J*O+K*R+I*M+H*X;a[11]=J*S+K*V+I*N+H*Y;a[15]=J*P+K*T+I*E+H*aa;return a},add:function(a,b){var d=new x;d[0]=a[0]+b[0];d[4]=a[4]+b[4];d[8]=a[8]+b[8];d[12]=a[12]+b[12];d[1]=a[1]+b[1];d[5]=a[5]+b[5];d[9]=a[9]+b[9];d[13]=a[13]+b[13];d[2]=a[2]+b[2];d[6]=a[6]+b[6];d[10]=a[10]+b[10];d[14]=a[14]+b[14];d[3]=a[3]+b[3];d[7]=a[7]+b[7];d[11]=a[11]+b[11];d[15]=a[15]+
b[15];return d},$add:function(a,b){a[0]+=b[0];a[4]+=b[4];a[8]+=b[8];a[12]+=b[12];a[1]+=b[1];a[5]+=b[5];a[9]+=b[9];a[13]+=b[13];a[2]+=b[2];a[6]+=b[6];a[10]+=b[10];a[14]+=b[14];a[3]+=b[3];a[7]+=b[7];a[11]+=b[11];a[15]+=b[15];return a},transpose:function(a){return new x(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])},$transpose:function(a){return x.set(a,a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])},rotateAxis:function(a,
b,d){var g=m(b);b=h(b);var n=1-b,r=d[0],t=d[1];d=d[2];g=new x(r*r*n+b,r*t*n-d*g,r*d*n+t*g,0,t*r*n+d*g,t*t*n+b,t*d*n-r*g,0,r*d*n-t*g,t*d*n+r*g,d*d*n+b,0,0,0,0,1);return x.mulMat4(a,g)},$rotateAxis:function(a,b,d){var g=m(b);b=h(b);var n=1-b,r=d[0],t=d[1];d=d[2];g=new x(r*r*n+b,r*t*n-d*g,r*d*n+t*g,0,t*r*n+d*g,t*t*n+b,t*d*n-r*g,0,r*d*n-t*g,t*d*n+r*g,d*d*n+b,0,0,0,0,1);return x.$mulMat4(a,g)},rotateXYZ:function(a,b,d,g){b=new x(h(d)*h(g),-h(b)*m(g)+m(b)*m(d)*h(g),m(b)*m(g)+h(b)*m(d)*h(g),0,h(d)*m(g),
h(b)*h(g)+m(b)*m(d)*m(g),-m(b)*h(g)+h(b)*m(d)*m(g),0,-m(d),m(b)*h(d),h(b)*h(d),0,0,0,0,1);return x.mulMat4(a,b)},$rotateXYZ:function(a,b,d,g){b=new x(h(d)*h(g),-h(b)*m(g)+m(b)*m(d)*h(g),m(b)*m(g)+h(b)*m(d)*h(g),0,h(d)*m(g),h(b)*h(g)+m(b)*m(d)*m(g),-m(b)*h(g)+h(b)*m(d)*m(g),0,-m(d),m(b)*h(d),h(b)*h(d),0,0,0,0,1);return x.$mulMat4(a,b)},translate:function(a,b,d,g){b=new x(1,0,0,b,0,1,0,d,0,0,1,g,0,0,0,1);return x.mulMat4(a,b)},$translate:function(a,b,d,g){b=new x(1,0,0,b,0,1,0,d,0,0,1,g,0,0,0,1);return x.$mulMat4(a,
b)},scale:function(a,b,d,g){b=new x(b,0,0,0,0,d,0,0,0,0,g,0,0,0,0,1);return x.mulMat4(a,b)},$scale:function(a,b,d,g){b=new x(b,0,0,0,0,d,0,0,0,0,g,0,0,0,0,1);return x.$mulMat4(a,b)},invert:function(a){var b=new x,d=a[0],g=a[4],n=a[8],r=a[12],t=a[1],y=a[5],A=a[9],B=a[13],D=a[2],F=a[6],C=a[10],G=a[14],J=a[3],K=a[7],I=a[11];a=a[15];var H=d*y-g*t,L=d*A-n*t,O=d*B-r*t,S=g*A-n*y,P=g*B-r*y,Q=n*B-r*A,R=D*K-F*J,V=D*I-C*J,T=D*a-G*J,U=F*I-C*K,M=F*a-G*K,N=C*a-G*I,E=1/(H*N-L*M+O*U+S*T-P*V+Q*R);b[0]=(+y*N-A*M+B*
U)*E;b[4]=(-g*N+n*M-r*U)*E;b[8]=(+K*Q-I*P+a*S)*E;b[12]=(-F*Q+C*P-G*S)*E;b[1]=(-t*N+A*T-B*V)*E;b[5]=(+d*N-n*T+r*V)*E;b[9]=(-J*Q+I*O-a*L)*E;b[13]=(+D*Q-C*O+G*L)*E;b[2]=(+t*M-y*T+B*R)*E;b[6]=(-d*M+g*T-r*R)*E;b[10]=(+J*P-K*O+a*H)*E;b[14]=(-D*P+F*O-G*H)*E;b[3]=(-t*U+y*V-A*R)*E;b[7]=(+d*U-g*V+n*R)*E;b[11]=(-J*S+K*L-I*H)*E;b[15]=(+D*S-F*L+C*H)*E;return b},$invert:function(a){var b=a[0],d=a[4],g=a[8],n=a[12],r=a[1],t=a[5],y=a[9],A=a[13],B=a[2],D=a[6],F=a[10],C=a[14],G=a[3],J=a[7],K=a[11],I=a[15],H=b*t-d*
r,L=b*y-g*r,O=b*A-n*r,S=d*y-g*t,P=d*A-n*t,Q=g*A-n*y,R=B*J-D*G,V=B*K-F*G,T=B*I-C*G,U=D*K-F*J,M=D*I-C*J,N=F*I-C*K,E=1/(H*N-L*M+O*U+S*T-P*V+Q*R);a[0]=(+t*N-y*M+A*U)*E;a[4]=(-d*N+g*M-n*U)*E;a[8]=(+J*Q-K*P+I*S)*E;a[12]=(-D*Q+F*P-C*S)*E;a[1]=(-r*N+y*T-A*V)*E;a[5]=(+b*N-g*T+n*V)*E;a[9]=(-G*Q+K*O-I*L)*E;a[13]=(+B*Q-F*O+C*L)*E;a[2]=(+r*M-t*T+A*R)*E;a[6]=(-b*M+d*T-n*R)*E;a[10]=(+G*P-J*O+I*H)*E;a[14]=(-B*P+D*O-C*H)*E;a[3]=(-r*U+t*V-y*R)*E;a[7]=(+b*U-d*V+g*R)*E;a[11]=(-G*S+J*L-K*H)*E;a[15]=(+B*S-D*L+F*H)*E;return a},
lookAt:function(a,b,d,g){d=k.sub(b,d);d.$unit();g=k.cross(g,d);g.$unit();var n=k.cross(d,g);n.$unit();return x.set(a,g[0],g[1],g[2],-g.dot(b),n[0],n[1],n[2],-n.dot(b),d[0],d[1],d[2],-d.dot(b),0,0,0,1)},frustum:function(a,b,d,g,n,r,t){return x.set(a,2*r/(d-b),0,(d+b)/(d-b),0,0,2*r/(n-g),(n+g)/(n-g),0,0,0,-(t+r)/(t-r),-2*t*r/(t-r),0,0,-1,0)},perspective:function(a,b,d,g,n){b=g*f(b*i/360);var r=-b;return x.frustum(a,r*d,b*d,r,b,g,n)},ortho:function(a,b,d,g,n,r,t){var y=d-b,A=n-g,B=t-r;return x.set(a,
2/y,0,0,-((d+b)/y),0,2/A,0,-((n+g)/A),0,0,-2/B,-((t+r)/B),0,0,0,1)},toFloat32Array:function(){return c?function(a){var b=a.typedContainer;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}:function(a){var b=a.typedContainer;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];
b[14]=a[14];b[15]=a[15];return b}}()};o=x.prototype;for(s in p){x[s]=p[s];o[s]=function(a){return function(){var b=l.call(arguments);b.unshift(this);return x[a].apply(x,b)}}(s)}var u=function(a,b,d,g){j.call(this,4);this[0]=a||0;this[1]=b||0;this[2]=d||0;this[3]=g||0;this.typedContainer=new Float32Array(4)};p={setQuat:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,d,g,n){a[0]=b||0;a[1]=d||0;a[2]=g||0;a[3]=n||0;return a},clone:function(a){return new u(a[0],a[1],a[2],
a[3])},neg:function(a){return new u(-a[0],-a[1],-a[2],-a[3])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];a[3]=-a[3];return a},add:function(a,b){return new u(a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];return a},sub:function(a,b){return new u(a[0]-b[0],a[1]-b[1],a[2]-b[2],a[3]-b[3])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];a[3]-=b[3];return a},scale:function(a,b){return new u(a[0]*b,a[1]*b,a[2]*b,a[3]*b)},$scale:function(a,
b){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;return a},mulQuat:function(a,b){var d=a[0],g=a[1],n=a[2],r=a[3],t=b[0],y=b[1],A=b[2],B=b[3];return new u(r*t+d*B+g*A-n*y,r*y+g*B+n*t-d*A,r*A+n*B+d*y-g*t,r*B-d*t-g*y-n*A)},$mulQuat:function(a,b){var d=a[0],g=a[1],n=a[2],r=a[3],t=b[0],y=b[1],A=b[2],B=b[3];a.a=r*t+d*B+g*A-n*y;a.b=r*y+g*B+n*t-d*A;a.c=r*A+n*B+d*y-g*t;a.d=r*B-d*t-g*y-n*A;return a},divQuat:function(a,b){var d=a[0],g=a[1],n=a[2],r=a[3],t=b[0],y=b[1],A=b[2],B=b[3],D=1/(B*B+t*t+y*y+A*A);return new u((d*B-
r*t-g*A+n*y)*D,(d*A-r*y+g*B-n*t)*D,(g*t+n*B-r*A-d*y)*D,(r*B+d*t+g*y+n*A)*D)},$divQuat:function(a,b){var d=a[0],g=a[1],n=a[2],r=a[3],t=b[0],y=b[1],A=b[2],B=b[3],D=1/(B*B+t*t+y*y+A*A);a.a=(d*B-r*t-g*A+n*y)*D;a.b=(d*A-r*y+g*B-n*t)*D;a.c=(g*t+n*B-r*A-d*y)*D;a.d=(r*B+d*t+g*y+n*A)*D;return a},invert:function(a){var b=a[0],d=a[1],g=a[2];a=a[3];var n=1/(b*b+d*d+g*g+a*a);return new u(-b*n,-d*n,-g*n,a*n)},$invert:function(a){var b=a[0],d=a[1],g=a[2],n=a[3],r=1/(b*b+d*d+g*g+n*n);a.a=-b*r;a.b=-d*r;a.c=-g*r;a.d=
n*r;return a},norm:function(a){var b=a[0],d=a[1],g=a[2];a=a[3];return z(b*b+d*d+g*g+a*a)},normSq:function(a){var b=a[0],d=a[1],g=a[2];a=a[3];return b*b+d*d+g*g+a*a},unit:function(a){return u.scale(a,1/u.norm(a))},$unit:function(a){return u.$scale(a,1/u.norm(a))},conjugate:function(a){return new u(-a[0],-a[1],-a[2],a[3])},$conjugate:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a}};o=u.prototype={};for(s in p){u[s]=p[s];o[s]=function(a){return function(){var b=l.call(arguments);b.unshift(this);
return u[a].apply(u,b)}}(s)}k.fromQuat=function(a){return new k(a[0],a[1],a[2])};u.fromVec3=function(a,b){return new u(a[0],a[1],a[2],b||0)};u.fromMat4=function(a){var b,d,g;if(a[0]>a[5]&&a[0]>a[10]){b=0;d=1;g=2}else if(a[5]>a[0]&&a[5]>a[10]){b=1;d=2;g=0}else{b=2;d=0;g=1}var n=z(1+a[b*5]-a[d*5]-a[g*5]),r=new u;r[b]=0.5*n;r[d]=0.5*(a["n"+d+""+b]+a["n"+b+""+d])/n;r[g]=0.5*(a["n"+b+""+g]+a["n"+g+""+b])/n;r[3]=0.5*(a["n"+d+""+g]-a["n"+g+""+d])/n;return r};u.fromXRotation=function(a){return new u(m(a/
2),0,0,h(a/2))};u.fromYRotation=function(a){return new u(0,m(a/2),0,h(a/2))};u.fromZRotation=function(a){return new u(0,0,m(a/2),h(a/2))};u.fromAxisRotation=function(a,b){var d=a[0],g=a[1],n=a[2],r=1/z(d*d+g*g+n*n),t=m(b/2),y=h(b/2);return new u(t*d*r,t*g*r,t*n*r,y)};x.fromQuat=function(a){var b=a[3],d=a[0],g=a[1];a=a[2];return new x(b*b+d*d-g*g-a*a,2*d*g-2*b*a,2*d*a+2*b*g,0,2*d*g+2*b*a,b*b-d*d+g*g-a*a,2*g*a-2*b*d,0,2*d*a-2*b*g,2*g*a+2*b*d,b*b-d*d-g*g+a*a,0,0,0,0,1)};PhiloGL.Vec3=k;PhiloGL.Mat4=x;
PhiloGL.Quat=u})();(function(){function w(i){return i!==true?i:false}var z=function(i){var l=function(j){for(var c={x:0,y:0};j&&!/^(?:body|html)$/i.test(j.tagName);){c.x+=j.offsetLeft;c.y+=j.offsetTop;j=j.offsetParent}return c}(i);i=function(j){for(var c={x:0,y:0};j&&!/^(?:body|html)$/i.test(j.tagName);){c.x+=j.scrollLeft;c.y+=j.scrollTop;j=j.parentNode}return c}(i);return{x:l.x-i.x,y:l.y-i.y}},m={get:function(i,l){return i||(l||window).event},getWheel:function(i){return i.wheelDelta?i.wheelDelta/
120:-(i.detail||0)/3},getKey:function(i){var l=i.which||i.keyCode,j;a:{j=f.Keys;for(var c in j)if(j[c]==l){j=c;break a}j=void 0}c=l-111;if(c>0&&c<13)j="f"+c;j=j||String.fromCharCode(l).toLowerCase();return{code:l,key:j,shift:i.shiftKey,control:i.ctrlKey,alt:i.altKey,meta:i.metaKey}},isRightClick:function(i){return i.which==3||i.button==2},getPos:function(i,l){l=l||window;i=i||l.event;var j=l.document;j=j.documentElement||j.body;if(i.touches&&i.touches.length)i=i.touches[0];return{x:i.pageX||i.clientX+
j.scrollLeft,y:i.pageY||i.clientY+j.scrollTop}},stop:function(i){i.stopPropagation&&i.stopPropagation();i.cancelBubble=true;if(i.preventDefault)i.preventDefault();else i.returnValue=false}},h=function(i,l){var j=i.canvas;this.scene=i.scene;this.domElem=j;this.pos=z(j);this.opt=this.callbacks=l;this.size={width:j.width||j.offsetWidth,height:j.height||j.offsetHeight};this.attachEvents()};h.prototype={hovered:false,pressed:false,touched:false,touchMoved:false,moved:false,attachEvents:function(){var i=
this.domElem,l=this;if(this.opt.disableContextMenu)i.oncontextmenu=function(){return false};["mouseup","mousedown","mousemove","mouseover","mouseout","touchstart","touchmove","touchend"].forEach(function(c){i.addEventListener(c,function(k,p){l[c](l.eventInfo(c,k,p))},false)});["keydown","keyup"].forEach(function(c){document.addEventListener(c,function(k,p){l[c](l.eventInfo(c,k,p))},false)});var j="";j=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";i.addEventListener(j,
function(c,k){l.mousewheel(l.eventInfo("mousewheel",c,k))},false)},eventInfo:function(i,l,j){var c=this.domElem,k=this.scene,p=this.opt,o=this.getSize(),s=p.relative,x=p.centerOrigin,u=p.cachePosition&&this.pos||z(c),a=m.get(l,j),b=m.getPos(l,j);l={};j=b.x;c=b.y;if(s){j-=u.x;c-=u.y;if(x){j-=o.width/2;c-=o.height/2;c*=-1}}switch(i){case "mousewheel":l.wheel=m.getWheel(a);break;case "keydown":v.extend(l,m.getKey(a));break;case "mouseup":l.isRightClick=m.isRightClick(a)}var d;v.extend(l,{x:j,y:c,cache:false,
stop:function(){m.stop(a)},getTarget:function(){if(d)return d;return d=!p.picking||k.pick(b.x-u.x,b.y-u.y)||true}});l.event=a;return l},getSize:function(){if(this.cacheSize)return this.size;var i=this.domElem;return{width:i.width||i.offsetWidth,height:i.height||i.offsetHeight}},mouseup:function(i){if(!this.moved)if(i.isRightClick)this.callbacks.onRightClick(i,this.hovered);else this.callbacks.onClick(i,w(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(i,w(this.pressed));else this.callbacks.onDragCancel(i,
w(this.pressed));this.pressed=this.moved=false}},mouseout:function(i){for(var l=i.relatedTarget,j=this.domElem;l&&l.parentNode;){if(j==l.parentNode)return;l=l.parentNode}if(this.hovered){this.callbacks.onMouseLeave(i,this.hovered);this.hovered=false}},mouseover:function(){},mousemove:function(i){if(this.pressed){this.moved=true;this.callbacks.onDragMove(i,w(this.pressed))}else if(this.hovered){var l=w(i.getTarget());if(!l||l.id!=this.hovered.id){this.callbacks.onMouseLeave(i,this.hovered);if(this.hovered=
l)this.callbacks.onMouseEnter(i,this.hovered)}else this.callbacks.onMouseMove(i,this.hovered)}else if(this.hovered=w(i.getTarget()))this.callbacks.onMouseEnter(i,this.hovered)},mousewheel:function(i){this.callbacks.onMouseWheel(i)},mousedown:function(i){this.pressed=i.getTarget();this.callbacks.onDragStart(i,w(this.pressed))},touchstart:function(i){this.touched=i.getTarget();this.callbacks.onTouchStart(i,w(this.touched))},touchmove:function(i){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(i,
w(this.touched))}},touchend:function(i){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(i,w(this.touched));else this.callbacks.onTouchCancel(i,w(this.touched));this.touched=this.touchMoved=false}},keydown:function(i){this.callbacks.onKeyDown(i)},keyup:function(i){this.callbacks.onKeyUp(i)}};var f={};f.create=function(i,l){l=v.merge({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,onClick:v.empty,onRightClick:v.empty,
onDragStart:v.empty,onDragMove:v.empty,onDragEnd:v.empty,onDragCancel:v.empty,onTouchStart:v.empty,onTouchMove:v.empty,onTouchEnd:v.empty,onTouchCancel:v.empty,onMouseMove:v.empty,onMouseEnter:v.empty,onMouseLeave:v.empty,onMouseWheel:v.empty,onKeyDown:v.empty,onKeyUp:v.empty},l||{});var j=l.bind;if(j)for(var c in l)c.match(/^on[a-zA-Z0-9]+$/)&&function(k,p){l[k]=function(){return p.apply(j,Array.prototype.slice.call(arguments))}}(c,l[c]);new h(i,l)};f.Keys={enter:13,up:38,down:40,left:37,right:39,
esc:27,space:32,backspace:8,tab:9,"delete":46};PhiloGL.Events=f})();(function(){function w(){return arguments.length==2?{vs:arguments[0],fs:arguments[1]}:arguments[0]||{}}var z=function(f,i,l){var j=f.createShader(l);if(j==null)throw"Error creating the shader with shader type: "+l;f.shaderSource(j,i);f.compileShader(j);if(!f.getShaderParameter(j,f.COMPILE_STATUS)){i=f.getShaderInfoLog(j);f.deleteShader(j);throw"Error while compiling the shader "+i;}return j},m=function(f,i,l){var j=q.getUniformLocation(f,
i.name);f=i.type;var c=false,k=true,p,o;if(i.size>1&&l)switch(f){case q.FLOAT:p=q.uniform1fv;o=Float32Array;k=false;break;case q.INT:case q.BOOL:case q.SAMPLER_2D:case q.SAMPLER_CUBE:p=q.uniform1iv;o=Uint16Array;k=false}if(k)switch(f){case q.FLOAT:p=q.uniform1f;break;case q.FLOAT_VEC2:p=q.uniform2fv;o=l?Float32Array:new Float32Array(2);break;case q.FLOAT_VEC3:p=q.uniform3fv;o=l?Float32Array:new Float32Array(3);break;case q.FLOAT_VEC4:p=q.uniform4fv;o=l?Float32Array:new Float32Array(4);break;case q.INT:case q.BOOL:case q.SAMPLER_2D:case q.SAMPLER_CUBE:p=
q.uniform1i;break;case q.INT_VEC2:case q.BOOL_VEC2:p=q.uniform2iv;o=l?Uint16Array:new Uint16Array(2);break;case q.INT_VEC3:case q.BOOL_VEC3:p=q.uniform3iv;o=l?Uint16Array:new Uint16Array(3);break;case q.INT_VEC4:case q.BOOL_VEC4:p=q.uniform4iv;o=l?Uint16Array:new Uint16Array(4);break;case q.FLOAT_MAT2:c=true;p=q.uniformMatrix2fv;break;case q.FLOAT_MAT3:c=true;p=q.uniformMatrix3fv;break;case q.FLOAT_MAT4:c=true;p=q.uniformMatrix4fv}return l?function(s){p.call(q,j,new o(s))}:c?function(s){p.call(q,
j,false,s.toFloat32Array())}:o?function(s){o.set(s);p.call(q,j,o)}:function(s){p.call(q,j,s)};throw"Unknown type: "+f;},h=function(f,i){var l=q,j=l.createProgram();l.attachShader(j,z(l,f,l.VERTEX_SHADER));l.attachShader(j,z(l,i,l.FRAGMENT_SHADER));l.linkProgram(j);if(!l.getProgramParameter(j,l.LINK_STATUS))throw"Error linking the shader: "+l.getProgramInfoLog(j);if(!j)return false;l={};for(var c={},k=q.getProgramParameter(j,q.ACTIVE_ATTRIBUTES),p=0;p<k;p++){var o=q.getActiveAttrib(j,p),s=o.name;o=
q.getAttribLocation(j,o.name);l[s]=o}k=q.getProgramParameter(j,q.ACTIVE_UNIFORMS);for(p=0;p<k;p++){o=q.getActiveUniform(j,p);s=o.name;s=s[s.length-1]=="]"?s.substr(0,s.length-3):s;c[s]=m(j,o,o.name!=s)}this.program=j;this.attributes=l;this.uniforms=c};h.prototype={$$family:"program",setUniform:function(f,i){if(this.uniforms[f])this.uniforms[f](i);return this},setUniforms:function(f){for(var i in f)this.setUniform(i,f[i]);return this}};["setBuffer","setBuffers","use"].forEach(function(f){h.prototype[f]=
function(){var i=Array.prototype.slice.call(arguments);i.unshift(this);Z[f].apply(Z,i);return this}});["setFrameBuffer","setFrameBuffers","setRenderBuffer","setRenderBuffers","setTexture","setTextures"].forEach(function(f){h.prototype[f]=function(){Z[f].apply(Z,arguments);return this}});h.fromShaderIds=function(){var f=w.apply({},arguments),i=v(f.vs);f=v(f.fs);return new h(i.innerHTML,f.innerHTML)};h.fromShaderSources=function(f){f=w.apply({},arguments);return new h(f.vs,f.fs)};h.fromDefaultShaders=
function(){var f=w.apply({},arguments),i=PhiloGL.Shaders;return PhiloGL.Program.fromShaderSources(i.Vertex[f.vs||"Default"],i.Fragment[f.fs||"Default"])};h.fromShaderURIs=function(f){f=v.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:v.empty,onError:v.empty},f||{});var i=f.path+f.fs,l=PhiloGL.IO.XHR;(new l({url:f.path+f.vs,noCache:f.noCache,onError:function(j){f.onError(j)},onSuccess:function(j){(new l({url:i,noCache:f.noCache,onError:function(c){f.onError(c)},onSuccess:function(c){f.onSuccess(h.fromShaderSources(j,
c),f)}})).send()}})).send()};PhiloGL.Program=h})();(function(){var w={},z=function(f){this.opt=f=v.merge({url:"http://sencha.com/",method:"GET",async:true,noCache:false,sendAsBinary:false,onProgress:v.empty,onSuccess:v.empty,onError:v.empty,onAbort:v.empty,onComplete:v.empty},f||{});this.initXHR()};z.State={};["UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(f,i){z.State[f]=i});z.prototype={initXHR:function(){var f=this.req=new XMLHttpRequest,i=this;["Progress","Error",
"Abort","Load"].forEach(function(l){f.addEventListener(l.toLowerCase(),function(j){i["handle"+l](j)},false)})},send:function(f){var i=this.req,l=this.opt,j=l.async;if(l.noCache)l.url+=(l.url.indexOf("?")>=0?"&":"?")+v.uid();i.open(l.method,l.url,j);if(j)i.onreadystatechange=function(){if(i.readyState==z.State.COMPLETED)if(i.status==200)l.onSuccess(i.responseText);else l.onError(i.status)};l.sendAsBinary?i.sendAsBinary(f||l.body||null):i.send(f||l.body||null);if(!j)if(i.status==200)l.onSuccess(i.responseText);
else l.onError(i.status)},setRequestHeader:function(f,i){this.req.setRequestHeader(f,i);return this},handleProgress:function(f){if(f.lengthComputable)this.opt.onProgress(f,Math.round(f.loaded/f.total*100));else this.opt.onProgress(f,-1)},handleError:function(f){this.opt.onError(f)},handleAbort:function(){this.opt.onAbort(e)},handleLoad:function(f){this.opt.onComplete(f)}};var m=function(f){f=v.merge({url:"http://sencha.com/",data:{},noCache:false,onComplete:v.empty,callbackKey:"callback"},f||{});
var i=m.counter++,l=[],j;for(j in f.data)l.push(j+"="+f.data[j]);l=l.join("&");if(f.noCache)l+=(l.indexOf("?")>=0?"&":"?")+v.uid();l=f.url+(f.url.indexOf("?")>-1?"&":"?")+f.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+i+(l.length>0?"&"+l:"");var c=document.createElement("script");c.type="text/javascript";c.src=l;m.requests["request_"+i]=function(k){f.onComplete(k);c.parentNode&&c.parentNode.removeChild(c);c.clearAttributes&&c.clearAttributes()};document.getElementsByTagName("head")[0].appendChild(c)};
m.counter=0;m.requests={};var h=function(f){f=v.merge({src:[],noCache:false,onProgress:v.empty,onComplete:v.empty},f||{});var i=0,l=f.src.length,j=function(){f.onProgress(Math.round(++i/l*100));if(i==l)f.onComplete(o)},c=function(){if(++i==l)f.onComplete(o)},k=f.noCache,p=v.uid(),o=f.src.map(function(s,x){var u=new Image;u.index=x;u.onload=j;u.onerror=c;u.src=s+(k?(s.indexOf("?")>=0?"&":"?")+p:"");return u});return o};w.XHR=z;w.JSONP=m;w.Images=h;w.Textures=function(f){f=v.merge({src:[],noCache:false,
onComplete:v.empty},f||{});h({src:f.src,noCache:f.noCache,onComplete:function(i){var l={};i.forEach(function(j,c){l[f.src[c]]=v.merge({data:{value:j}},f)});Z.setTextures(l);f.onComplete()}})};PhiloGL.IO=w})();(function(){var w=PhiloGL.Vec3,z=PhiloGL.Mat4,m=function(h,f,i,l,j){j=j||{};var c=j.position,k=j.target;j=j.up;this.fov=h;this.near=i;this.far=l;this.aspect=f;this.position=c&&new w(c.x,c.y,c.z)||new w;this.target=k&&new w(k.x,k.y,k.z)||new w;this.up=j&&new w(j.x,j.y,j.z)||new w(0,1,0);this.projection=
(new z).perspective(h,f,i,l);this.modelView=new z};m.prototype={update:function(){this.projection=(new z).perspective(this.fov,this.aspect,this.near,this.far);this.modelView.lookAt(this.position,this.target,this.up)}};PhiloGL.Camera=m})();(function(){function w(c,k){if(c&&c.length<k){for(var p=c[0],o=c[1],s=c[2],x=c[3],u=[p,o,s,x],a=k/c.length,b;--a;){b=a*4;u[b]=p;u[b+1]=o;u[b+2]=s;u[b+3]=x}return new Float32Array(u)}else return c}var z=PhiloGL.Vec3,m=PhiloGL.Mat4,h=Math.cos,f=Math.sin,i=Math.PI,
l=Array.prototype.slice,j={};j.Model=function(c){c=c||{};this.id=c.id||v.uid();this.pickable=!!c.pickable;this.pick=c.pick||function(){return false};if(c.pickingColors)this.pickingColors=c.pickingColors;this.vertices=c.vertices;this.normals=c.normals;this.textures=c.textures&&v.splat(c.textures);this.colors=c.colors;this.indices=c.indices;this.shininess=c.shininess||0;if(c.texCoords)this.texCoords=c.texCoords;this.uniforms=c.uniforms||{};this.attributes=c.attributes||{};this.render=c.render;this.drawType=
c.drawType||"TRIANGLES";this.display="display"in c?c.display:true;this.onBeforeRender=c.onBeforeRender||v.empty;this.onAfterRender=c.onAfterRender||v.empty;if(c.program)this.program=c.program;this.position=new z;this.rotation=new z;this.scale=new z(1,1,1);this.matrix=new m;c.computeCentroids&&this.computeCentroids();c.computeNormals&&this.computeNormals()};j.Model.prototype=Object.create(null,{vertices:{set:function(c){if(c){var k=c.length;if(c.BYTES_PER_ELEMENT)this.$vertices=c;else if(this.$verticesLength==
k)this.$vertices.set(c);else this.$vertices=new Float32Array(c);this.$verticesLength=k}},get:function(){return this.$vertices}},normals:{set:function(c){if(c){var k=c.length;if(c.BYTES_PER_ELEMENT)this.$normals=c;else if(this.$normalsLength==k)this.$normals.set(c);else this.$normals=new Float32Array(c);this.$normalsLength=k}},get:function(){return this.$normals}},colors:{set:function(c){if(c){var k=c.length;if(c.BYTES_PER_ELEMENT)this.$colors=c;else if(this.$colorsLength==k)this.$colors.set(c);else this.$colors=
new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=k)this.$colors=w(l.call(this.$colors),this.$verticesLength/3*4);this.$colorsLength=this.$colors.length}},get:function(){return this.$colors}},pickingColors:{set:function(c){if(c){var k=c.length;if(c.BYTES_PER_ELEMENT)this.$pickingColors=c;else if(this.$pickingColorsLength==k)this.$pickingColors.set(c);else this.$pickingColors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=k)this.$pickingColors=w(l.call(this.$pickingColors),
this.$verticesLength/3*4);this.$pickingColorsLength=this.$pickingColors.length}},get:function(){return this.$pickingColors}},texCoords:{set:function(c){if(c)if(v.type(c)=="object"){var k={},p;for(p in c){var o=c[p];k[p]=o.BYTES_PER_ELEMENT?o:new Float32Array(o)}this.$texCoords=k}else{k=c.length;if(c.BYTES_PER_ELEMENT)this.$texCoords=c;else if(this.$texCoordsLength==k)this.$texCoords.set(c);else this.$texCoords=new Float32Array(c);this.$texCoordsLength=k}},get:function(){return this.$texCoords}},indices:{set:function(c){if(c){var k=
c.length;if(c.BYTES_PER_ELEMENT)this.$indices=c;else if(this.$indicesLength==k)this.$indices.set(c);else this.$indices=new Uint16Array(c);this.$indicesLength=k}},get:function(){return this.$indices}}});v.extend(j.Model.prototype,{$$family:"model",update:function(){var c=this.matrix,k=this.position,p=this.rotation,o=this.scale;c.id();c.$translate(k.x,k.y,k.z);c.$rotateXYZ(p.x,p.y,p.z);c.$scale(o.x,o.y,o.z)},computeCentroids:function(){var c=this.vertices,k=[];this.faces.forEach(function(p){var o=[0,
0,0],s=0;p.forEach(function(x){x=c[x];o[0]+=x[0];o[1]+=x[1];o[2]+=x[2];s++});o[0]/=s;o[1]/=s;o[2]/=s;k.push(o)});this.centroids=k},computeNormals:function(){var c=this.vertices,k=[];this.faces.forEach(function(p){var o=c[p[0]],s=c[p[1]];p=c[p[2]];o={x:o[0]-s[0],y:o[1]-s[1],z:o[2]-s[2]};z.$cross(o,{x:p[0]-s[0],y:p[1]-s[1],z:p[1]-s[2]});z.norm(o)>1.0E-6&&z.unit(o);k.push([o.x,o.y,o.z])});this.normals=k}});v.extend(j.Model.prototype,{setUniforms:function(c){c.setUniforms(this.uniforms)},setAttributes:function(c){var k=
this.attributes,p;for(p in k){var o=k[p],s=this.id+"-"+p;if(Object.keys(o).length){o.attribute=p;c.setBuffer(s,o);delete o.value}else c.setBuffer(s,true)}},unsetAttributes:function(c){var k=this.attributes,p;for(p in k)c.setBuffer(this.id+"-"+p,false)},setShininess:function(c){c.setUniform("shininess",this.shininess||0)},setVertices:function(c,k){if(this.vertices)k||this.dynamic?c.setBuffer("vertices-"+this.id,{attribute:"position",value:this.vertices,size:3}):c.setBuffer("vertices-"+this.id)},unsetVertices:function(c){c.setBuffer("vertices-"+
this.id,false)},setNormals:function(c,k){if(this.normals)k||this.dynamic?c.setBuffer("normals-"+this.id,{attribute:"normal",value:this.normals,size:3}):c.setBuffer("normals-"+this.id)},unsetNormals:function(c){c.setBuffer("normals-"+this.id,false)},setIndices:function(c,k){if(this.indices)k||this.dynamic?c.setBuffer("indices-"+this.id,{bufferType:q.ELEMENT_ARRAY_BUFFER,drawType:q.STATIC_DRAW,value:this.indices,size:1}):c.setBuffer("indices-"+this.id)},unsetIndices:function(c){c.setBuffer("indices-"+
this.id,false)},setPickingColors:function(c,k){if(this.pickingColors)k||this.dynamic?c.setBuffer("pickingColors-"+this.id,{attribute:"pickingColor",value:this.pickingColors,size:4}):c.setBuffer("pickingColors-"+this.id)},unsetPickingColors:function(c){c.setBuffer("pickingColors-"+this.id,false)},setColors:function(c,k){if(this.colors)k||this.dynamic?c.setBuffer("colors-"+this.id,{attribute:"color",value:this.colors,size:4}):c.setBuffer("colors-"+this.id)},unsetColors:function(c){c.setBuffer("colors-"+
this.id,false)},setTexCoords:function(c,k){if(this.texCoords){var p=this.id;if(k||this.dynamic)v.type(this.texCoords)=="object"?this.textures.forEach(function(o,s){c.setBuffer("texCoords-"+s+"-"+p,{attribute:"texCoord"+(s+1),value:this.texCoords[o],size:2})}):c.setBuffer("texCoords-"+p,{attribute:"texCoord1",value:this.texCoords,size:2});else v.type(this.texCoords)=="object"?this.textures.forEach(function(o,s){c.setBuffer("texCoords-"+s+"-"+p)}):c.setBuffer("texCoords-"+p)}},unsetTexCoords:function(c){c.setBuffer("texCoords-"+
this.id,false)},setTextures:function(c){this.textures=this.textures?v.splat(this.textures):[];for(var k=0,p=this.textures,o=p.length,s=PhiloGL.Scene.MAX_TEXTURES;k<s;k++)if(k<o){c.setUniform("hasTexture"+(k+1),true);c.setUniform("sampler"+(k+1),k);c.setTexture(p[k],q["TEXTURE"+k])}else c.setUniform("hasTexture"+(k+1),false)}});j.Cube=function(c){j.Model.call(this,v.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,
-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c||{}))};j.Cube.prototype=Object.create(j.Model.prototype);
j.Sphere=function(c){var k=c.nlat||10,p=c.nlong||10,o=c.radius||1,s=i-0,x=2*i-0,u=(k+1)*(p+1),a=new Float32Array(u*3),b=new Float32Array(u*3);u=new Float32Array(u*2);var d=new Uint16Array(k*p*6);if(typeof o=="number"){var g=o;o=function(){return g}}for(var n=0;n<=k;n++)for(var r=0;r<=p;r++){var t=r/p,y=n/k,A=x*t,B=s*y,D=f(A);A=h(A);var F=f(B),C=h(B);B=A*F;A=C;D*=F;F=o(B,A,D,t,y);C=r+n*(p+1);var G=C*3;C*=2;a[G+0]=F*B;a[G+1]=F*A;a[G+2]=F*D;b[G+0]=B;b[G+1]=A;b[G+2]=D;u[C+0]=t;u[C+1]=y}o=k+1;for(r=0;r<
k;r++)for(n=0;n<p;n++){C=(r*p+n)*6;d[C+0]=n*o+r;d[C+1]=n*o+r+1;d[C+2]=(n+1)*o+r;d[C+3]=(n+1)*o+r;d[C+4]=n*o+r+1;d[C+5]=(n+1)*o+r+1}j.Model.call(this,v.extend({vertices:a,indices:d,normals:b,texCoords:u},c||{}))};j.Sphere.prototype=Object.create(j.Model.prototype);j.IcoSphere=function(c){var k=c.iterations||0,p=[],o=[],s=Math.sqrt,x=Math.acos,u=Math.atan2,a=Math.PI,b=a*2;c.onAddVertex=c.onAddVertex||v.empty;var d=(1+s(5))/2,g=s(1+d*d);p.push(-1/g,d/g,0,1/g,d/g,0,-1/g,-d/g,0,1/g,-d/g,0,0,-1/g,d/g,0,
1/g,d/g,0,-1/g,-d/g,0,1/g,-d/g,d/g,0,-1/g,d/g,0,1/g,-d/g,0,-1/g,-d/g,0,1/g);o.push(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1);var n=function(){var U={};return function(M,N){M*=3;N*=3;var E=(M<N?M:N)+"|"+(M>N?M:N);if(E in U)return U[E];var W=(p[M]+p[N])/2,X=(p[M+1]+p[N+1])/2,Y=(p[M+2]+p[N+2])/2,aa=s(W*W+X*X+Y*Y);W/=aa;X/=aa;Y/=aa;p.push(W,X,Y);return U[E]=p.length/3-1}}();for(d=0;d<k;d++){var r=[],t=0;for(g=o.length;t<
g;t+=3){var y=n(o[t],o[t+1]),A=n(o[t+1],o[t+2]),B=n(o[t+2],o[t]);r.push(o[t],y,B,o[t+1],A,y,o[t+2],B,A,y,A,B)}o=r}g=o.length;k=new Float32Array(g*3);n=new Float32Array(g*2);for(d=0;d<g;d+=3){A=o[d];B=o[d+1];var D=o[d+2];r=A*3;t=B*3;y=D*3;A*=2;B*=2;D*=2;var F=p[r],C=p[r+1],G=p[r+2],J=x(G/s(F*F+C*C+G*G)),K=u(C,F);J/=a;K=1-K/b;var I=p[t],H=p[t+1],L=p[t+2],O=x(L/s(I*I+H*H+L*L)),S=u(H,I);O/=a;S=1-S/b;var P=p[y],Q=p[y+1],R=p[y+2],V=x(R/s(P*P+Q*Q+R*R)),T=u(Q,P);V/=a;T=1-T/b;F=z.cross({x:P-I,y:Q-H,z:R-L},
{x:F-I,y:C-H,z:G-L}).$unit();k[r]=k[t]=k[y]=F.x;k[r+1]=k[t+1]=k[y+1]=F.y;k[r+2]=k[t+2]=k[y+2]=F.z;n[A]=K;n[A+1]=J;n[B]=S;n[B+1]=O;n[D]=T;n[D+1]=V}j.Model.call(this,v.extend({vertices:p,indices:o,normals:k,texCoords:n},c||{}))};j.IcoSphere.prototype=Object.create(j.Model.prototype);j.TruncatedCone=function(c){var k=c.bottomRadius||0,p=c.topRadius||0,o=c.height||1,s=c.nradial||10,x=c.nvertical||10,u=!!c.topCap,a=!!c.bottomCap,b=(u?2:0)+(a?2:0),d=(s+1)*(x+1+b),g=new Float32Array(d*3),n=new Float32Array(d*
3);d=new Float32Array(d*2);var r=new Uint16Array(s*(x+b)*6),t=s+1,y=Math,A=y.atan2(k-p,o),B=y.sin,D=y.cos;y=y.PI;var F=D(A);A=B(A);a=x+(a?2:0);var C=0,G=0;for(u=u?-2:0;u<=a;u++){var J=u/x,K=o*J,I;if(u<0){K=0;J=1;I=k}else if(u>x){K=o;J=1;I=p}else I=k+(p-k)*(u/x);if(u==-2||u==x+2)J=I=0;K-=o/2;for(var H=0;H<t;H++){var L=B(H*y*2/s),O=D(H*y*2/s);g[C+0]=L*I;g[C+1]=K;g[C+2]=O*I;n[C+0]=u<0||u>x?0:L*F;n[C+1]=u<0?-1:u>x?1:A;n[C+2]=u<0||u>x?0:O*F;d[G+0]=H/s;d[G+1]=J;G+=2;C+=3}}for(u=0;u<x+b;u++)for(H=0;H<s;H++){k=
(u*s+H)*6;r[k+0]=t*(u+0)+0+H;r[k+1]=t*(u+0)+1+H;r[k+2]=t*(u+1)+1+H;r[k+3]=t*(u+0)+0+H;r[k+4]=t*(u+1)+1+H;r[k+5]=t*(u+1)+0+H}j.Model.call(this,v.extend({vertices:g,normals:n,texCoords:d,indices:r},c||{}))};j.TruncatedCone.prototype=Object.create(j.Model.prototype);j.Cone=function(c){c.topRadius=0;c.topCap=!!c.cap;c.bottomCap=!!c.cap;c.bottomRadius=c.radius||3;j.TruncatedCone.call(this,c)};j.Cone.prototype=Object.create(j.TruncatedCone.prototype);j.Cylinder=function(c){c.bottomRadius=c.radius;c.topRadius=
c.radius;j.TruncatedCone.call(this,c)};j.Cylinder.prototype=Object.create(j.TruncatedCone.prototype);j.Plane=function(c){var k=c.type,p=k.split(","),o=c[p[0]+"len"],s=c[p[1]+"len"],x=c["n"+p[0]]||1;p=c["n"+p[1]]||1;var u=c.offset;numVertices=(x+1)*(p+1);positions=new Float32Array(numVertices*3);normals=new Float32Array(numVertices*3);texCoords=new Float32Array(numVertices*2);for(var a=i3=i2=0;a<=p;a++)for(var b=0;b<=x;b++){var d=b/x,g=a/p;texCoords[i2+0]=d;texCoords[i2+1]=g;i2+=2;switch(k){case "x,y":positions[i3+
0]=o*d-o*0.5;positions[i3+1]=s*g-s*0.5;positions[i3+2]=u;normals[i3+0]=0;normals[i3+1]=0;normals[i3+2]=1;break;case "x,z":positions[i3+0]=o*d-o*0.5;positions[i3+1]=u;positions[i3+2]=s*g-s*0.5;normals[i3+0]=0;normals[i3+1]=1;normals[i3+2]=0;break;case "y,z":positions[i3+0]=u;positions[i3+1]=o*d-o*0.5;positions[i3+2]=s*g-s*0.5;normals[i3+0]=1;normals[i3+1]=0;normals[i3+2]=0}i3+=3}k=x+1;o=[];for(a=0;a<p;a++)for(b=0;b<x;b++){s=(a*x+b)*6;o[s+0]=(a+0)*k+b;o[s+1]=(a+1)*k+b;o[s+2]=(a+0)*k+b+1;o[s+3]=(a+1)*
k+b;o[s+4]=(a+1)*k+b+1;o[s+5]=(a+0)*k+b+1}j.Model.call(this,v.extend({vertices:positions,normals:normals,texCoords:texCoords,indices:o},c))};j.Plane.prototype=Object.create(j.Model.prototype);j.id=v.time();PhiloGL.O3D=j})();(function(){var w={Vertex:{},Fragment:{}},z=w.Fragment;w.Vertex.Default="#define LIGHT_MAX 40\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec4 pickingColor;\nattribute vec2 texCoord1;\nuniform mat4 modelViewMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 normalMatrix;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nvec4 transformedNormal = normalMatrix * vec4(normal, 1.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nvColor = color;\nvPickingColor = pickingColor;\nvTexCoord = texCoord1;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";
z.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif(!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif(enablePicking) {\nif(hasPickingColors) {\ngl_FragColor = vPickingColor;\n} else {\ngl_FragColor = vec4(pickColor, 1.0);\n}\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
PhiloGL.Shaders=w})();(function(){var w=PhiloGL.Vec3,z=PhiloGL.Mat4,m=function(h,f,i){i=v.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},i||{});this.program=i.program?h[i.program]:h;this.camera=f;this.models=[];this.config=i};m.prototype={add:function(){for(var h=0,f=this.models,i=arguments.length;h<i;h++){var l=arguments[h];l.id=l.id||v.uid();f.push(l);this.defineBuffers(l)}},remove:function(h){var f=this.models;
h=f.indexOf(h);h>-1&&f.splice(h,1)},getProgram:function(h){var f=this.program;if(f.$$family!="program"&&h&&h.program){f=f[h.program];f.use()}return f},defineBuffers:function(h){var f=this.getProgram(h);h.setAttributes(f,true);h.setVertices(f,true);h.setColors(f,true);h.setPickingColors(f,true);h.setNormals(f,true);h.setTexCoords(f,true);h.setIndices(f,true)},beforeRender:function(h){this.setupLighting(h);this.setupEffects(h);var f=this.camera;h.setUniform("projectionMatrix",f.projection);h.setUniform("viewMatrix",
f.modelView)},setupLighting:function(h){var f=this.config.lights,i=f.ambient,l=f.directional,j=l.color,c=l.direction,k=f.enable;f=f.points&&v.splat(f.points)||[];l=f.length;var p=[],o=[],s=[],x=[];c=w.unit([c.x,c.y,c.z]).$scale(-1);h.setUniform("enableLights",k);if(k){h.setUniform("ambientColor",[i.r,i.g,i.b]);h.setUniform("directionalColor",[j.r,j.g,j.b]);h.setUniform("lightingDirection",[c.x,c.y,c.z]);h.setUniform("numberPoints",l);for(i=0;i<l;i++){k=f[i];j=k.position;c=k.color||k.diffuse;k=k.specular;
p.push(j.x,j.y,j.z);o.push(c.r,c.g,c.b);s.push(+!!k);k?x.push(k.r,k.g,k.b):x.push(0,0,0)}h.setUniforms({pointLocation:p,pointColor:o});h.setUniforms({enableSpecular:s,pointSpecularColor:x})}},setupEffects:function(h){var f=this.config.effects.fog,i=f.color||{r:0.5,g:0.5,b:0.5};f?h.setUniforms({hasFog:true,fogNear:f.near,fogFar:f.far,fogColor:[i.r,i.g,i.b]}):h.setUniform("hasFog",false)},render:function(h){h=h||{};var f=this.camera,i=this.program,l=h.renderProgram,j=v.type(i),c=!l&&j=="object",k=v.merge({onBeforeRender:v.empty,
onAfterRender:v.empty},h||{});!c&&this.beforeRender(l||i);this.models.forEach(function(p,o){if(p.display){var s=l||this.getProgram(p);c&&this.beforeRender(s);p.onBeforeRender(s,f);k.onBeforeRender(p,o);this.renderObject(p,s);k.onAfterRender(p,o);p.onAfterRender(s,f)}},this)},renderToTexture:function(h,f){f=f||{};var i=Z.textures[h+"-texture"],l=Z.textureMemo[h+"-texture"];this.render(f);q.bindTexture(l.textureType,i);q.generateMipmap(l.textureType);q.bindTexture(l.textureType,null)},renderObject:function(h,
f){var i=this.camera,l=new z;h.setUniforms(f);h.setAttributes(f);h.setShininess(f);h.setVertices(f);h.setColors(f);h.setPickingColors(f);h.setNormals(f);h.setTextures(f);h.setTexCoords(f);h.setIndices(f);l.mulMat42(i.modelView,h.matrix);f.setUniform("modelViewMatrix",l);f.setUniform("normalMatrix",l.invert().$transpose());if(h.render)h.render(q,f,i);else h.indices?q.drawElements(h.drawType!==undefined?q.get(h.drawType):q.TRIANGLES,h.indices.length,q.UNSIGNED_SHORT,0):q.drawArrays(h.drawType!==undefined?
q.get(h.drawType):q.TRIANGLES,0,h.vertices.length/3);h.unsetAttributes(f);h.unsetVertices(f);h.unsetColors(f);h.unsetPickingColors(f);h.unsetNormals(f);h.unsetTexCoords(f);h.unsetIndices(f)},setupPicking:function(){var h=PhiloGL.Program.fromDefaultShaders();Z.setFrameBuffer("$picking",{width:1,height:1,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:true});Z.setFrameBuffer("$picking",false);
this.pickingProgram=h},pick:function(h,f){this.pickingProgram||this.setupPicking();var i={},l=[],j=Z.usedProgram,c=this.pickingProgram,k=this.config,p=k.lights.enable,o=k.effects.fog,s=q.canvas.width,x=q.canvas.height,u=[],a=new Uint8Array(4),b=0,d;k.lights.enable=false;k.effects.fog=false;c.use();Z.setFrameBuffer("$picking",true);c.setUniform("enablePicking",true);q.disable(q.BLEND);q.viewport(-h,f-x,s,x);q.clear(q.COLOR_BUFFER_BIT|q.DEPTH_BUFFER_BIT);q.readPixels(0,0,1,1,q.RGBA,q.UNSIGNED_BYTE,
a);d=a[0]+a[1]*256+a[2]*65536;this.renderToTexture("$picking",{renderProgram:c,onBeforeRender:function(r,t){if(t==d)b=1;var y=t+b,A=!!r.pickingColors;c.setUniform("hasPickingColors",A);if(A)l.push(r);else{u[0]=y%256;u[1]=(y/256>>0)%256;u[2]=(y/65536>>0)%256;c.setUniform("pickColor",[u[0]/255,u[1]/255,u[2]/255]);i[u.join()]=r}}});q.readPixels(0,0,1,1,q.RGBA,q.UNSIGNED_BYTE,a);s=[a[0],a[1],a[2]].join();s=i[s];if(!s)for(var g=0,n=l.length;g<n;g++){s=l[g];x=s.pick(a);if(x!==false)s.$pickingIndex=x;else s=
false}Z.setFrameBuffer("$picking",false);c.setUniform("enablePicking",false);k.lights.enable=p;k.effects.fog=o;j&&j.use();return s&&s.pickable&&s}};m.MAX_TEXTURES=3;m.MAX_POINT_LIGHTS=50;PhiloGL.Scene=m})();(function(){function w(z,m){for(var h=this.workers=[];m--;)h.push(new Worker(z))}w.prototype={map:function(z){var m=this.workers,h=this.configs=[],f=0;for(m=m.length;f<m;f++)h.push(z&&z(f));return this},reduce:function(z){for(var m=z.reduceFn,h=this.workers,f=this.configs,i=h.length,l=z.initialValue,
j=function(o){i--;l=l===undefined?o.data:m(l,o.data);if(i==0)z.onComplete(l)},c=0,k=i;c<k;c++){var p=h[c];p.onmessage=j;p.postMessage(f[c])}return this}};PhiloGL.WorkerGroup=w})();(function(){var w=function(f){this.opt=v.merge({duration:1E3,transition:function(i){return i},onCompute:v.empty,onComplete:v.empty},f||{})};w.prototype={timer:null,time:null,start:function(f){this.opt=v.merge(this.opt,f||{});this.time=v.time();this.animating=true},step:function(){if(this.animating){var f=v.time(),i=this.time,
l=this.opt;if(f<i+l.duration){f=l.transition((f-i)/l.duration);l.onCompute.call(this,f)}else{this.animating=false;l.onCompute.call(this,1);l.onComplete.call(this)}}}};w.compute=function(f,i,l){return f+(i-f)*l};w.Transition={linear:function(f){return f}};var z=w.Transition;(function(){var f=function(j,c){c=v.splat(c);return v.extend(j,{easeIn:function(k){return j(k,c)},easeOut:function(k){return 1-j(1-k,c)},easeInOut:function(k){return k<=0.5?j(2*k,c)/2:(2-j(2*(1-k),c))/2}})},i={Pow:function(j,c){return Math.pow(j,
c[0]||6)},Expo:function(j){return Math.pow(2,8*(j-1))},Circ:function(j){return 1-Math.sin(Math.acos(j))},Sine:function(j){return 1-Math.sin((1-j)*Math.PI/2)},Back:function(j,c){c=c[0]||1.618;return Math.pow(j,2)*((c+1)*j-c)},Bounce:function(j){for(var c,k=0,p=1;;k+=p,p/=2)if(j>=(7-4*k)/11){c=p*p-Math.pow((11-6*k-11*j)/4,2);break}return c},Elastic:function(j,c){return Math.pow(2,10*--j)*Math.cos(20*j*Math.PI*(c[0]||1)/3)}},l;for(l in i)z[l]=f(i[l]);["Quad","Cubic","Quart","Quint"].forEach(function(j,
c){z[j]=f(function(k){return Math.pow(k,[c+2])})})})();var m=self||window;if(m){var h=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(f){if(f in m){w.animationTime=function(){return m[f]};h=true}});if(!h)w.animationTime=v.time;h=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(f){if(f in m){w.requestAnimationFrame=function(i){m[f](function(){i()})};
h=true}});if(!h)w.requestAnimationFrame=function(f){setTimeout(function(){f()},1E3/60)}}PhiloGL.Fx=w})()})();
