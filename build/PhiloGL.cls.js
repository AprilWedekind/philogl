/*

 Copyright (c) 2011 Sencha Inc. - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
(function(){function v(x){return document.getElementById(x)}this.PhiloGL=null;(function(){PhiloGL=function(x,z){function q(r,y,t){var a=r.canvas,b=new PhiloGL.Camera(d.fov,a.width/a.height,d.near,d.far,d);b.update();var f=new PhiloGL.Scene(y,b,c);T=new PhiloGL.WebGL.Application({gl:r,canvas:a,program:y,scene:f,camera:b});y.$$family=="program"&&y.use();g&&PhiloGL.Events.create(T,v.extend(g,{bind:T}));if(l.src.length)new PhiloGL.IO.Textures(v.extend(l,{onComplete:function(){t(T)}}));else t(T)}z=v.merge({context:{},
camera:{fov:45,near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:v.empty,onError:v.empty},z||{});var j=z.context,d=z.camera,g=z.events,l=z.textures,i=v.splat(z.program),c=z.scene;o=PhiloGL.WebGL.getContext(x,j);if(!o){z.onError("The WebGL context couldn't been initialized");return null}var h={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},n=i.length,m=function(){var r=n,y={},t=false;
return{onSuccess:function(a,b){y[b.id||n-r]=a;r--;if(r==0&&!t)q(o,n==1?a:y,function(f){z.onLoad(f)})},onError:function(){r--;z.onError(z.id);t=true}}}();i.forEach(function(r){var y=r.from,t;for(t in h)if(y==t){program=PhiloGL.Program[h[t]](v.extend(m,r));break}if(program)m.onSuccess(program,r)})}})();PhiloGL.unpack=function(x){x=x||window||self;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx"].forEach(function(z){x[z]=PhiloGL[z]})};PhiloGL.version=
"1.2.1";var o,T;v.empty=function(){};v.time=Date.now||function(){return+new Date};v.uid=function(){var x=v.time();return function(){return x++}}();v.extend=function(x,z){for(var q in z)x[q]=z[q];return x};v.type=function(){var x=Object.prototype.toString;return function(z){var q;q=x.call(z);q=q.substr(8,q.length-9).toLowerCase();if(q!="object")return q;if(z.$$family)return z.$$family;return z&&z.nodeName&&z.nodeType==1?"element":q}}();(function(){function x(z){var q=v.type(z);if(q=="object"){q={};
for(var j in z)q[j]=x(z[j]);return q}else if(q=="array"){q=[];j=0;for(var d=z.length;j<d;j++)q[j]=x(z[j]);return q}else return z}v.merge=function(){for(var z={},q=0,j=arguments.length;q<j;q++){var d=arguments[q];if(v.type(d)=="object")for(var g in d){var l=d[g],i=z[g];z[g]=i&&v.type(l)=="object"&&v.type(i)=="object"?v.merge(i,l):x(l)}}return z}})();v.splat=function(){var x=Array.isArray;return function(z){return x(z)&&z||[z]}}();(function(){function x(q){for(var j in q)this[j]=q[j];this.buffers={};
this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}var z={getContext:function(q,j){q=typeof q=="string"?v(q):q;var d;(d=q.getContext("experimental-webgl",j))||(d=q.getContext("webgl",j));if(d&&j&&j.debug){o={};for(var g in d){var l=d[g];o[g]=typeof l=="function"?function(i,c){return function(){console.log(i,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var h=c.apply(d,
arguments)}catch(n){throw i+" "+n;}for(var m=[],r;(r=d.getError())!==d.NO_ERROR;)m.push(r);if(m.length)throw m.join();return h}}(g,l):l}}else o=d;if(o)o.get=function(i){return typeof i=="string"?o[i]:i};return o}};x.prototype={$$family:"application",setBuffer:function(q,j,d){if(d===false||d===null){(d=this.bufferMemo[j])&&o.bindBuffer(d.bufferType,null);var g=d&&d.attribute||j;q=q.attributes[g];q!==undefined&&o.disableVertexAttribArray(q)}else{d=v.merge({bufferType:o.ARRAY_BUFFER,size:1,dataType:o.FLOAT,
stride:0,offset:0,drawType:o.STATIC_DRAW},this.bufferMemo[j]||{},d||{});g=d.attribute||j;var l=d.bufferType,i=j in this.buffers,c=i?this.buffers[j]:o.createBuffer(),h="value"in d,n=d.value,m=d.size,r=d.dataType,y=d.stride,t=d.offset,a=d.drawType;q=q.attributes[g];var b=q!==undefined;i||(this.buffers[j]=c);b&&o.enableVertexAttribArray(q);o.bindBuffer(l,c);h&&o.bufferData(l,n,a);b&&o.vertexAttribPointer(q,m,r,false,y,t);delete d.value;this.bufferMemo[j]=d;if(b)this.bufferMemo[g]=d;return this}},setBuffers:function(q,
j){for(var d in j)this.setBuffer(q,d,j[d]);return this},setFrameBuffer:function(q,j){if(typeof j!="object")o.bindFramebuffer(o.FRAMEBUFFER,j?this.frameBuffers[q]:null);else{j=v.merge({width:0,height:0,bindToTexture:false,textureOptions:{attachment:o.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:o.DEPTH_ATTACHMENT}},this.frameBufferMemo[q]||{},j||{});var d=j.bindToTexture,g=j.bindToRenderBuffer,l=q in this.frameBuffers,i=l?this.frameBuffers[q]:o.createFramebuffer(o.FRAMEBUFFER);
o.bindFramebuffer(o.FRAMEBUFFER,i);l||(this.frameBuffers[q]=i);if(d){d=v.merge({data:{width:j.width,height:j.height}},v.type(d)=="object"?d:{});l=q+"-texture";i=j.textureOptions;this.setTexture(l,d);o.framebufferTexture2D(o.FRAMEBUFFER,i.attachment,this.textureMemo[l].textureType,this.textures[l],0)}if(g){g=v.merge({width:j.width,height:j.height},v.type(g)=="object"?g:{});d=q+"-renderbuffer";l=j.renderBufferOptions;this.setRenderBuffer(d,g);o.framebufferRenderbuffer(o.FRAMEBUFFER,l.attachment,o.RENDERBUFFER,
this.renderBuffers[d])}o.bindTexture(o.TEXTURE_2D,null);o.bindRenderbuffer(o.RENDERBUFFER,null);o.bindFramebuffer(o.FRAMEBUFFER,null);this.frameBufferMemo[q]=j;return this}},setFrameBuffers:function(q){for(var j in q)this.setFrameBuffer(j,q[j]);return this},setRenderBuffer:function(q,j){if(typeof j!="object")o.bindRenderbuffer(o.RENDERBUFFER,j?this.renderBufferMemo[q]:null);else{j=v.merge({storageType:o.DEPTH_COMPONENT16,width:0,height:0},this.renderBufferMemo[q]||{},j||{});var d=q in this.renderBuffers,
g=d?this.renderBuffers[q]:o.createRenderbuffer(o.RENDERBUFFER);d||(this.renderBuffers[q]=g);o.bindRenderbuffer(o.RENDERBUFFER,g);o.renderbufferStorage(o.RENDERBUFFER,j.storageType,j.width,j.height);this.renderBufferMemo[q]=j;return this}},setRenderBuffers:function(q){for(var j in q)this.setRenderBuffer(j,q[j]);return this},setTexture:function(q,j){if(!j||typeof j!="object"){o.activeTexture(j||o.TEXTURE0);o.bindTexture(this.textureMemo[q].textureType||o.TEXTURE_2D,this.textures[q])}else{j=v.merge({textureType:o.TEXTURE_2D,
pixelStore:[{name:o.UNPACK_FLIP_Y_WEBGL,value:true}],parameters:[{name:o.TEXTURE_MAG_FILTER,value:o.NEAREST},{name:o.TEXTURE_MIN_FILTER,value:o.NEAREST}],data:{format:o.RGBA,value:false,width:0,height:0,border:0}},this.textureMemo[q]||{},j||{});var d="textureType"in j?j.textureType:o.TEXTURE_2D,g=q in this.textures,l=g?this.textures[q]:o.createTexture(),i=j.pixelStore,c=j.parameters,h=j.data,n=!!j.data.value;g||(this.textures[q]=l);o.bindTexture(d,l);g||i.forEach(function(m){m.name=typeof m.name==
"string"?o[m.name]:m.name;o.pixelStorei(m.name,m.value)});if(n)o.texImage2D(d,0,h.format,h.format,o.UNSIGNED_BYTE,h.value);else if(h.width||h.height)o.texImage2D(d,0,h.format,h.width,h.height,h.border,h.format,o.UNSIGNED_BYTE,null);g||c.forEach(function(m){m.name=o.get(m.name);m.value=o.get(m.value);o.texParameteri(d,m.name,m.value);m.generateMipmap&&o.generateMipmap(d)});delete j.data;this.textureMemo[q]=j;return this}},setTextures:function(q){for(var j in q)this.setTexture(j,q[j]);return this},
use:function(q){o.useProgram(q.program);this.usedProgram=q;return this}};z.Application=x;(function(){try{var q=document.createElement("canvas");PhiloGL.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(q.getContext("webgl")||q.getContext("experimental-webgl")))}}catch(j){PhiloGL.hasWebGL=function(){return false}}})();PhiloGL.WebGL=z})();(function(){function x(a){return{get:function(){return this[a]},set:function(b){this[a]=b},configurable:false,enumerable:false}}var z=Math.sqrt,q=Math.sin,
j=Math.cos,d=Math.tan,g=Math.PI,l=Array.prototype.slice,i=function(){if(!Float32Array.call)return Array;try{Float32Array.call({},10)}catch(a){return Array}return Float32Array}(),c=i!=Array,h=function(a,b,f){if(c){Float32Array.call(this,3);this[0]=a||0;this[1]=b||0;this[2]=f||0}else this.push(a||0,b||0,f||0);this.typedContainer=new Float32Array(3)};h.create=function(){return new Float32Array(3)};h.prototype=Object.create(i.prototype,{$$family:{value:"Vec3"},x:x(0),y:x(1),z:x(2)});var n={setVec3:function(a,
b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,f,k){a[0]=b;a[1]=f;a[2]=k;return a},add:function(a,b){return new h(a[0]+b[0],a[1]+b[1],a[2]+b[2])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a},add2:function(a,b,f){a[0]=b[0]+f[0];a[1]=b[1]+f[1];a[2]=b[2]+f[2];return a},sub:function(a,b){return new h(a[0]-b[0],a[1]-b[1],a[2]-b[2])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return a},sub2:function(a,b,f){a[0]=b[0]-f[0];a[1]=b[1]-f[1];a[2]=b[2]-f[2];return a},scale:function(a,
b){return new h(a[0]*b,a[1]*b,a[2]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;return a},neg:function(a){return new h(-a[0],-a[1],-a[2])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a},unit:function(a){var b=h.norm(a);if(b>0)return h.scale(a,1/b);return h.clone(a)},$unit:function(a){var b=h.norm(a);if(b>0)return h.$scale(a,1/b);return a},cross:function(a,b){var f=a[0],k=a[1],p=a[2],s=b[0],u=b[1],w=b[2];return new h(k*w-p*u,p*s-f*w,f*u-k*s)},$cross:function(a,b){var f=a[0],k=a[1],
p=a[2],s=b[0],u=b[1],w=b[2];a[0]=k*w-p*u;a[1]=p*s-f*w;a[2]=f*u-k*s;return a},distTo:function(a,b){var f=a[0]-b[0],k=a[1]-b[1],p=a[2]-b[2];return z(f*f,k*k,p*p)},distToSq:function(a,b){var f=a[0]-b[0],k=a[1]-b[1],p=a[2]-b[2];return f*f+k*k+p*p},norm:function(a){var b=a[0],f=a[1];a=a[2];return z(b*b+f*f+a*a)},normSq:function(a){var b=a[0],f=a[1];a=a[2];return b*b+f*f+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},clone:function(a){return a.$$family?new h(a[0],a[1],a[2]):h.setVec3(new Float32Array(3),
a)},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}},m=h.prototype,r;for(r in n){h[r]=n[r];m[r]=function(a){return function(){var b=l.call(arguments);b.unshift(this);return h[a].apply(h,b)}}(r)}var y=function(a,b,f,k,p,s,u,w,A,B,D,E,C,G,J,K){i.call(this,16);this.length=16;typeof a=="number"?this.set(a,b,f,k,p,s,u,w,A,B,D,E,C,G,J,K):this.id();this.typedContainer=new Float32Array(16)};y.create=function(){return new Float32Array(16)};y.prototype=
Object.create(i.prototype,{$$family:{value:"Mat4"},n11:x(0),n21:x(1),n31:x(2),n41:x(3),n12:x(4),n22:x(5),n32:x(6),n42:x(7),n13:x(8),n23:x(9),n33:x(10),n43:x(11),n14:x(12),n24:x(13),n34:x(14),n44:x(15)});n={id:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){return a.$$family?new y(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]):new Float32Array(a)},set:function(a,
b,f,k,p,s,u,w,A,B,D,E,C,G,J,K,H){a[0]=b;a[1]=s;a[2]=B;a[3]=G;a[4]=f;a[5]=u;a[6]=D;a[7]=J;a[8]=k;a[9]=w;a[10]=E;a[11]=K;a[12]=p;a[13]=A;a[14]=C;a[15]=H;return a},mulVec3:function(a,b){var f=h.clone(b);return y.$mulVec3(a,f)},$mulVec3:function(a,b){var f=b[0],k=b[1],p=b[2];b[0]=a[0]*f+a[4]*k+a[8]*p+a[12];b[1]=a[1]*f+a[5]*k+a[9]*p+a[13];b[2]=a[2]*f+a[6]*k+a[10]*p+a[14];return b},mulMat42:function(a,b,f){var k=b[0],p=b[4],s=b[8],u=b[12],w=b[1],A=b[5],B=b[9],D=b[13],E=b[2],C=b[6],G=b[10],J=b[14],K=b[3],
H=b[7],F=b[11];b=b[15];var I=f[0],L=f[4],N=f[8],O=f[12],P=f[1],Q=f[5],W=f[9],U=f[13],V=f[2],R=f[6],S=f[10],M=f[14],X=f[3],Y=f[7],Z=f[11];f=f[15];a[0]=k*I+p*P+s*V+u*X;a[4]=k*L+p*Q+s*R+u*Y;a[8]=k*N+p*W+s*S+u*Z;a[12]=k*O+p*U+s*M+u*f;a[1]=w*I+A*P+B*V+D*X;a[5]=w*L+A*Q+B*R+D*Y;a[9]=w*N+A*W+B*S+D*Z;a[13]=w*O+A*U+B*M+D*f;a[2]=E*I+C*P+G*V+J*X;a[6]=E*L+C*Q+G*R+J*Y;a[10]=E*N+C*W+G*S+J*Z;a[14]=E*O+C*U+G*M+J*f;a[3]=K*I+H*P+F*V+b*X;a[7]=K*L+H*Q+F*R+b*Y;a[11]=K*N+H*W+F*S+b*Z;a[15]=K*O+H*U+F*M+b*f;return a},mulMat4:function(a,
b){var f=y.clone(a);return y.mulMat42(f,a,b)},$mulMat4:function(a,b){return y.mulMat42(a,a,b)},add:function(a,b){var f=y.clone(a);return y.$add(f,b)},$add:function(a,b){a[0]+=b[0];a[4]+=b[4];a[8]+=b[8];a[12]+=b[12];a[1]+=b[1];a[5]+=b[5];a[9]+=b[9];a[13]+=b[13];a[2]+=b[2];a[6]+=b[6];a[10]+=b[10];a[14]+=b[14];a[3]+=b[3];a[7]+=b[7];a[11]+=b[11];a[15]+=b[15];return a},transpose:function(a){a=y.clone(a);return y.$transpose(a)},$transpose:function(a){var b=a[8],f=a[12],k=a[1],p=a[9],s=a[13],u=a[2],w=a[6],
A=a[14],B=a[3],D=a[7],E=a[11];a[1]=a[4];a[2]=b;a[3]=f;a[4]=k;a[6]=p;a[7]=s;a[8]=u;a[9]=w;a[11]=A;a[12]=B;a[13]=D;a[14]=E;return a},rotateAxis:function(a,b,f){a=y.clone(a);return y.$rotateAxis(a,b,f)},$rotateAxis:function(a,b,f){var k=q(b),p=j(b),s=1-p,u=f[0],w=f[1],A=f[2];f=u*u*s+p;b=u*w*s-A*k;var B=u*A*s+w*k,D=w*u*s+A*k,E=w*w*s+p,C=w*A*s-u*k,G=u*A*s-w*k;k=w*A*s+u*k;p=A*A*s+p;s=a[0];u=a[4];w=a[8];A=a[12];var J=a[1],K=a[5],H=a[9],F=a[13],I=a[2],L=a[6],N=a[10],O=a[14];a[0]=s*f+J*D+I*G;a[4]=u*f+K*D+
L*G;a[8]=w*f+H*D+N*G;a[12]=A*f+F*D+O*G;a[1]=s*b+J*E+I*k;a[5]=u*b+K*E+L*k;a[9]=w*b+H*E+N*k;a[13]=A*b+F*E+O*k;a[2]=s*B+J*C+I*p;a[6]=u*B+K*C+L*p;a[10]=w*B+H*C+N*p;a[14]=A*B+F*C+O*p;return a},rotateXYZ:function(a,b,f,k){a=y.clone(a);return y.$rotateXYZ(a,b,f,k)},$rotateXYZ:function(a,b,f,k){var p=a[0],s=a[4],u=a[8],w=a[12],A=a[1],B=a[5],D=a[9],E=a[13],C=a[2],G=a[6],J=a[10],K=a[14],H=j(b),F=j(f),I=j(k);b=q(b);var L=q(f),N=q(k);k=F*I;f=-H*N+b*L*I;var O=b*N+H*L*I,P=F*N,Q=H*I+b*L*N;I=-b*I+H*L*N;L=-L;b*=F;
H*=F;a[0]=p*k+A*f+C*O;a[4]=s*k+B*f+G*O;a[8]=u*k+D*f+J*O;a[12]=w*k+E*f+K*O;a[1]=p*P+A*Q+C*I;a[5]=s*P+B*Q+G*I;a[9]=u*P+D*Q+J*I;a[13]=w*P+E*Q+K*I;a[2]=p*L+A*b+C*H;a[6]=s*L+B*b+G*H;a[10]=u*L+D*b+J*H;a[14]=w*L+E*b+K*H;return a},translate:function(a,b,f,k){a=y.clone(a);return y.$translate(a,b,f,k)},$translate:function(a,b,f,k){a[12]=a[0]*b+a[4]*f+a[8]*k+a[12];a[13]=a[1]*b+a[5]*f+a[9]*k+a[13];a[14]=a[2]*b+a[6]*f+a[10]*k+a[14];a[15]=a[3]*b+a[7]*f+a[11]*k+a[15];return a},scale:function(a,b,f,k){a=y.clone(a);
return y.$scale(a,b,f,k)},$scale:function(a,b,f,k){a[0]*=b;a[4]*=b;a[8]*=b;a[12]*=b;a[1]*=f;a[5]*=f;a[9]*=f;a[13]*=f;a[2]*=k;a[6]*=k;a[10]*=k;a[14]*=k;return a},invert:function(a){a=y.clone(a);return y.$invert(a)},$invert:function(a){var b=a[0],f=a[4],k=a[8],p=a[12],s=a[1],u=a[5],w=a[9],A=a[13],B=a[2],D=a[6],E=a[10],C=a[14],G=a[3],J=a[7],K=a[11],H=a[15],F=b*u-f*s,I=b*w-k*s,L=b*A-p*s,N=f*w-k*u,O=f*A-p*u,P=k*A-p*w,Q=B*J-D*G,W=B*K-E*G,U=B*H-C*G,V=D*K-E*J,R=D*H-C*J,S=E*H-C*K,M=1/(F*S-I*R+L*V+N*U-O*W+
P*Q);a[0]=(+u*S-w*R+A*V)*M;a[4]=(-f*S+k*R-p*V)*M;a[8]=(+J*P-K*O+H*N)*M;a[12]=(-D*P+E*O-C*N)*M;a[1]=(-s*S+w*U-A*W)*M;a[5]=(+b*S-k*U+p*W)*M;a[9]=(-G*P+K*L-H*I)*M;a[13]=(+B*P-E*L+C*I)*M;a[2]=(+s*R-u*U+A*Q)*M;a[6]=(-b*R+f*U-p*Q)*M;a[10]=(+G*O-J*L+H*F)*M;a[14]=(-B*O+D*L-C*F)*M;a[3]=(-s*V+u*W-w*Q)*M;a[7]=(+b*V-f*W+k*Q)*M;a[11]=(-G*N+J*I-K*F)*M;a[15]=(+B*N-D*I+E*F)*M;return a},lookAt:function(a,b,f,k){f=h.sub(b,f);f.$unit();k=h.cross(k,f);k.$unit();var p=h.cross(f,k);p.$unit();return y.set(a,k[0],k[1],k[2],
-k.dot(b),p[0],p[1],p[2],-p.dot(b),f[0],f[1],f[2],-f.dot(b),0,0,0,1)},frustum:function(a,b,f,k,p,s,u){return y.set(a,2*s/(f-b),0,(f+b)/(f-b),0,0,2*s/(p-k),(p+k)/(p-k),0,0,0,-(u+s)/(u-s),-2*u*s/(u-s),0,0,-1,0)},perspective:function(a,b,f,k,p){b=k*d(b*g/360);var s=-b;return y.frustum(a,s*f,b*f,s,b,k,p)},ortho:function(a,b,f,k,p,s,u){var w=f-b,A=p-k,B=u-s;return y.set(a,2/w,0,0,-((f+b)/w),0,2/A,0,-((p+k)/A),0,0,-2/B,-((u+s)/B),0,0,0,1)},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;
b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}};m=y.prototype;for(r in n){y[r]=n[r];m[r]=function(a){return function(){var b=l.call(arguments);b.unshift(this);return y[a].apply(y,b)}}(r)}var t=function(a,b,f,k){i.call(this,4);this[0]=a||0;this[1]=b||0;this[2]=f||0;this[3]=k||0;this.typedContainer=new Float32Array(4)};t.create=function(){return new Float32Array(4)};
n={setQuat:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,f,k,p){a[0]=b||0;a[1]=f||0;a[2]=k||0;a[3]=p||0;return a},clone:function(a){return a.$$family?new t(a[0],a[1],a[2],a[3]):t.setQuat(new Float32Array(4),a)},neg:function(a){return new t(-a[0],-a[1],-a[2],-a[3])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];a[3]=-a[3];return a},add:function(a,b){return new t(a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=
b[3];return a},sub:function(a,b){return new t(a[0]-b[0],a[1]-b[1],a[2]-b[2],a[3]-b[3])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];a[3]-=b[3];return a},scale:function(a,b){return new t(a[0]*b,a[1]*b,a[2]*b,a[3]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;return a},mulQuat:function(a,b){var f=a[0],k=a[1],p=a[2],s=a[3],u=b[0],w=b[1],A=b[2],B=b[3];return new t(s*u+f*B+k*A-p*w,s*w+k*B+p*u-f*A,s*A+p*B+f*w-k*u,s*B-f*u-k*w-p*A)},$mulQuat:function(a,b){var f=a[0],k=a[1],p=a[2],s=a[3],
u=b[0],w=b[1],A=b[2],B=b[3];a[0]=s*u+f*B+k*A-p*w;a[1]=s*w+k*B+p*u-f*A;a[2]=s*A+p*B+f*w-k*u;a[3]=s*B-f*u-k*w-p*A;return a},divQuat:function(a,b){var f=a[0],k=a[1],p=a[2],s=a[3],u=b[0],w=b[1],A=b[2],B=b[3],D=1/(B*B+u*u+w*w+A*A);return new t((f*B-s*u-k*A+p*w)*D,(f*A-s*w+k*B-p*u)*D,(k*u+p*B-s*A-f*w)*D,(s*B+f*u+k*w+p*A)*D)},$divQuat:function(a,b){var f=a[0],k=a[1],p=a[2],s=a[3],u=b[0],w=b[1],A=b[2],B=b[3],D=1/(B*B+u*u+w*w+A*A);a[0]=(f*B-s*u-k*A+p*w)*D;a[1]=(f*A-s*w+k*B-p*u)*D;a[2]=(k*u+p*B-s*A-f*w)*D;
a[3]=(s*B+f*u+k*w+p*A)*D;return a},invert:function(a){var b=a[0],f=a[1],k=a[2];a=a[3];var p=1/(b*b+f*f+k*k+a*a);return new t(-b*p,-f*p,-k*p,a*p)},$invert:function(a){var b=a[0],f=a[1],k=a[2],p=a[3],s=1/(b*b+f*f+k*k+p*p);a[0]=-b*s;a[1]=-f*s;a[2]=-k*s;a[3]=p*s;return a},norm:function(a){var b=a[0],f=a[1],k=a[2];a=a[3];return z(b*b+f*f+k*k+a*a)},normSq:function(a){var b=a[0],f=a[1],k=a[2];a=a[3];return b*b+f*f+k*k+a*a},unit:function(a){return t.scale(a,1/t.norm(a))},$unit:function(a){return t.$scale(a,
1/t.norm(a))},conjugate:function(a){return new t(-a[0],-a[1],-a[2],a[3])},$conjugate:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a}};m=t.prototype={};for(r in n){t[r]=n[r];m[r]=function(a){return function(){var b=l.call(arguments);b.unshift(this);return t[a].apply(t,b)}}(r)}h.fromQuat=function(a){return new h(a[0],a[1],a[2])};t.fromVec3=function(a,b){return new t(a[0],a[1],a[2],b||0)};t.fromMat4=function(a){var b,f,k;if(a[0]>a[5]&&a[0]>a[10]){b=0;f=1;k=2}else if(a[5]>a[0]&&a[5]>a[10]){b=1;
f=2;k=0}else{b=2;f=0;k=1}var p=z(1+a[b*5]-a[f*5]-a[k*5]),s=new t;s[b]=0.5*p;s[f]=0.5*(a["n"+f+""+b]+a["n"+b+""+f])/p;s[k]=0.5*(a["n"+b+""+k]+a["n"+k+""+b])/p;s[3]=0.5*(a["n"+f+""+k]-a["n"+k+""+f])/p;return s};t.fromXRotation=function(a){return new t(q(a/2),0,0,j(a/2))};t.fromYRotation=function(a){return new t(0,q(a/2),0,j(a/2))};t.fromZRotation=function(a){return new t(0,0,q(a/2),j(a/2))};t.fromAxisRotation=function(a,b){var f=a[0],k=a[1],p=a[2],s=1/z(f*f+k*k+p*p),u=q(b/2),w=j(b/2);return new t(u*
f*s,u*k*s,u*p*s,w)};y.fromQuat=function(a){var b=a[3],f=a[0],k=a[1];a=a[2];return new y(b*b+f*f-k*k-a*a,2*f*k-2*b*a,2*f*a+2*b*k,0,2*f*k+2*b*a,b*b-f*f+k*k-a*a,2*k*a-2*b*f,0,2*f*a-2*b*k,2*k*a+2*b*f,b*b-f*f-k*k+a*a,0,0,0,0,1)};PhiloGL.Vec3=h;PhiloGL.Mat4=y;PhiloGL.Quat=t})();(function(){function x(g){return g!==true?g:false}var z=function(g){var l=function(i){for(var c={x:0,y:0};i&&!/^(?:body|html)$/i.test(i.tagName);){c.x+=i.offsetLeft;c.y+=i.offsetTop;i=i.offsetParent}return c}(g);g=function(i){for(var c=
{x:0,y:0};i&&!/^(?:body|html)$/i.test(i.tagName);){c.x+=i.scrollLeft;c.y+=i.scrollTop;i=i.parentNode}return c}(g);return{x:l.x-g.x,y:l.y-g.y}},q={get:function(g,l){return g||(l||window).event},getWheel:function(g){return g.wheelDelta?g.wheelDelta/120:-(g.detail||0)/3},getKey:function(g){var l=g.which||g.keyCode,i;a:{i=d.Keys;for(var c in i)if(i[c]==l){i=c;break a}i=void 0}c=l-111;if(c>0&&c<13)i="f"+c;i=i||String.fromCharCode(l).toLowerCase();return{code:l,key:i,shift:g.shiftKey,control:g.ctrlKey,
alt:g.altKey,meta:g.metaKey}},isRightClick:function(g){return g.which==3||g.button==2},getPos:function(g,l){l=l||window;g=g||l.event;var i=l.document;i=i.documentElement||i.body;if(g.touches&&g.touches.length)g=g.touches[0];return{x:g.pageX||g.clientX+i.scrollLeft,y:g.pageY||g.clientY+i.scrollTop}},stop:function(g){g.stopPropagation&&g.stopPropagation();g.cancelBubble=true;if(g.preventDefault)g.preventDefault();else g.returnValue=false}},j=function(g,l){var i=g.canvas;this.scene=g.scene;this.domElem=
i;this.pos=z(i);this.opt=this.callbacks=l;this.size={width:i.width||i.offsetWidth,height:i.height||i.offsetHeight};this.attachEvents()};j.prototype={hovered:false,pressed:false,touched:false,touchMoved:false,moved:false,attachEvents:function(){var g=this.domElem,l=this;if(this.opt.disableContextMenu)g.oncontextmenu=function(){return false};["mouseup","mousedown","mousemove","mouseover","mouseout","touchstart","touchmove","touchend"].forEach(function(c){g.addEventListener(c,function(h,n){l[c](l.eventInfo(c,
h,n))},false)});["keydown","keyup"].forEach(function(c){document.addEventListener(c,function(h,n){l[c](l.eventInfo(c,h,n))},false)});var i="";i=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";g.addEventListener(i,function(c,h){l.mousewheel(l.eventInfo("mousewheel",c,h))},false)},eventInfo:function(g,l,i){var c=this.domElem,h=this.scene,n=this.opt,m=this.getSize(),r=n.relative,y=n.centerOrigin,t=n.cachePosition&&this.pos||z(c),a=q.get(l,i),b=q.getPos(l,i);l={};
i=b.x;c=b.y;if(r){i-=t.x;c-=t.y;if(y){i-=m.width/2;c-=m.height/2;c*=-1}}switch(g){case "mousewheel":l.wheel=q.getWheel(a);break;case "keydown":v.extend(l,q.getKey(a));break;case "mouseup":l.isRightClick=q.isRightClick(a)}var f;v.extend(l,{x:i,y:c,cache:false,stop:function(){q.stop(a)},getTarget:function(){if(f)return f;return f=!n.picking||h.pick(b.x-t.x,b.y-t.y)||true}});l.event=a;return l},getSize:function(){if(this.cacheSize)return this.size;var g=this.domElem;return{width:g.width||g.offsetWidth,
height:g.height||g.offsetHeight}},mouseup:function(g){if(!this.moved)if(g.isRightClick)this.callbacks.onRightClick(g,this.hovered);else this.callbacks.onClick(g,x(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(g,x(this.pressed));else this.callbacks.onDragCancel(g,x(this.pressed));this.pressed=this.moved=false}},mouseout:function(g){for(var l=g.relatedTarget,i=this.domElem;l&&l.parentNode;){if(i==l.parentNode)return;l=l.parentNode}if(this.hovered){this.callbacks.onMouseLeave(g,
this.hovered);this.hovered=false}},mouseover:function(){},mousemove:function(g){if(this.pressed){this.moved=true;this.callbacks.onDragMove(g,x(this.pressed))}else if(this.hovered){var l=x(g.getTarget());if(!l||l.id!=this.hovered.id){this.callbacks.onMouseLeave(g,this.hovered);if(this.hovered=l)this.callbacks.onMouseEnter(g,this.hovered)}else this.callbacks.onMouseMove(g,this.hovered)}else if(this.hovered=x(g.getTarget()))this.callbacks.onMouseEnter(g,this.hovered)},mousewheel:function(g){this.callbacks.onMouseWheel(g)},
mousedown:function(g){this.pressed=g.getTarget();this.callbacks.onDragStart(g,x(this.pressed))},touchstart:function(g){this.touched=g.getTarget();this.callbacks.onTouchStart(g,x(this.touched))},touchmove:function(g){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(g,x(this.touched))}},touchend:function(g){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(g,x(this.touched));else this.callbacks.onTouchCancel(g,x(this.touched));this.touched=this.touchMoved=false}},keydown:function(g){this.callbacks.onKeyDown(g)},
keyup:function(g){this.callbacks.onKeyUp(g)}};var d={};d.create=function(g,l){l=v.merge({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,onClick:v.empty,onRightClick:v.empty,onDragStart:v.empty,onDragMove:v.empty,onDragEnd:v.empty,onDragCancel:v.empty,onTouchStart:v.empty,onTouchMove:v.empty,onTouchEnd:v.empty,onTouchCancel:v.empty,onMouseMove:v.empty,onMouseEnter:v.empty,onMouseLeave:v.empty,onMouseWheel:v.empty,onKeyDown:v.empty,
onKeyUp:v.empty},l||{});var i=l.bind;if(i)for(var c in l)c.match(/^on[a-zA-Z0-9]+$/)&&function(h,n){l[h]=function(){return n.apply(i,Array.prototype.slice.call(arguments))}}(c,l[c]);new j(g,l)};d.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};PhiloGL.Events=d})();(function(){function x(){return arguments.length==2?{vs:arguments[0],fs:arguments[1]}:arguments[0]||{}}var z=function(d,g,l){var i=d.createShader(l);if(i==null)throw"Error creating the shader with shader type: "+
l;d.shaderSource(i,g);d.compileShader(i);if(!d.getShaderParameter(i,d.COMPILE_STATUS)){g=d.getShaderInfoLog(i);d.deleteShader(i);throw"Error while compiling the shader "+g;}return i},q=function(d,g,l){var i=o.getUniformLocation(d,g.name);d=g.type;var c=false,h=true,n,m;if(g.size>1&&l)switch(d){case o.FLOAT:n=o.uniform1fv;m=Float32Array;h=false;break;case o.INT:case o.BOOL:case o.SAMPLER_2D:case o.SAMPLER_CUBE:n=o.uniform1iv;m=Uint16Array;h=false}if(h)switch(d){case o.FLOAT:n=o.uniform1f;break;case o.FLOAT_VEC2:n=
o.uniform2fv;m=l?Float32Array:new Float32Array(2);break;case o.FLOAT_VEC3:n=o.uniform3fv;m=l?Float32Array:new Float32Array(3);break;case o.FLOAT_VEC4:n=o.uniform4fv;m=l?Float32Array:new Float32Array(4);break;case o.INT:case o.BOOL:case o.SAMPLER_2D:case o.SAMPLER_CUBE:n=o.uniform1i;break;case o.INT_VEC2:case o.BOOL_VEC2:n=o.uniform2iv;m=l?Uint16Array:new Uint16Array(2);break;case o.INT_VEC3:case o.BOOL_VEC3:n=o.uniform3iv;m=l?Uint16Array:new Uint16Array(3);break;case o.INT_VEC4:case o.BOOL_VEC4:n=
o.uniform4iv;m=l?Uint16Array:new Uint16Array(4);break;case o.FLOAT_MAT2:c=true;n=o.uniformMatrix2fv;break;case o.FLOAT_MAT3:c=true;n=o.uniformMatrix3fv;break;case o.FLOAT_MAT4:c=true;n=o.uniformMatrix4fv}return l?function(r){n.call(o,i,new m(r))}:c?function(r){n.call(o,i,false,r.toFloat32Array())}:m?function(r){m.set(r);n.call(o,i,m)}:function(r){n.call(o,i,r)};throw"Unknown type: "+d;},j=function(d,g){var l=o,i=l.createProgram();l.attachShader(i,z(l,d,l.VERTEX_SHADER));l.attachShader(i,z(l,g,l.FRAGMENT_SHADER));
l.linkProgram(i);if(!l.getProgramParameter(i,l.LINK_STATUS))throw"Error linking the shader: "+l.getProgramInfoLog(i);if(!i)return false;l={};for(var c={},h=o.getProgramParameter(i,o.ACTIVE_ATTRIBUTES),n=0;n<h;n++){var m=o.getActiveAttrib(i,n),r=m.name;m=o.getAttribLocation(i,m.name);l[r]=m}h=o.getProgramParameter(i,o.ACTIVE_UNIFORMS);for(n=0;n<h;n++){m=o.getActiveUniform(i,n);r=m.name;r=r[r.length-1]=="]"?r.substr(0,r.length-3):r;c[r]=q(i,m,m.name!=r)}this.program=i;this.attributes=l;this.uniforms=
c};j.prototype={$$family:"program",setUniform:function(d,g){if(this.uniforms[d])this.uniforms[d](g);return this},setUniforms:function(d){for(var g in d)this.setUniform(g,d[g]);return this}};["setBuffer","setBuffers","use"].forEach(function(d){j.prototype[d]=function(){var g=Array.prototype.slice.call(arguments);g.unshift(this);T[d].apply(T,g);return this}});["setFrameBuffer","setFrameBuffers","setRenderBuffer","setRenderBuffers","setTexture","setTextures"].forEach(function(d){j.prototype[d]=function(){T[d].apply(T,
arguments);return this}});j.fromShaderIds=function(){var d=x.apply({},arguments),g=v(d.vs);d=v(d.fs);return new j(g.innerHTML,d.innerHTML)};j.fromShaderSources=function(d){d=x.apply({},arguments);return new j(d.vs,d.fs)};j.fromDefaultShaders=function(){var d=x.apply({},arguments),g=PhiloGL.Shaders;return PhiloGL.Program.fromShaderSources(g.Vertex[d.vs||"Default"],g.Fragment[d.fs||"Default"])};j.fromShaderURIs=function(d){d=v.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:v.empty,onError:v.empty},
d||{});var g=d.path+d.fs,l=PhiloGL.IO.XHR;(new l({url:d.path+d.vs,noCache:d.noCache,onError:function(i){d.onError(i)},onSuccess:function(i){(new l({url:g,noCache:d.noCache,onError:function(c){d.onError(c)},onSuccess:function(c){d.onSuccess(j.fromShaderSources(i,c),d)}})).send()}})).send()};PhiloGL.Program=j})();(function(){var x={},z=function(d){this.opt=d=v.merge({url:"http://sencha.com/",method:"GET",async:true,noCache:false,sendAsBinary:false,onProgress:v.empty,onSuccess:v.empty,onError:v.empty,
onAbort:v.empty,onComplete:v.empty},d||{});this.initXHR()};z.State={};["UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(d,g){z.State[d]=g});z.prototype={initXHR:function(){var d=this.req=new XMLHttpRequest,g=this;["Progress","Error","Abort","Load"].forEach(function(l){d.addEventListener(l.toLowerCase(),function(i){g["handle"+l](i)},false)})},send:function(d){var g=this.req,l=this.opt,i=l.async;if(l.noCache)l.url+=(l.url.indexOf("?")>=0?"&":"?")+v.uid();g.open(l.method,
l.url,i);if(i)g.onreadystatechange=function(){if(g.readyState==z.State.COMPLETED)if(g.status==200)l.onSuccess(g.responseText);else l.onError(g.status)};l.sendAsBinary?g.sendAsBinary(d||l.body||null):g.send(d||l.body||null);if(!i)if(g.status==200)l.onSuccess(g.responseText);else l.onError(g.status)},setRequestHeader:function(d,g){this.req.setRequestHeader(d,g);return this},handleProgress:function(d){if(d.lengthComputable)this.opt.onProgress(d,Math.round(d.loaded/d.total*100));else this.opt.onProgress(d,
-1)},handleError:function(d){this.opt.onError(d)},handleAbort:function(){this.opt.onAbort(e)},handleLoad:function(d){this.opt.onComplete(d)}};var q=function(d){d=v.merge({url:"http://sencha.com/",data:{},noCache:false,onComplete:v.empty,callbackKey:"callback"},d||{});var g=q.counter++,l=[],i;for(i in d.data)l.push(i+"="+d.data[i]);l=l.join("&");if(d.noCache)l+=(l.indexOf("?")>=0?"&":"?")+v.uid();l=d.url+(d.url.indexOf("?")>-1?"&":"?")+d.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+g+(l.length>
0?"&"+l:"");var c=document.createElement("script");c.type="text/javascript";c.src=l;q.requests["request_"+g]=function(h){d.onComplete(h);c.parentNode&&c.parentNode.removeChild(c);c.clearAttributes&&c.clearAttributes()};document.getElementsByTagName("head")[0].appendChild(c)};q.counter=0;q.requests={};var j=function(d){d=v.merge({src:[],noCache:false,onProgress:v.empty,onComplete:v.empty},d||{});var g=0,l=d.src.length,i=function(){d.onProgress(Math.round(++g/l*100));if(g==l)d.onComplete(m)},c=function(){if(++g==
l)d.onComplete(m)},h=d.noCache,n=v.uid(),m=d.src.map(function(r,y){var t=new Image;t.index=y;t.onload=i;t.onerror=c;t.src=r+(h?(r.indexOf("?")>=0?"&":"?")+n:"");return t});return m};x.XHR=z;x.JSONP=q;x.Images=j;x.Textures=function(d){d=v.merge({src:[],noCache:false,onComplete:v.empty},d||{});j({src:d.src,noCache:d.noCache,onComplete:function(g){var l={};g.forEach(function(i,c){l[d.src[c]]=v.merge({data:{value:i}},d)});T.setTextures(l);d.onComplete()}})};PhiloGL.IO=x})();(function(){var x=PhiloGL.Vec3,
z=PhiloGL.Mat4,q=function(j,d,g,l,i){i=i||{};var c=i.position,h=i.target;i=i.up;this.fov=j;this.near=g;this.far=l;this.aspect=d;this.position=c&&new x(c.x,c.y,c.z)||new x;this.target=h&&new x(h.x,h.y,h.z)||new x;this.up=i&&new x(i.x,i.y,i.z)||new x(0,1,0);this.projection=(new z).perspective(j,d,g,l);this.modelView=new z};q.prototype={update:function(){this.projection=(new z).perspective(this.fov,this.aspect,this.near,this.far);this.modelView.lookAt(this.position,this.target,this.up)}};PhiloGL.Camera=
q})();(function(){function x(c,h){if(c&&c.length<h){for(var n=c[0],m=c[1],r=c[2],y=c[3],t=[n,m,r,y],a=h/c.length,b;--a;){b=a*4;t[b]=n;t[b+1]=m;t[b+2]=r;t[b+3]=y}return new Float32Array(t)}else return c}var z=PhiloGL.Vec3,q=PhiloGL.Mat4,j=Math.cos,d=Math.sin,g=Math.PI,l=Array.prototype.slice,i={};i.Model=function(c){c=c||{};this.id=c.id||v.uid();this.pickable=!!c.pickable;this.pick=c.pick||function(){return false};if(c.pickingColors)this.pickingColors=c.pickingColors;this.vertices=c.vertices;this.normals=
c.normals;this.textures=c.textures&&v.splat(c.textures);this.colors=c.colors;this.indices=c.indices;this.shininess=c.shininess||0;if(c.texCoords)this.texCoords=c.texCoords;this.uniforms=c.uniforms||{};this.attributes=c.attributes||{};this.render=c.render;this.drawType=c.drawType||"TRIANGLES";this.display="display"in c?c.display:true;this.onBeforeRender=c.onBeforeRender||v.empty;this.onAfterRender=c.onAfterRender||v.empty;if(c.program)this.program=c.program;this.position=new z;this.rotation=new z;
this.scale=new z(1,1,1);this.matrix=new q;c.computeCentroids&&this.computeCentroids();c.computeNormals&&this.computeNormals()};i.Model.prototype=Object.create(null,{vertices:{set:function(c){if(c){var h=c.length;if(c.BYTES_PER_ELEMENT)this.$vertices=c;else if(this.$verticesLength==h)this.$vertices.set(c);else this.$vertices=new Float32Array(c);this.$verticesLength=h}},get:function(){return this.$vertices}},normals:{set:function(c){if(c){var h=c.length;if(c.BYTES_PER_ELEMENT)this.$normals=c;else if(this.$normalsLength==
h)this.$normals.set(c);else this.$normals=new Float32Array(c);this.$normalsLength=h}},get:function(){return this.$normals}},colors:{set:function(c){if(c){var h=c.length;if(c.BYTES_PER_ELEMENT)this.$colors=c;else if(this.$colorsLength==h)this.$colors.set(c);else this.$colors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=h)this.$colors=x(l.call(this.$colors),this.$verticesLength/3*4);this.$colorsLength=this.$colors.length}},get:function(){return this.$colors}},pickingColors:{set:function(c){if(c){var h=
c.length;if(c.BYTES_PER_ELEMENT)this.$pickingColors=c;else if(this.$pickingColorsLength==h)this.$pickingColors.set(c);else this.$pickingColors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=h)this.$pickingColors=x(l.call(this.$pickingColors),this.$verticesLength/3*4);this.$pickingColorsLength=this.$pickingColors.length}},get:function(){return this.$pickingColors}},texCoords:{set:function(c){if(c)if(v.type(c)=="object"){var h={},n;for(n in c){var m=c[n];h[n]=m.BYTES_PER_ELEMENT?m:
new Float32Array(m)}this.$texCoords=h}else{h=c.length;if(c.BYTES_PER_ELEMENT)this.$texCoords=c;else if(this.$texCoordsLength==h)this.$texCoords.set(c);else this.$texCoords=new Float32Array(c);this.$texCoordsLength=h}},get:function(){return this.$texCoords}},indices:{set:function(c){if(c){var h=c.length;if(c.BYTES_PER_ELEMENT)this.$indices=c;else if(this.$indicesLength==h)this.$indices.set(c);else this.$indices=new Uint16Array(c);this.$indicesLength=h}},get:function(){return this.$indices}}});v.extend(i.Model.prototype,
{$$family:"model",update:function(){var c=this.matrix,h=this.position,n=this.rotation,m=this.scale;c.id();c.$translate(h.x,h.y,h.z);c.$rotateXYZ(n.x,n.y,n.z);c.$scale(m.x,m.y,m.z)},computeCentroids:function(){var c=this.vertices,h=[];this.faces.forEach(function(n){var m=[0,0,0],r=0;n.forEach(function(y){y=c[y];m[0]+=y[0];m[1]+=y[1];m[2]+=y[2];r++});m[0]/=r;m[1]/=r;m[2]/=r;h.push(m)});this.centroids=h},computeNormals:function(){var c=this.vertices,h=[];this.faces.forEach(function(n){var m=c[n[0]],
r=c[n[1]];n=c[n[2]];m={x:m[0]-r[0],y:m[1]-r[1],z:m[2]-r[2]};z.$cross(m,{x:n[0]-r[0],y:n[1]-r[1],z:n[1]-r[2]});z.norm(m)>1.0E-6&&z.unit(m);h.push([m.x,m.y,m.z])});this.normals=h}});v.extend(i.Model.prototype,{setUniforms:function(c){c.setUniforms(this.uniforms)},setAttributes:function(c){var h=this.attributes,n;for(n in h){var m=h[n],r=this.id+"-"+n;if(Object.keys(m).length){m.attribute=n;c.setBuffer(r,m);delete m.value}else c.setBuffer(r,true)}},unsetAttributes:function(c){var h=this.attributes,n;
for(n in h)c.setBuffer(this.id+"-"+n,false)},setShininess:function(c){c.setUniform("shininess",this.shininess||0)},setVertices:function(c,h){if(this.vertices)h||this.dynamic?c.setBuffer("vertices-"+this.id,{attribute:"position",value:this.vertices,size:3}):c.setBuffer("vertices-"+this.id)},unsetVertices:function(c){c.setBuffer("vertices-"+this.id,false)},setNormals:function(c,h){if(this.normals)h||this.dynamic?c.setBuffer("normals-"+this.id,{attribute:"normal",value:this.normals,size:3}):c.setBuffer("normals-"+
this.id)},unsetNormals:function(c){c.setBuffer("normals-"+this.id,false)},setIndices:function(c,h){if(this.indices)h||this.dynamic?c.setBuffer("indices-"+this.id,{bufferType:o.ELEMENT_ARRAY_BUFFER,drawType:o.STATIC_DRAW,value:this.indices,size:1}):c.setBuffer("indices-"+this.id)},unsetIndices:function(c){c.setBuffer("indices-"+this.id,false)},setPickingColors:function(c,h){if(this.pickingColors)h||this.dynamic?c.setBuffer("pickingColors-"+this.id,{attribute:"pickingColor",value:this.pickingColors,
size:4}):c.setBuffer("pickingColors-"+this.id)},unsetPickingColors:function(c){c.setBuffer("pickingColors-"+this.id,false)},setColors:function(c,h){if(this.colors)h||this.dynamic?c.setBuffer("colors-"+this.id,{attribute:"color",value:this.colors,size:4}):c.setBuffer("colors-"+this.id)},unsetColors:function(c){c.setBuffer("colors-"+this.id,false)},setTexCoords:function(c,h){if(this.texCoords){var n=this.id;if(h||this.dynamic)v.type(this.texCoords)=="object"?this.textures.forEach(function(m,r){c.setBuffer("texCoords-"+
r+"-"+n,{attribute:"texCoord"+(r+1),value:this.texCoords[m],size:2})}):c.setBuffer("texCoords-"+n,{attribute:"texCoord1",value:this.texCoords,size:2});else v.type(this.texCoords)=="object"?this.textures.forEach(function(m,r){c.setBuffer("texCoords-"+r+"-"+n)}):c.setBuffer("texCoords-"+n)}},unsetTexCoords:function(c){c.setBuffer("texCoords-"+this.id,false)},setTextures:function(c){this.textures=this.textures?v.splat(this.textures):[];for(var h=0,n=this.textures,m=n.length,r=PhiloGL.Scene.MAX_TEXTURES;h<
r;h++)if(h<m){c.setUniform("hasTexture"+(h+1),true);c.setUniform("sampler"+(h+1),h);c.setTexture(n[h],o["TEXTURE"+h])}else c.setUniform("hasTexture"+(h+1),false)}});i.Cube=function(c){i.Model.call(this,v.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,
1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c||{}))};i.Cube.prototype=Object.create(i.Model.prototype);i.Sphere=function(c){var h=c.nlat||10,n=c.nlong||10,m=c.radius||1,r=g-0,y=2*g-0,t=(h+1)*(n+1),a=new Float32Array(t*3),b=new Float32Array(t*3);t=new Float32Array(t*
2);var f=new Uint16Array(h*n*6);if(typeof m=="number"){var k=m;m=function(){return k}}for(var p=0;p<=h;p++)for(var s=0;s<=n;s++){var u=s/n,w=p/h,A=y*u,B=r*w,D=d(A);A=j(A);var E=d(B),C=j(B);B=A*E;A=C;D*=E;E=m(B,A,D,u,w);C=s+p*(n+1);var G=C*3;C*=2;a[G+0]=E*B;a[G+1]=E*A;a[G+2]=E*D;b[G+0]=B;b[G+1]=A;b[G+2]=D;t[C+0]=u;t[C+1]=w}m=h+1;for(s=0;s<h;s++)for(p=0;p<n;p++){C=(s*n+p)*6;f[C+0]=p*m+s;f[C+1]=p*m+s+1;f[C+2]=(p+1)*m+s;f[C+3]=(p+1)*m+s;f[C+4]=p*m+s+1;f[C+5]=(p+1)*m+s+1}i.Model.call(this,v.extend({vertices:a,
indices:f,normals:b,texCoords:t},c||{}))};i.Sphere.prototype=Object.create(i.Model.prototype);i.IcoSphere=function(c){var h=c.iterations||0,n=[],m=[],r=Math.sqrt,y=Math.acos,t=Math.atan2,a=Math.PI,b=a*2;c.onAddVertex=c.onAddVertex||v.empty;var f=(1+r(5))/2,k=r(1+f*f);n.push(-1/k,f/k,0,1/k,f/k,0,-1/k,-f/k,0,1/k,-f/k,0,0,-1/k,f/k,0,1/k,f/k,0,-1/k,-f/k,0,1/k,-f/k,f/k,0,-1/k,f/k,0,1/k,-f/k,0,-1/k,-f/k,0,1/k);m.push(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,
3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1);var p=function(){var V={};return function(R,S){R*=3;S*=3;var M=(R<S?R:S)+"|"+(R>S?R:S);if(M in V)return V[M];var X=(n[R]+n[S])/2,Y=(n[R+1]+n[S+1])/2,Z=(n[R+2]+n[S+2])/2,$=r(X*X+Y*Y+Z*Z);X/=$;Y/=$;Z/=$;n.push(X,Y,Z);return V[M]=n.length/3-1}}();for(f=0;f<h;f++){var s=[],u=0;for(k=m.length;u<k;u+=3){var w=p(m[u],m[u+1]),A=p(m[u+1],m[u+2]),B=p(m[u+2],m[u]);s.push(m[u],w,B,m[u+1],A,w,m[u+2],B,A,w,A,B)}m=s}k=m.length;h=new Float32Array(k*3);p=new Float32Array(k*
2);for(f=0;f<k;f+=3){A=m[f];B=m[f+1];var D=m[f+2];s=A*3;u=B*3;w=D*3;A*=2;B*=2;D*=2;var E=n[s],C=n[s+1],G=n[s+2],J=y(G/r(E*E+C*C+G*G)),K=t(C,E);J/=a;K=1-K/b;var H=n[u],F=n[u+1],I=n[u+2],L=y(I/r(H*H+F*F+I*I)),N=t(F,H);L/=a;N=1-N/b;var O=n[w],P=n[w+1],Q=n[w+2],W=y(Q/r(O*O+P*P+Q*Q)),U=t(P,O);W/=a;U=1-U/b;E=z.cross({x:O-H,y:P-F,z:Q-I},{x:E-H,y:C-F,z:G-I}).$unit();h[s]=h[u]=h[w]=E.x;h[s+1]=h[u+1]=h[w+1]=E.y;h[s+2]=h[u+2]=h[w+2]=E.z;p[A]=K;p[A+1]=J;p[B]=N;p[B+1]=L;p[D]=U;p[D+1]=W}i.Model.call(this,v.extend({vertices:n,
indices:m,normals:h,texCoords:p},c||{}))};i.IcoSphere.prototype=Object.create(i.Model.prototype);i.TruncatedCone=function(c){var h=c.bottomRadius||0,n=c.topRadius||0,m=c.height||1,r=c.nradial||10,y=c.nvertical||10,t=!!c.topCap,a=!!c.bottomCap,b=(t?2:0)+(a?2:0),f=(r+1)*(y+1+b),k=new Float32Array(f*3),p=new Float32Array(f*3);f=new Float32Array(f*2);var s=new Uint16Array(r*(y+b)*6),u=r+1,w=Math,A=w.atan2(h-n,m),B=w.sin,D=w.cos;w=w.PI;var E=D(A);A=B(A);a=y+(a?2:0);var C=0,G=0;for(t=t?-2:0;t<=a;t++){var J=
t/y,K=m*J,H;if(t<0){K=0;J=1;H=h}else if(t>y){K=m;J=1;H=n}else H=h+(n-h)*(t/y);if(t==-2||t==y+2)J=H=0;K-=m/2;for(var F=0;F<u;F++){var I=B(F*w*2/r),L=D(F*w*2/r);k[C+0]=I*H;k[C+1]=K;k[C+2]=L*H;p[C+0]=t<0||t>y?0:I*E;p[C+1]=t<0?-1:t>y?1:A;p[C+2]=t<0||t>y?0:L*E;f[G+0]=F/r;f[G+1]=J;G+=2;C+=3}}for(t=0;t<y+b;t++)for(F=0;F<r;F++){h=(t*r+F)*6;s[h+0]=u*(t+0)+0+F;s[h+1]=u*(t+0)+1+F;s[h+2]=u*(t+1)+1+F;s[h+3]=u*(t+0)+0+F;s[h+4]=u*(t+1)+1+F;s[h+5]=u*(t+1)+0+F}i.Model.call(this,v.extend({vertices:k,normals:p,texCoords:f,
indices:s},c||{}))};i.TruncatedCone.prototype=Object.create(i.Model.prototype);i.Cone=function(c){c.topRadius=0;c.topCap=!!c.cap;c.bottomCap=!!c.cap;c.bottomRadius=c.radius||3;i.TruncatedCone.call(this,c)};i.Cone.prototype=Object.create(i.TruncatedCone.prototype);i.Cylinder=function(c){c.bottomRadius=c.radius;c.topRadius=c.radius;i.TruncatedCone.call(this,c)};i.Cylinder.prototype=Object.create(i.TruncatedCone.prototype);i.Plane=function(c){var h=c.type,n=h.split(","),m=c[n[0]+"len"],r=c[n[1]+"len"],
y=c["n"+n[0]]||1;n=c["n"+n[1]]||1;var t=c.offset;numVertices=(y+1)*(n+1);positions=new Float32Array(numVertices*3);normals=new Float32Array(numVertices*3);texCoords=new Float32Array(numVertices*2);for(var a=i3=i2=0;a<=n;a++)for(var b=0;b<=y;b++){var f=b/y,k=a/n;texCoords[i2+0]=f;texCoords[i2+1]=k;i2+=2;switch(h){case "x,y":positions[i3+0]=m*f-m*0.5;positions[i3+1]=r*k-r*0.5;positions[i3+2]=t;normals[i3+0]=0;normals[i3+1]=0;normals[i3+2]=1;break;case "x,z":positions[i3+0]=m*f-m*0.5;positions[i3+1]=
t;positions[i3+2]=r*k-r*0.5;normals[i3+0]=0;normals[i3+1]=1;normals[i3+2]=0;break;case "y,z":positions[i3+0]=t;positions[i3+1]=m*f-m*0.5;positions[i3+2]=r*k-r*0.5;normals[i3+0]=1;normals[i3+1]=0;normals[i3+2]=0}i3+=3}h=y+1;m=[];for(a=0;a<n;a++)for(b=0;b<y;b++){r=(a*y+b)*6;m[r+0]=(a+0)*h+b;m[r+1]=(a+1)*h+b;m[r+2]=(a+0)*h+b+1;m[r+3]=(a+1)*h+b;m[r+4]=(a+1)*h+b+1;m[r+5]=(a+0)*h+b+1}i.Model.call(this,v.extend({vertices:positions,normals:normals,texCoords:texCoords,indices:m},c))};i.Plane.prototype=Object.create(i.Model.prototype);
i.id=v.time();PhiloGL.O3D=i})();(function(){var x={Vertex:{},Fragment:{}},z=x.Fragment;x.Vertex.Default="#define LIGHT_MAX 40\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec4 pickingColor;\nattribute vec2 texCoord1;\nuniform mat4 modelViewMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 normalMatrix;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nvec4 transformedNormal = normalMatrix * vec4(normal, 1.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nvColor = color;\nvPickingColor = pickingColor;\nvTexCoord = texCoord1;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";
z.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif(!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif(enablePicking) {\nif(hasPickingColors) {\ngl_FragColor = vPickingColor;\n} else {\ngl_FragColor = vec4(pickColor, 1.0);\n}\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
PhiloGL.Shaders=x})();(function(){var x=PhiloGL.Vec3,z=PhiloGL.Mat4,q=function(j,d,g){g=v.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},g||{});this.program=g.program?j[g.program]:j;this.camera=d;this.models=[];this.config=g};q.prototype={add:function(){for(var j=0,d=this.models,g=arguments.length;j<g;j++){var l=arguments[j];l.id=l.id||v.uid();d.push(l);this.defineBuffers(l)}},remove:function(j){var d=this.models;
j=d.indexOf(j);j>-1&&d.splice(j,1)},getProgram:function(j){var d=this.program;if(d.$$family!="program"&&j&&j.program){d=d[j.program];d.use()}return d},defineBuffers:function(j){var d=this.getProgram(j);j.setAttributes(d,true);j.setVertices(d,true);j.setColors(d,true);j.setPickingColors(d,true);j.setNormals(d,true);j.setTexCoords(d,true);j.setIndices(d,true)},beforeRender:function(j){this.setupLighting(j);this.setupEffects(j);var d=this.camera;j.setUniform("projectionMatrix",d.projection);j.setUniform("viewMatrix",
d.modelView)},setupLighting:function(j){var d=this.config.lights,g=d.ambient,l=d.directional,i=l.color,c=l.direction,h=d.enable;d=d.points&&v.splat(d.points)||[];l=d.length;var n=[],m=[],r=[],y=[];c=x.unit([c.x,c.y,c.z]).$scale(-1);j.setUniform("enableLights",h);if(h){j.setUniform("ambientColor",[g.r,g.g,g.b]);j.setUniform("directionalColor",[i.r,i.g,i.b]);j.setUniform("lightingDirection",[c.x,c.y,c.z]);j.setUniform("numberPoints",l);for(g=0;g<l;g++){h=d[g];i=h.position;c=h.color||h.diffuse;h=h.specular;
n.push(i.x,i.y,i.z);m.push(c.r,c.g,c.b);r.push(+!!h);h?y.push(h.r,h.g,h.b):y.push(0,0,0)}j.setUniforms({pointLocation:n,pointColor:m});j.setUniforms({enableSpecular:r,pointSpecularColor:y})}},setupEffects:function(j){var d=this.config.effects.fog,g=d.color||{r:0.5,g:0.5,b:0.5};d?j.setUniforms({hasFog:true,fogNear:d.near,fogFar:d.far,fogColor:[g.r,g.g,g.b]}):j.setUniform("hasFog",false)},render:function(j){j=j||{};var d=this.camera,g=this.program,l=j.renderProgram,i=v.type(g),c=!l&&i=="object",h=v.merge({onBeforeRender:v.empty,
onAfterRender:v.empty},j||{});!c&&this.beforeRender(l||g);this.models.forEach(function(n,m){if(n.display){var r=l||this.getProgram(n);c&&this.beforeRender(r);n.onBeforeRender(r,d);h.onBeforeRender(n,m);this.renderObject(n,r);h.onAfterRender(n,m);n.onAfterRender(r,d)}},this)},renderToTexture:function(j,d){d=d||{};var g=T.textures[j+"-texture"],l=T.textureMemo[j+"-texture"];this.render(d);o.bindTexture(l.textureType,g);o.generateMipmap(l.textureType);o.bindTexture(l.textureType,null)},renderObject:function(j,
d){var g=this.camera,l=new z;j.setUniforms(d);j.setAttributes(d);j.setShininess(d);j.setVertices(d);j.setColors(d);j.setPickingColors(d);j.setNormals(d);j.setTextures(d);j.setTexCoords(d);j.setIndices(d);l.mulMat42(g.modelView,j.matrix);d.setUniform("modelViewMatrix",l);d.setUniform("normalMatrix",l.invert().$transpose());if(j.render)j.render(o,d,g);else j.indices?o.drawElements(j.drawType!==undefined?o.get(j.drawType):o.TRIANGLES,j.indices.length,o.UNSIGNED_SHORT,0):o.drawArrays(j.drawType!==undefined?
o.get(j.drawType):o.TRIANGLES,0,j.vertices.length/3);j.unsetAttributes(d);j.unsetVertices(d);j.unsetColors(d);j.unsetPickingColors(d);j.unsetNormals(d);j.unsetTexCoords(d);j.unsetIndices(d)},setupPicking:function(){var j=PhiloGL.Program.fromDefaultShaders();T.setFrameBuffer("$picking",{width:1,height:1,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:true});T.setFrameBuffer("$picking",false);
this.pickingProgram=j},pick:function(j,d){this.pickingProgram||this.setupPicking();var g={},l=[],i=T.usedProgram,c=this.pickingProgram,h=this.config,n=h.lights.enable,m=h.effects.fog,r=o.canvas.width,y=o.canvas.height,t=[],a=new Uint8Array(4),b=0,f;h.lights.enable=false;h.effects.fog=false;c.use();T.setFrameBuffer("$picking",true);c.setUniform("enablePicking",true);o.disable(o.BLEND);o.viewport(-j,d-y,r,y);o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);o.readPixels(0,0,1,1,o.RGBA,o.UNSIGNED_BYTE,
a);f=a[0]+a[1]*256+a[2]*65536;this.renderToTexture("$picking",{renderProgram:c,onBeforeRender:function(s,u){if(u==f)b=1;var w=u+b,A=!!s.pickingColors;c.setUniform("hasPickingColors",A);if(A)l.push(s);else{t[0]=w%256;t[1]=(w/256>>0)%256;t[2]=(w/65536>>0)%256;c.setUniform("pickColor",[t[0]/255,t[1]/255,t[2]/255]);g[t.join()]=s}}});o.readPixels(0,0,1,1,o.RGBA,o.UNSIGNED_BYTE,a);r=[a[0],a[1],a[2]].join();r=g[r];if(!r)for(var k=0,p=l.length;k<p;k++){r=l[k];y=r.pick(a);if(y!==false)r.$pickingIndex=y;else r=
false}T.setFrameBuffer("$picking",false);c.setUniform("enablePicking",false);h.lights.enable=n;h.effects.fog=m;i&&i.use();return r&&r.pickable&&r}};q.MAX_TEXTURES=3;q.MAX_POINT_LIGHTS=50;PhiloGL.Scene=q})();(function(){function x(z,q){for(var j=this.workers=[];q--;)j.push(new Worker(z))}x.prototype={map:function(z){var q=this.workers,j=this.configs=[],d=0;for(q=q.length;d<q;d++)j.push(z&&z(d));return this},reduce:function(z){for(var q=z.reduceFn,j=this.workers,d=this.configs,g=j.length,l=z.initialValue,
i=function(m){g--;l=l===undefined?m.data:q(l,m.data);if(g==0)z.onComplete(l)},c=0,h=g;c<h;c++){var n=j[c];n.onmessage=i;n.postMessage(d[c])}return this}};PhiloGL.WorkerGroup=x})();(function(){var x=function(d){this.opt=v.merge({duration:1E3,transition:function(g){return g},onCompute:v.empty,onComplete:v.empty},d||{})};x.prototype={timer:null,time:null,start:function(d){this.opt=v.merge(this.opt,d||{});this.time=v.time();this.animating=true},step:function(){if(this.animating){var d=v.time(),g=this.time,
l=this.opt;if(d<g+l.duration){d=l.transition((d-g)/l.duration);l.onCompute.call(this,d)}else{this.animating=false;l.onCompute.call(this,1);l.onComplete.call(this)}}}};x.compute=function(d,g,l){return d+(g-d)*l};x.Transition={linear:function(d){return d}};var z=x.Transition;(function(){var d=function(i,c){c=v.splat(c);return v.extend(i,{easeIn:function(h){return i(h,c)},easeOut:function(h){return 1-i(1-h,c)},easeInOut:function(h){return h<=0.5?i(2*h,c)/2:(2-i(2*(1-h),c))/2}})},g={Pow:function(i,c){return Math.pow(i,
c[0]||6)},Expo:function(i){return Math.pow(2,8*(i-1))},Circ:function(i){return 1-Math.sin(Math.acos(i))},Sine:function(i){return 1-Math.sin((1-i)*Math.PI/2)},Back:function(i,c){c=c[0]||1.618;return Math.pow(i,2)*((c+1)*i-c)},Bounce:function(i){for(var c,h=0,n=1;;h+=n,n/=2)if(i>=(7-4*h)/11){c=n*n-Math.pow((11-6*h-11*i)/4,2);break}return c},Elastic:function(i,c){return Math.pow(2,10*--i)*Math.cos(20*i*Math.PI*(c[0]||1)/3)}},l;for(l in g)z[l]=d(g[l]);["Quad","Cubic","Quart","Quint"].forEach(function(i,
c){z[i]=d(function(h){return Math.pow(h,[c+2])})})})();var q=self||window;if(q){var j=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(d){if(d in q){x.animationTime=function(){return q[d]};j=true}});if(!j)x.animationTime=v.time;j=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(d){if(d in q){x.requestAnimationFrame=function(g){q[d](function(){g()})};
j=true}});if(!j)x.requestAnimationFrame=function(d){setTimeout(function(){d()},1E3/60)}}PhiloGL.Fx=x})()})();
