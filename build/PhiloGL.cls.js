/*

 Copyright (c) 2011 Sencha Inc. - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
(function(){function s(t){return document.getElementById(t)}this.PhiloGL=null;(function(){PhiloGL=function(t,q){function n(v,a,b){a.use();var d=v.canvas,j=new PhiloGL.Camera(i.fov,d.width/d.height,i.near,i.far,i);j.update();var l=new PhiloGL.Scene(a,j,k),o={$$family:"app",gl:v,canvas:d,program:a,scene:l,camera:j};f&&PhiloGL.Events.create(o,s.extend(f,{bind:o}));if(c.src.length)new PhiloGL.IO.Textures(a,s.extend(c,{onComplete:function(){b(o)}}));else b(o)}q=s.merge({context:{},camera:{fov:45,near:0.1,
far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:s.empty,onError:s.empty},q||{});var i=q.camera,f=q.events,c=q.textures,g=q.program,h=g.from,k=q.scene;m=PhiloGL.WebGL.getContext(t,q.context);if(!m){q.onError();return null}var r={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},u;for(u in r)if(h==u){program=PhiloGL.Program[r[u]](s.extend({onSuccess:function(v){n(m,v,function(a){q.onLoad(a)})},
onError:function(v){q.onError(v)}},g));break}program&&n(m,program,function(v){q.onLoad(v)})}})();PhiloGL.unpack=function(){["Vec3","Mat4","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx"].forEach(function(t){window[t]=PhiloGL[t]})};PhiloGL.version="1.1.1";var m;s.empty=function(){};s.time=Date.now||function(){return+new Date};s.uid=function(){var t=s.time();return function(){return t++}}();s.extend=function(t,q){for(var n in q)t[n]=q[n];return t};s.type=function(){var t=
Object.prototype.toString;return function(q){var n;n=t.call(q);n=n.substr(8,n.length-9).toLowerCase();if(n!="object")return n;if(q.$$family)return q.$$family;return q&&q.nodeName&&q.nodeType==1?"element":n}}();(function(){function t(q){var n=s.type(q);if(n=="object"){n={};for(var i in q)n[i]=t(q[i]);return n}else if(n=="array"){n=[];i=0;for(var f=q.length;i<f;i++)n[i]=t(q[i]);return n}else return q}s.merge=function(){for(var q={},n=0,i=arguments.length;n<i;n++){var f=arguments[n];if(s.type(f)=="object")for(var c in f){var g=
f[c],h=q[c];q[c]=h&&s.type(g)=="object"&&s.type(h)=="object"?s.merge(h,g):t(g)}}return q}})();s.splat=function(){var t=Array.isArray;return function(q){return t(q)&&q||[q]}}();(function(){var t=Math.sqrt,q=Math.sin,n=Math.cos,i=Math.tan,f=Math.PI,c=Array.prototype.slice,g=function(a,b,d){this.x=a||0;this.y=b||0;this.z=d||0},h={setVec3:function(a,b){a.x=b.x;a.y=b.y;a.z=b.z;return a},set:function(a,b,d,j){a.x=b;a.y=d;a.z=j;return a},add:function(a,b){return new g(a.x+b.x,a.y+b.y,a.z+b.z)},$add:function(a,
b){a.x+=b.x;a.y+=b.y;a.z+=b.z;return a},add2:function(a,b,d){a.x=b.x+d.x;a.y=b.y+d.y;a.z=b.z+d.z;return a},sub:function(a,b){return new g(a.x-b.x,a.y-b.y,a.z-b.z)},$sub:function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;return a},sub2:function(a,b,d){a.x=b.x-d.x;a.y=b.y-d.y;a.z=b.z-d.z;return a},scale:function(a,b){return new g(a.x*b,a.y*b,a.z*b)},$scale:function(a,b){a.x*=b;a.y*=b;a.z*=b;return a},neg:function(a){return new g(-a.x,-a.y,-a.z)},$neg:function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a},unit:function(a){var b=
g.norm(a);if(b>0)return g.scale(a,1/b);return g.clone(a)},$unit:function(a){var b=g.norm(a);if(b>0)return g.$scale(a,1/b);return a},cross:function(a,b){var d=a.x,j=a.y,l=a.z,o=b.x,p=b.y,w=b.z;return new g(j*w-l*p,l*o-d*w,d*p-j*o)},$cross:function(a,b){var d=a.x,j=a.y,l=a.z,o=b.x,p=b.y,w=b.z;a.x=j*w-l*p;a.y=l*o-d*w;a.z=d*p-j*o;return a},distTo:function(a,b){var d=a.x-b.x,j=a.y-b.y,l=a.z-b.z;return t(d*d,j*j,l*l)},distToSq:function(a,b){var d=a.x-b.x,j=a.y-b.y,l=a.z-b.z;return d*d+j*j+l*l},norm:function(a){var b=
a.x,d=a.y;a=a.z;return t(b*b+d*d+a*a)},normSq:function(a){var b=a.x,d=a.y;a=a.z;return b*b+d*d+a*a},dot:function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},clone:function(a){return new g(a.x,a.y,a.z)}},k=g.prototype={},r;for(r in h){g[r]=h[r];k[r]=function(a){return function(){var b=c.call(arguments);b.unshift(this);return g[a].apply(g,b)}}(r)}var u=function(a,b,d,j,l,o,p,w,y,x,z,D,C,B,E,F){typeof a=="number"?this.set(a,b,d,j,l,o,p,w,y,x,z,D,C,B,E,F):this.id()};h={id:function(a){a.n11=a.n22=a.n33=a.n44=
1;a.n12=a.n13=a.n14=0;a.n21=a.n23=a.n24=0;a.n31=a.n32=a.n34=0;a.n41=a.n42=a.n43=0;return a},set:function(a,b,d,j,l,o,p,w,y,x,z,D,C,B,E,F,G){a.n11=b;a.n12=d;a.n13=j;a.n14=l;a.n21=o;a.n22=p;a.n23=w;a.n24=y;a.n31=x;a.n32=z;a.n33=D;a.n34=C;a.n41=B;a.n42=E;a.n43=F;a.n44=G;return a},mulVec3:function(a,b){var d=b.x,j=b.y,l=b.z;return new g(a.n11*d+a.n12*j+a.n13*l+a.n14,a.n21*d+a.n22*j+a.n23*l+a.n24,a.n31*d+a.n32*j+a.n33*l+a.n34)},$mulVec3:function(a,b){var d=b.x,j=b.y,l=b.z;b.x=a.n11*d+a.n12*j+a.n13*l+a.n14;
b.y=a.n21*d+a.n22*j+a.n23*l+a.n24;b.z=a.n31*d+a.n32*j+a.n33*l+a.n34;return b},mulMat42:function(a,b,d){var j=b.n11,l=b.n12,o=b.n13,p=b.n14,w=b.n21,y=b.n22,x=b.n23,z=b.n24,D=b.n31,C=b.n32,B=b.n33,E=b.n34,F=b.n41,G=b.n42,H=b.n43;b=b.n44;var I=d.n11,J=d.n12,K=d.n13,L=d.n14,M=d.n21,N=d.n22,O=d.n23,P=d.n24,Q=d.n31,R=d.n32,S=d.n33,A=d.n34,U=d.n41,V=d.n42,W=d.n43;d=d.n44;a.n11=j*I+l*M+o*Q+p*U;a.n12=j*J+l*N+o*R+p*V;a.n13=j*K+l*O+o*S+p*W;a.n14=j*L+l*P+o*A+p*d;a.n21=w*I+y*M+x*Q+z*U;a.n22=w*J+y*N+x*R+z*V;a.n23=
w*K+y*O+x*S+z*W;a.n24=w*L+y*P+x*A+z*d;a.n31=D*I+C*M+B*Q+E*U;a.n32=D*J+C*N+B*R+E*V;a.n33=D*K+C*O+B*S+E*W;a.n34=D*L+C*P+B*A+E*d;a.n41=F*I+G*M+H*Q+b*U;a.n42=F*J+G*N+H*R+b*V;a.n43=F*K+G*O+H*S+b*W;a.n44=F*L+G*P+H*A+b*d;return a},mulMat4:function(a,b){var d=a.n11,j=a.n12,l=a.n13,o=a.n14,p=a.n21,w=a.n22,y=a.n23,x=a.n24,z=a.n31,D=a.n32,C=a.n33,B=a.n34,E=a.n41,F=a.n42,G=a.n43,H=a.n44,I=b.n11,J=b.n12,K=b.n13,L=b.n14,M=b.n21,N=b.n22,O=b.n23,P=b.n24,Q=b.n31,R=b.n32,S=b.n33,A=b.n34,U=b.n41,V=b.n42,W=b.n43,X=b.n44,
T=new u;T.n11=d*I+j*M+l*Q+o*U;T.n12=d*J+j*N+l*R+o*V;T.n13=d*K+j*O+l*S+o*W;T.n14=d*L+j*P+l*A+o*X;T.n21=p*I+w*M+y*Q+x*U;T.n22=p*J+w*N+y*R+x*V;T.n23=p*K+w*O+y*S+x*W;T.n24=p*L+w*P+y*A+x*X;T.n31=z*I+D*M+C*Q+B*U;T.n32=z*J+D*N+C*R+B*V;T.n33=z*K+D*O+C*S+B*W;T.n34=z*L+D*P+C*A+B*X;T.n41=E*I+F*M+G*Q+H*U;T.n42=E*J+F*N+G*R+H*V;T.n43=E*K+F*O+G*S+H*W;T.n44=E*L+F*P+G*A+H*X;return T},$mulMat4:function(a,b){var d=a.n11,j=a.n12,l=a.n13,o=a.n14,p=a.n21,w=a.n22,y=a.n23,x=a.n24,z=a.n31,D=a.n32,C=a.n33,B=a.n34,E=a.n41,
F=a.n42,G=a.n43,H=a.n44,I=b.n11,J=b.n12,K=b.n13,L=b.n14,M=b.n21,N=b.n22,O=b.n23,P=b.n24,Q=b.n31,R=b.n32,S=b.n33,A=b.n34,U=b.n41,V=b.n42,W=b.n43,X=b.n44;a.n11=d*I+j*M+l*Q+o*U;a.n12=d*J+j*N+l*R+o*V;a.n13=d*K+j*O+l*S+o*W;a.n14=d*L+j*P+l*A+o*X;a.n21=p*I+w*M+y*Q+x*U;a.n22=p*J+w*N+y*R+x*V;a.n23=p*K+w*O+y*S+x*W;a.n24=p*L+w*P+y*A+x*X;a.n31=z*I+D*M+C*Q+B*U;a.n32=z*J+D*N+C*R+B*V;a.n33=z*K+D*O+C*S+B*W;a.n34=z*L+D*P+C*A+B*X;a.n41=E*I+F*M+G*Q+H*U;a.n42=E*J+F*N+G*R+H*V;a.n43=E*K+F*O+G*S+H*W;a.n44=E*L+F*P+G*A+H*
X;return a},add:function(a,b){var d=new u;d.n11=a.n11+b.n11;d.n12=a.n12+b.n12;d.n13=a.n13+b.n13;d.n14=a.n14+b.n14;d.n21=a.n21+b.n21;d.n22=a.n22+b.n22;d.n23=a.n23+b.n23;d.n24=a.n24+b.n24;d.n31=a.n31+b.n31;d.n32=a.n32+b.n32;d.n33=a.n33+b.n33;d.n34=a.n34+b.n34;d.n41=a.n41+b.n41;d.n42=a.n42+b.n42;d.n43=a.n43+b.n43;d.n44=a.n44+b.n44;return d},$add:function(a,b){a.n11+=b.n11;a.n12+=b.n12;a.n13+=b.n13;a.n14+=b.n14;a.n21+=b.n21;a.n22+=b.n22;a.n23+=b.n23;a.n24+=b.n24;a.n31+=b.n31;a.n32+=b.n32;a.n33+=b.n33;
a.n34+=b.n34;a.n41+=b.n41;a.n42+=b.n42;a.n43+=b.n43;a.n44+=b.n44;return a},transpose:function(a){return new u(a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44)},$transpose:function(a){return u.set(a,a.n11,a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44)},rotateAxis:function(a,b,d){var j=q(b);b=n(b);var l=1-b,o=d.x,p=d.y;d=d.z;j=new u(o*o*l+b,o*p*l-d*j,o*d*l+p*j,0,p*o*l+d*j,p*p*l+b,p*d*l-o*j,0,o*d*l-p*j,p*d*l+
o*j,d*d*l+b,0,0,0,0,1);return u.mulMat4(a,j)},$rotateAxis:function(a,b,d){var j=q(b);b=n(b);var l=1-b,o=d.x,p=d.y;d=d.z;j=new u(o*o*l+b,o*p*l-d*j,o*d*l+p*j,0,p*o*l+d*j,p*p*l+b,p*d*l-o*j,0,o*d*l-p*j,p*d*l+o*j,d*d*l+b,0,0,0,0,1);return u.$mulMat4(a,j)},rotateXYZ:function(a,b,d,j){b=new u(n(d)*n(j),-n(b)*q(j)+q(b)*q(d)*n(j),q(b)*q(j)+n(b)*q(d)*n(j),0,n(d)*q(j),n(b)*n(j)+q(b)*q(d)*q(j),-q(b)*n(j)+n(b)*q(d)*q(j),0,-q(d),q(b)*n(d),n(b)*n(d),0,0,0,0,1);return u.mulMat4(a,b)},$rotateXYZ:function(a,b,d,j){b=
new u(n(d)*n(j),-n(b)*q(j)+q(b)*q(d)*n(j),q(b)*q(j)+n(b)*q(d)*n(j),0,n(d)*q(j),n(b)*n(j)+q(b)*q(d)*q(j),-q(b)*n(j)+n(b)*q(d)*q(j),0,-q(d),q(b)*n(d),n(b)*n(d),0,0,0,0,1);return u.$mulMat4(a,b)},translate:function(a,b,d,j){b=new u(1,0,0,b,0,1,0,d,0,0,1,j,0,0,0,1);return u.mulMat4(a,b)},$translate:function(a,b,d,j){b=new u(1,0,0,b,0,1,0,d,0,0,1,j,0,0,0,1);return u.$mulMat4(a,b)},scale:function(a,b,d,j){b=new u(b,0,0,0,0,d,0,0,0,0,j,0,0,0,0,1);return u.mulMat4(a,b)},$scale:function(a,b,d,j){b=new u(b,
0,0,0,0,d,0,0,0,0,j,0,0,0,0,1);return u.$mulMat4(a,b)},invert:function(a){var b=new u,d=a.n11,j=a.n12,l=a.n13,o=a.n14,p=a.n21,w=a.n22,y=a.n23,x=a.n24,z=a.n31,D=a.n32,C=a.n33,B=a.n34,E=a.n41,F=a.n42,G=a.n43;a=a.n44;var H=d*w-j*p,I=d*y-l*p,J=d*x-o*p,K=j*y-l*w,L=j*x-o*w,M=l*x-o*y,N=z*F-D*E,O=z*G-C*E,P=z*a-B*E,Q=D*G-C*F,R=D*a-B*F,S=C*a-B*G,A=1/(H*S-I*R+J*Q+K*P-L*O+M*N);b.n11=(+w*S-y*R+x*Q)*A;b.n12=(-j*S+l*R-o*Q)*A;b.n13=(+F*M-G*L+a*K)*A;b.n14=(-D*M+C*L-B*K)*A;b.n21=(-p*S+y*P-x*O)*A;b.n22=(+d*S-l*P+o*
O)*A;b.n23=(-E*M+G*J-a*I)*A;b.n24=(+z*M-C*J+B*I)*A;b.n31=(+p*R-w*P+x*N)*A;b.n32=(-d*R+j*P-o*N)*A;b.n33=(+E*L-F*J+a*H)*A;b.n34=(-z*L+D*J-B*H)*A;b.n41=(-p*Q+w*O-y*N)*A;b.n42=(+d*Q-j*O+l*N)*A;b.n43=(-E*K+F*I-G*H)*A;b.n44=(+z*K-D*I+C*H)*A;return b},$invert:function(a){var b=a.n11,d=a.n12,j=a.n13,l=a.n14,o=a.n21,p=a.n22,w=a.n23,y=a.n24,x=a.n31,z=a.n32,D=a.n33,C=a.n34,B=a.n41,E=a.n42,F=a.n43,G=a.n44,H=b*p-d*o,I=b*w-j*o,J=b*y-l*o,K=d*w-j*p,L=d*y-l*p,M=j*y-l*w,N=x*E-z*B,O=x*F-D*B,P=x*G-C*B,Q=z*F-D*E,R=z*
G-C*E,S=D*G-C*F,A=1/(H*S-I*R+J*Q+K*P-L*O+M*N);a.n11=(+p*S-w*R+y*Q)*A;a.n12=(-d*S+j*R-l*Q)*A;a.n13=(+E*M-F*L+G*K)*A;a.n14=(-z*M+D*L-C*K)*A;a.n21=(-o*S+w*P-y*O)*A;a.n22=(+b*S-j*P+l*O)*A;a.n23=(-B*M+F*J-G*I)*A;a.n24=(+x*M-D*J+C*I)*A;a.n31=(+o*R-p*P+y*N)*A;a.n32=(-b*R+d*P-l*N)*A;a.n33=(+B*L-E*J+G*H)*A;a.n34=(-x*L+z*J-C*H)*A;a.n41=(-o*Q+p*O-w*N)*A;a.n42=(+b*Q-d*O+j*N)*A;a.n43=(-B*K+E*I-F*H)*A;a.n44=(+x*K-z*I+D*H)*A;return a},lookAt:function(a,b,d,j){d=g.sub(b,d);d.$unit();j=g.cross(j,d);j.$unit();var l=
g.cross(d,j);l.$unit();return u.set(a,j.x,j.y,j.z,-j.dot(b),l.x,l.y,l.z,-l.dot(b),d.x,d.y,d.z,-d.dot(b),0,0,0,1)},frustum:function(a,b,d,j,l,o,p){return u.set(a,2*o/(d-b),0,(d+b)/(d-b),0,0,2*o/(l-j),(l+j)/(l-j),0,0,0,-(p+o)/(p-o),-2*p*o/(p-o),0,0,-1,0)},perspective:function(a,b,d,j,l){b=j*i(b*f/360);var o=-b;return u.frustum(a,o*d,b*d,o,b,j,l)},ortho:function(a,b,d,j,l,o,p){var w=d-b,y=l-j,x=p-o;return u.set(a,2/w,0,0,-((d+b)/w),0,2/y,0,-((l+j)/y),0,0,-2/x,-((p+o)/x),0,0,0,1)},toFloat32Array:function(a){return new Float32Array([a.n11,
a.n21,a.n31,a.n41,a.n12,a.n22,a.n32,a.n42,a.n13,a.n23,a.n33,a.n43,a.n14,a.n24,a.n34,a.n44])}};k=u.prototype={};for(r in h){u[r]=h[r];k[r]=function(a){return function(){var b=c.call(arguments);b.unshift(this);return u[a].apply(u,b)}}(r)}var v=function(a,b,d,j){this.x=a||0;this.y=b||0;this.z=d||0;this.w=j||0};h={setQuat:function(a,b){a.x=b.x;a.y=b.y;a.z=b.z;a.w=b.w;return a},set:function(a,b,d,j,l){a.x=b||0;a.y=d||0;a.z=j||0;a.w=l||0;return a},clone:function(a){return new v(a.x,a.y,a.z,a.w)},neg:function(a){return new v(-a.x,
-a.y,-a.z,-a.w)},$neg:function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;a.w=-a.w;return a},add:function(a,b){return new v(a.x+b.x,a.y+b.y,a.z+b.z,a.w+b.w)},$add:function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;a.w+=b.w;return a},sub:function(a,b){return new v(a.x-b.x,a.y-b.y,a.z-b.z,a.w-b.w)},$sub:function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;a.w-=b.w;return a},scale:function(a,b){return new v(a.x*b,a.y*b,a.z*b,a.w*b)},$scale:function(a,b){a.x*=b;a.y*=b;a.z*=b;a.w*=b;return a},mulQuat:function(a,b){var d=a.x,j=a.y,l=a.z,
o=a.w,p=b.x,w=b.y,y=b.z,x=b.w;return new v(o*p+d*x+j*y-l*w,o*w+j*x+l*p-d*y,o*y+l*x+d*w-j*p,o*x-d*p-j*w-l*y)},$mulQuat:function(a,b){var d=a.x,j=a.y,l=a.z,o=a.w,p=b.x,w=b.y,y=b.z,x=b.w;a.a=o*p+d*x+j*y-l*w;a.b=o*w+j*x+l*p-d*y;a.c=o*y+l*x+d*w-j*p;a.d=o*x-d*p-j*w-l*y;return a},div:function(a,b){var d=a.x,j=a.y,l=a.z,o=a.w,p=b.x,w=b.y,y=b.z,x=b.w,z=1/(x*x+p*p+w*w+y*y);return new v((d*x-o*p-j*y+l*w)*z,(d*y-o*w+j*x-l*p)*z,(j*p+l*x-o*y-d*w)*z,(o*x+d*p+j*w+l*y)*z)},$div:function(a,b){var d=a.x,j=a.y,l=a.z,
o=a.w,p=b.x,w=b.y,y=b.z,x=b.w,z=1/(x*x+p*p+w*w+y*y);a.a=(d*x-o*p-j*y+l*w)*z;a.b=(d*y-o*w+j*x-l*p)*z;a.c=(j*p+l*x-o*y-d*w)*z;a.d=(o*x+d*p+j*w+l*y)*z;return a},invert:function(a){var b=a.x,d=a.y,j=a.z;a=a.w;var l=1/(b*b+d*d+j*j+a*a);return new v(-b*l,-d*l,-j*l,a*l)},$invert:function(a){var b=a.x,d=a.y,j=a.z,l=a.w,o=1/(b*b+d*d+j*j+l*l);a.a=-b*o;a.b=-d*o;a.c=-j*o;a.d=l*o;return a},norm:function(a){var b=a.x,d=a.y,j=a.z;a=a.w;return t(b*b+d*d+j*j+a*a)},normSq:function(a){var b=a.x,d=a.y,j=a.z;a=a.w;return b*
b+d*d+j*j+a*a},unit:function(a){return v.scale(a,1/v.norm(a))},$unit:function(a){return v.$scale(a,1/v.norm(a))},conjugate:function(a){return new v(-a.x,-a.y,-a.z,a.w)},$conjugate:function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a}};k=v.prototype={};for(r in h){v[r]=h[r];k[r]=function(a){return function(){var b=c.call(arguments);b.unshift(this);return v[a].apply(v,b)}}(r)}g.fromQuat=function(a){return new g(a.x,a.y,a.z)};v.fromVec3=function(a,b){return new v(a.x,a.y,a.z,b||0)};v.fromMat4=function(a){var b,
d,j;if(a.n11>a.n22&&a.n11>a.n33){b=0;d=1;j=2}else if(a.n22>a.n11&&a.n22>a.n33){b=1;d=2;j=0}else{b=2;d=0;j=1}var l=t(1+a["n"+b+""+b]-a["n"+d+""+d]-a["n"+j+""+j]),o=new v,p=["x","y","z"];o[p[b]]=0.5*l;o[p[d]]=0.5*(a["n"+d+""+b]+a["n"+b+""+d])/l;o[p[j]]=0.5*(a["n"+b+""+j]+a["n"+j+""+b])/l;o.w=0.5*(a["n"+d+""+j]-a["n"+j+""+d])/l;return o};v.fromXRotation=function(a){return new v(q(a/2),0,0,n(a/2))};v.fromYRotation=function(a){return new v(0,q(a/2),0,n(a/2))};v.fromZRotation=function(a){return new v(0,
0,q(a/2),n(a/2))};v.fromAxisRotation=function(a,b){var d=a.x,j=a.y,l=a.z,o=1/t(d*d+j*j+l*l),p=q(b/2),w=n(b/2);return new v(p*d*o,p*j*o,p*l*o,w)};u.fromQuat=function(a){var b=a.w,d=a.x,j=a.y;a=a.z;return new u(b*b+d*d-j*j-a*a,2*d*j-2*b*a,2*d*a+2*b*j,0,2*d*j+2*b*a,b*b-d*d+j*j-a*a,2*j*a-2*b*d,0,2*d*a-2*b*j,2*j*a+2*b*d,b*b-d*d-j*j+a*a,0,0,0,0,1)};PhiloGL.Vec3=g;PhiloGL.Mat4=u;PhiloGL.Quat=v})();(function(){function t(c){return c!==true?c:false}var q=function(c){var g=function(h){for(var k={x:0,y:0};h&&
!/^(?:body|html)$/i.test(h.tagName);){k.x+=h.offsetLeft;k.y+=h.offsetTop;h=h.offsetParent}return k}(c);c=function(h){for(var k={x:0,y:0};h&&!/^(?:body|html)$/i.test(h.tagName);){k.x+=h.scrollLeft;k.y+=h.scrollTop;h=h.parentNode}return k}(c);return{x:g.x-c.x,y:g.y-c.y}},n={get:function(c,g){return c||(g||window).event},getWheel:function(c){return c.wheelDelta?c.wheelDelta/120:-(c.detail||0)/3},getKey:function(c){var g=c.which||c.keyCode,h;a:{h=f.Keys;for(var k in h)if(h[k]==g){h=k;break a}h=void 0}k=
g-111;if(k>0&&k<13)h="f"+k;h=h||String.fromCharCode(g).toLowerCase();return{code:g,key:h,shift:c.shiftKey,control:c.ctrlKey,alt:c.altKey,meta:c.metaKey}},isRightClick:function(c){return c.which==3||c.button==2},getPos:function(c,g){g=g||window;c=c||g.event;var h=g.document;h=h.documentElement||h.body;if(c.touches&&c.touches.length)c=c.touches[0];return{x:c.pageX||c.clientX+h.scrollLeft,y:c.pageY||c.clientY+h.scrollTop}},stop:function(c){c.stopPropagation&&c.stopPropagation();c.cancelBubble=true;if(c.preventDefault)c.preventDefault();
else c.returnValue=false}},i=function(c,g){var h=c.canvas;this.scene=c.scene;this.domElem=h;this.pos=q(h);this.opt=this.callbacks=g;this.size={width:h.width||h.offsetWidth,height:h.height||h.offsetHeight};this.attachEvents()};i.prototype={hovered:false,pressed:false,touched:false,touchMoved:false,moved:false,attachEvents:function(){var c=this.domElem,g=this;if(this.opt.disableContextMenu)c.oncontextmenu=function(){return false};["mouseup","mousedown","mousemove","mouseover","mouseout","touchstart",
"touchmove","touchend"].forEach(function(k){c.addEventListener(k,function(r,u){g[k](g.eventInfo(k,r,u))},false)});["keydown","keyup"].forEach(function(k){document.addEventListener(k,function(r,u){g[k](g.eventInfo(k,r,u))},false)});var h="";h=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";c.addEventListener(h,function(k,r){g.mousewheel(g.eventInfo("mousewheel",k,r))},false)},eventInfo:function(c,g,h){var k=this.domElem,r=this.scene,u=this.opt,v=this.getSize(),
a=u.relative,b=u.centerOrigin,d=u.cachePosition&&this.pos||q(k),j=n.get(g,h),l=n.getPos(g,h);g={};h=l.x;k=l.y;if(a){h-=d.x;k-=d.y;if(b){h-=v.width/2;k-=v.height/2;k*=-1}}switch(c){case "mousewheel":g.wheel=n.getWheel(j);break;case "keydown":s.extend(g,n.getKey(j));break;case "mouseup":g.isRightClick=n.isRightClick(j)}var o;s.extend(g,{x:h,y:k,cache:false,stop:function(){n.stop(j)},getTarget:function(){if(o)return o;return o=!u.picking||r.pick(l.x-d.x,l.y-d.y)||true}});g.event=j;return g},getSize:function(){if(this.cacheSize)return this.size;
var c=this.domElem;return{width:c.width||c.offsetWidth,height:c.height||c.offsetHeight}},mouseup:function(c){if(!this.moved)if(c.isRightClick)this.callbacks.onRightClick(c,this.hovered);else this.callbacks.onClick(c,t(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(c,t(this.pressed));else this.callbacks.onDragCancel(c,t(this.pressed));this.pressed=this.moved=false}},mouseout:function(c){for(var g=c.relatedTarget,h=this.domElem;g&&g.parentNode;){if(h==g.parentNode)return;g=g.parentNode}if(this.hovered){this.callbacks.onMouseLeave(c,
this.hovered);this.hovered=false}},mouseover:function(){},mousemove:function(c){if(this.pressed){this.moved=true;this.callbacks.onDragMove(c,t(this.pressed))}else if(this.hovered){var g=t(c.getTarget());if(this.hovered!=g){this.callbacks.onMouseLeave(c,this.hovered);if(this.hovered=g)this.callbacks.onMouseEnter(c,this.hovered)}else this.callbacks.onMouseMove(c,this.hovered)}else if(this.hovered=t(c.getTarget()))this.callbacks.onMouseEnter(c,this.hovered)},mousewheel:function(c){this.callbacks.onMouseWheel(c)},
mousedown:function(c){this.pressed=c.getTarget();this.callbacks.onDragStart(c,t(this.pressed))},touchstart:function(c){this.touched=c.getTarget();this.callbacks.onTouchStart(c,t(this.touched))},touchmove:function(c){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(c,t(this.touched))}},touchend:function(c){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(c,t(this.touched));else this.callbacks.onTouchCancel(c,t(this.touched));this.touched=this.touchMoved=false}},keydown:function(c){this.callbacks.onKeyDown(c)},
keyup:function(c){this.callbacks.onKeyUp(c)}};var f={};f.create=function(c,g){g=s.merge({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,onClick:s.empty,onRightClick:s.empty,onDragStart:s.empty,onDragMove:s.empty,onDragEnd:s.empty,onDragCancel:s.empty,onTouchStart:s.empty,onTouchMove:s.empty,onTouchEnd:s.empty,onTouchCancel:s.empty,onMouseMove:s.empty,onMouseEnter:s.empty,onMouseLeave:s.empty,onMouseWheel:s.empty,onKeyDown:s.empty,
onKeyUp:s.empty},g||{});var h=g.bind;if(h)for(var k in g)k.match(/^on[a-zA-Z0-9]+$/)&&function(r,u){g[r]=function(){return u.apply(h,Array.prototype.slice.call(arguments))}}(k,g[k]);new i(c,g)};f.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};PhiloGL.Events=f})();(function(){function t(){return arguments.length==2?{vs:arguments[0],fs:arguments[1]}:arguments[0]||{}}var q=function(f,c,g){var h=f.createShader(g);if(h==null)throw"Error creating the shader with shader type: "+
g;f.shaderSource(h,c);f.compileShader(h);if(!f.getShaderParameter(h,f.COMPILE_STATUS)){c=f.getShaderInfoLog(h);f.deleteShader(h);throw"Error while compiling the shader "+c;}return h},n=function(f,c,g){var h=m.getUniformLocation(f,c.name);f=c.type;if(c.size>1&&g)switch(f){case m.FLOAT:return function(k){m.uniform1fv(h,new Float32Array(k))};case m.INT:case m.BOOL:return function(k){m.uniform1iv(h,new Uint16Array(k))}}switch(f){case m.FLOAT:return function(k){m.uniform1f(h,k)};case m.FLOAT_VEC2:return function(k){m.uniform2fv(h,
new Float32Array(k))};case m.FLOAT_VEC3:return function(k){m.uniform3fv(h,new Float32Array(k))};case m.FLOAT_VEC4:return function(k){m.uniform4fv(h,new Float32Array(k))};case m.INT:case m.BOOL:case m.SAMPLER_2D:case m.SAMPLER_CUBE:return function(k){m.uniform1i(h,k)};case m.INT_VEC2:case m.BOOL_VEC2:return function(k){m.uniform2iv(h,new Uint16Array(k))};case m.INT_VEC3:case m.BOOL_VEC3:return function(k){m.uniform3iv(h,new Uint16Array(k))};case m.INT_VEC4:case m.BOOL_VEC4:return function(k){m.uniform4iv(h,
new Uint16Array(k))};case m.FLOAT_MAT2:return function(k){m.uniformMatrix2fv(h,false,k.toFloat32Array())};case m.FLOAT_MAT3:return function(k){m.uniformMatrix3fv(h,false,k.toFloat32Array())};case m.FLOAT_MAT4:return function(k){m.uniformMatrix4fv(h,false,k.toFloat32Array())}}throw"Unknown type: "+f;},i=function(f,c){var g=m,h=g.createProgram();g.attachShader(h,q(g,f,g.VERTEX_SHADER));g.attachShader(h,q(g,c,g.FRAGMENT_SHADER));g.linkProgram(h);if(!g.getProgramParameter(h,g.LINK_STATUS))throw"Error linking the shader: "+
g.getProgramInfoLog(h);if(!h)return false;g={};for(var k={},r=m.getProgramParameter(h,m.ACTIVE_ATTRIBUTES),u=0;u<r;u++){var v=m.getActiveAttrib(h,u),a=v.name;v=m.getAttribLocation(h,v.name);g[a]=v}r=m.getProgramParameter(h,m.ACTIVE_UNIFORMS);for(u=0;u<r;u++){v=m.getActiveUniform(h,u);a=v.name;a=a[a.length-1]=="]"?a.substr(0,a.length-3):a;k[a]=n(h,v,v.name!=a)}this.program=h;this.attributes=g;this.uniforms=k;this.buffers={};this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers=
{};this.renderBufferMemo={};this.textures={};this.textureMemo={}};i.prototype={$$family:"program",setState:function(f){s.extend(f,{buffers:this.buffers,bufferMemo:this.bufferMemo,renderBuffers:this.renderBuffers,renderBufferMemo:this.renderBufferMemo,frameBuffers:this.frameBuffers,frameBufferMemo:this.frameBufferMemo,textures:this.textures,textureMemo:this.textureMemo});return this},setUniform:function(f,c){if(this.uniforms[f])this.uniforms[f](c);return this},setUniforms:function(f){for(var c in f)this.setUniform(c,
f[c]);return this},setBuffer:function(f,c){if(c===false||c===null){(c=this.bufferMemo[f])&&m.bindBuffer(c.bufferType,null);var g=c&&c.attribute||f,h=this.attributes[g];h!==undefined&&m.disableVertexAttribArray(h)}else{c=s.merge({bufferType:m.ARRAY_BUFFER,size:1,dataType:m.FLOAT,stride:0,offset:0,drawType:m.STATIC_DRAW},this.bufferMemo[f]||{},c||{});g=c.attribute||f;var k=c.bufferType,r=f in this.buffers,u=r?this.buffers[f]:m.createBuffer(),v="value"in c,a=c.value,b=c.size,d=c.dataType,j=c.stride,
l=c.offset,o=c.drawType;h=this.attributes[g];var p=h!==undefined;r||(this.buffers[f]=u);p&&m.enableVertexAttribArray(h);m.bindBuffer(k,u);v&&m.bufferData(k,a,o);p&&m.vertexAttribPointer(h,b,d,false,j,l);delete c.value;this.bufferMemo[f]=c;if(p)this.bufferMemo[g]=c;return this}},setBuffers:function(f){for(var c in f)this.setBuffer(c,f[c]);return this},setFrameBuffer:function(f,c){if(typeof c!="object")m.bindFramebuffer(m.FRAMEBUFFER,c?this.frameBuffers[f]:null);else{c=s.merge({width:0,height:0,bindToTexture:false,
textureOptions:{attachment:m.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:m.DEPTH_ATTACHMENT}},this.frameBufferMemo[f]||{},c||{});var g=c.bindToTexture,h=c.bindToRenderBuffer,k=f in this.frameBuffers,r=k?this.frameBuffers[f]:m.createFramebuffer(m.FRAMEBUFFER);m.bindFramebuffer(m.FRAMEBUFFER,r);k||(this.frameBuffers[f]=r);if(g){g=s.merge({data:{width:c.width,height:c.height}},s.type(g)=="object"?g:{});k=f+"-texture";r=c.textureOptions;this.setTexture(k,g);m.framebufferTexture2D(m.FRAMEBUFFER,
r.attachment,this.textureMemo[k].textureType,this.textures[k],0)}if(h){h=s.merge({width:c.width,height:c.height},s.type(h)=="object"?h:{});g=f+"-renderbuffer";k=c.renderBufferOptions;this.setRenderBuffer(g,h);m.framebufferRenderbuffer(m.FRAMEBUFFER,k.attachment,m.RENDERBUFFER,this.renderBuffers[g])}m.bindTexture(m.TEXTURE_2D,null);m.bindRenderbuffer(m.RENDERBUFFER,null);m.bindFramebuffer(m.FRAMEBUFFER,null);this.frameBufferMemo[f]=c;return this}},setFrameBuffers:function(f){for(var c in f)this.setFrameBuffer(c,
f[c]);return this},setRenderBuffer:function(f,c){if(typeof c!="object")m.bindRenderbuffer(m.RENDERBUFFER,c?this.renderBufferMemo[f]:null);else{c=s.merge({storageType:m.DEPTH_COMPONENT16,width:0,height:0},this.renderBufferMemo[f]||{},c||{});var g=f in this.renderBuffers,h=g?this.renderBuffers[f]:m.createRenderbuffer(m.RENDERBUFFER);g||(this.renderBuffers[f]=h);m.bindRenderbuffer(m.RENDERBUFFER,h);m.renderbufferStorage(m.RENDERBUFFER,c.storageType,c.width,c.height);this.renderBufferMemo[f]=c;return this}},
setRenderBuffers:function(f){for(var c in f)this.setRenderBuffer(c,f[c]);return this},setTexture:function(f,c){if(!c||typeof c!="object"){m.activeTexture(c||m.TEXTURE0);m.bindTexture(this.textureMemo[f].textureType||m.TEXTURE_2D,this.textures[f])}else{c=s.merge({textureType:m.TEXTURE_2D,pixelStore:[{name:m.UNPACK_FLIP_Y_WEBGL,value:true}],parameters:[{name:m.TEXTURE_MAG_FILTER,value:m.NEAREST},{name:m.TEXTURE_MIN_FILTER,value:m.NEAREST}],data:{format:m.RGBA,value:false,width:0,height:0,border:0}},
this.textureMemo[f]||{},c||{});var g="textureType"in c?c.textureType:m.TEXTURE_2D,h=f in this.textures,k=h?this.textures[f]:m.createTexture(),r=c.pixelStore,u=c.parameters,v=c.data,a=!!c.data.value;h||(this.textures[f]=k);m.bindTexture(g,k);h||r.forEach(function(b){b.name=typeof b.name=="string"?m[b.name]:b.name;m.pixelStorei(b.name,b.value)});if(a)m.texImage2D(g,0,v.format,v.format,m.UNSIGNED_BYTE,v.value);else if(v.width||v.height)m.texImage2D(g,0,v.format,v.width,v.height,v.border,v.format,m.UNSIGNED_BYTE,
null);h||u.forEach(function(b){b.name=m.get(b.name);b.value=m.get(b.value);m.texParameteri(g,b.name,b.value);b.generateMipmap&&m.generateMipmap(g)});delete c.data;this.textureMemo[f]=c;return this}},setTextures:function(f){for(var c in f)this.setTexture(c,f[c]);return this},use:function(){m.useProgram(this.program);return this}};i.fromShaderIds=function(){var f=t.apply({},arguments),c=s(f.vs);f=s(f.fs);return new i(c.innerHTML,f.innerHTML)};i.fromShaderSources=function(f){f=t.apply({},arguments);
return new i(f.vs,f.fs)};i.fromDefaultShaders=function(){var f=t.apply({},arguments),c=PhiloGL.Shaders;return PhiloGL.Program.fromShaderSources(c.Vertex[f.vs||"Default"],c.Fragment[f.fs||"Default"])};i.fromShaderURIs=function(f){f=s.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:s.empty,onError:s.empty},f||{});var c=f.path+f.fs,g=PhiloGL.IO.XHR;(new g({url:f.path+f.vs,noCache:f.noCache,onError:function(h){f.onError(h)},onSuccess:function(h){(new g({url:c,noCache:f.noCache,onError:function(k){f.onError(k)},
onSuccess:function(k){f.onSuccess(i.fromShaderSources(h,k))}})).send()}})).send()};PhiloGL.Program=i})();(function(){var t={},q=function(f){this.opt=f=s.merge({url:"http://sencha.com/",method:"GET",async:true,noCache:false,sendAsBinary:false,onProgress:s.empty,onSuccess:s.empty,onError:s.empty,onAbort:s.empty,onComplete:s.empty},f||{});this.initXHR()};q.State={};["UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(f,c){q.State[f]=c});q.prototype={initXHR:function(){var f=
this.req=new XMLHttpRequest,c=this;["Progress","Error","Abort","Load"].forEach(function(g){f.addEventListener(g.toLowerCase(),function(h){c["handle"+g](h)},false)})},send:function(f){var c=this.req,g=this.opt,h=g.async;if(g.noCache)g.url+=(g.url.indexOf("?")>=0?"&":"?")+s.uid();c.open(g.method,g.url,h);if(h)c.onreadystatechange=function(){if(c.readyState==q.State.COMPLETED)if(c.status==200)g.onSuccess(c.responseText);else g.onError(c.status)};g.sendAsBinary?c.sendAsBinary(f||g.body||null):c.send(f||
g.body||null);if(!h)if(c.status==200)g.onSuccess(c.responseText);else g.onError(c.status)},setRequestHeader:function(f,c){this.req.setRequestHeader(f,c);return this},handleProgress:function(f){if(f.lengthComputable)this.opt.onProgress(f,Math.round(f.loaded/f.total*100));else this.opt.onProgress(f,-1)},handleError:function(f){this.opt.onError(f)},handleAbort:function(){this.opt.onAbort(e)},handleLoad:function(f){this.opt.onComplete(f)}};var n=function(f){f=s.merge({url:"http://sencha.com/",data:{},
noCache:false,onComplete:s.empty,callbackKey:"callback"},f||{});var c=n.counter++,g=[],h;for(h in f.data)g.push(h+"="+f.data[h]);g=g.join("&");if(f.noCache)g+=(g.indexOf("?")>=0?"&":"?")+s.uid();g=f.url+(f.url.indexOf("?")>-1?"&":"?")+f.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+c+(g.length>0?"&"+g:"");var k=document.createElement("script");k.type="text/javascript";k.src=g;n.requests["request_"+c]=function(r){f.onComplete(r);k.parentNode&&k.parentNode.removeChild(k);k.clearAttributes&&k.clearAttributes()};
document.getElementsByTagName("head")[0].appendChild(k)};n.counter=0;n.requests={};var i=function(f){f=s.merge({src:[],noCache:false,onProgress:s.empty,onComplete:s.empty},f||{});var c=0,g=f.src.length,h=function(){f.onProgress(Math.round(++c/g*100));if(c==g)f.onComplete(v)},k=function(){if(++c==g)f.onComplete(v)},r=f.noCache,u=s.uid(),v=f.src.map(function(a,b){var d=new Image;d.index=b;d.onload=h;d.onerror=k;d.src=a+(r?(a.indexOf("?")>=0?"&":"?")+u:"");return d});return v};t.XHR=q;t.JSONP=n;t.Images=
i;t.Textures=function(f,c){c=s.merge({src:[],noCache:false,onComplete:s.empty},c||{});i({src:c.src,noCache:c.noCache,onComplete:function(g){var h={};g.forEach(function(k,r){h[c.src[r]]=s.merge({data:{value:k}},c)});f.setTextures(h);c.onComplete()}})};PhiloGL.IO=t})();(function(){var t=PhiloGL.Vec3,q=PhiloGL.Mat4,n=function(i,f,c,g,h){h=h||{};var k=h.position,r=h.target;h=h.up;this.near=c;this.far=g;this.position=k&&new t(k.x,k.y,k.z)||new t;this.target=r&&new t(r.x,r.y,r.z)||new t;this.up=h&&new t(h.x,
h.y,h.z)||new t(0,1,0);this.projection=(new q).perspective(i,f,c,g);this.modelView=new q};n.prototype={update:function(){this.modelView.lookAt(this.position,this.target,this.up)}};PhiloGL.Camera=n})();(function(){(function(){try{var t=document.createElement("canvas");PhiloGL.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl")))}}catch(q){PhiloGL.hasWebGL=function(){return false}}})();PhiloGL.WebGL={getContext:function(t,q){t=typeof t==
"string"?s(t):t;var n;(n=t.getContext("experimental-webgl",q))||(n=t.getContext("webgl",q));if(n&&q&&q.debug){m={};for(var i in n){var f=n[i];m[i]=typeof f=="function"?function(c,g){return function(){console.log(c,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var h=g.apply(n,arguments)}catch(k){throw c+" "+k;}for(var r=[],u;(u=n.getError())!==n.NO_ERROR;)r.push(u);if(r.length)throw r.join();return h}}(i,f):f}}else m=n;if(m)m.get=function(c){return typeof c=="string"?
m[c]:c};return m}}})();(function(){var t=PhiloGL.Vec3,q=PhiloGL.Mat4;cos=Math.cos;sin=Math.sin;pi=Math.PI;max=Math.max;flatten=function(i){if(i&&i.length&&s.type(i[0])=="array")return[].concat.apply([],i);return i};var n={};n.Model=function(i){this.$$family="model";this.pickable=!!i.pickable;this.vertices=flatten(i.vertices);this.faces=flatten(i.faces);this.normals=flatten(i.normals);this.textures=i.textures&&s.splat(i.textures);this.centroids=flatten(i.centroids);this.colors=flatten(i.colors);this.indices=
flatten(i.indices);this.shininess=i.shininess||0;this.uniforms=i.uniforms||{};this.render=i.render;this.drawType=i.drawType;this.display="display"in i?i.display:true;if(i.texCoords)this.texCoords=s.type(i.texCoords)=="object"?i.texCoords:flatten(i.texCoords);this.onBeforeRender=i.onBeforeRender||s.empty;this.onAfterRender=i.onAfterRender||s.empty;this.position=new t;this.rotation=new t;this.scale=new t(1,1,1);this.matrix=new q;this.normalizeColors();i.computeCentroids&&this.computeCentroids();i.computeNormals&&
this.computeNormals()};n.Model.prototype={update:function(){var i=this.matrix,f=this.position,c=this.rotation,g=this.scale;i.id();i.$translate(f.x,f.y,f.z);i.$rotateXYZ(c.x,c.y,c.z);i.$scale(g.x,g.y,g.z)},toFloat32Array:function(i){return new Float32Array(this[i])},toUint16Array:function(i){return new Uint16Array(this[i])},normalizeColors:function(){if(this.vertices){var i=this.vertices.length*4/3;if(this.colors&&this.colors.length<i){i/=this.colors.length;for(var f=this.colors,c=f.slice();--i;)f.push.apply(f,
c)}}},computeCentroids:function(){var i=this.vertices,f=[];this.faces.forEach(function(c){var g=[0,0,0],h=0;c.forEach(function(k){k=i[k];g[0]+=k[0];g[1]+=k[1];g[2]+=k[2];h++});g[0]/=h;g[1]/=h;g[2]/=h;f.push(g)});this.centroids=f},computeNormals:function(){var i=this.vertices,f=[];this.faces.forEach(function(c){var g=i[c[0]],h=i[c[1]];c=i[c[2]];g={x:g[0]-h[0],y:g[1]-h[1],z:g[2]-h[2]};t.$cross(g,{x:c[0]-h[0],y:c[1]-h[1],z:c[1]-h[2]});t.norm(g)>1.0E-6&&t.unit(g);f.push([g.x,g.y,g.z])});this.normals=
f}};s.extend(n.Model.prototype,{setUniforms:function(i){i.setUniforms(this.uniforms)},setShininess:function(i){i.setUniform("shininess",this.shininess||0)},setVertices:function(i,f){if(this.vertices)f||this.dynamic?i.setBuffer("vertices-"+this.id,{attribute:"position",value:this.toFloat32Array("vertices"),size:3}):i.setBuffer("vertices-"+this.id)},unsetVertices:function(i){i.setBuffer("vertices-"+this.id,false)},setNormals:function(i,f){if(this.normals)f||this.dynamic?i.setBuffer("normals-"+this.id,
{attribute:"normal",value:this.toFloat32Array("normals"),size:3}):i.setBuffer("normals-"+this.id)},unsetNormals:function(i){i.setBuffer("normals-"+this.id,false)},setIndices:function(i,f){if(this.indices)f||this.dynamic?i.setBuffer("indices-"+this.id,{bufferType:m.ELEMENT_ARRAY_BUFFER,drawType:m.STATIC_DRAW,value:this.toUint16Array("indices"),size:1}):i.setBuffer("indices-"+this.id)},unsetIndices:function(i){i.setBuffer("indices-"+this.id,false)},setColors:function(i,f){if(this.colors)f||this.dynamic?
i.setBuffer("colors-"+this.id,{attribute:"color",value:this.toFloat32Array("colors"),size:4}):i.setBuffer("colors-"+this.id)},unsetColors:function(i){i.setBuffer("colors-"+this.id,false)},setTexCoords:function(i,f){if(this.texCoords){var c=this.id;if(f||this.dynamic)s.type(this.texCoords)=="object"?this.textures.forEach(function(g,h){i.setBuffer("texCoords-"+h+"-"+c,{attribute:"texCoord"+(h+1),value:new Float32Array(this.texCoords[g]),size:2})}):i.setBuffer("texCoords-"+c,{attribute:"texCoord1",value:this.toFloat32Array("texCoords"),
size:2});else s.type(this.texCoords)=="object"?this.textures.forEach(function(g,h){i.setBuffer("texCoords-"+h+"-"+c)}):i.setBuffer("texCoords-"+c)}},unsetTexCoords:function(i){i.setBuffer("texCoords-"+this.id,false)},setTextures:function(i){this.textures=this.textures?s.splat(this.textures):[];for(var f=0,c=this.textures,g=c.length,h=PhiloGL.Scene.MAX_TEXTURES;f<h;f++)if(f<g){i.setUniform("hasTexture"+(f+1),true);i.setUniform("sampler"+(f+1),f);i.setTexture(c[f],m["TEXTURE"+f])}else i.setUniform("hasTexture"+
(f+1),false)}});n.Cube=function(i){n.Model.call(this,s.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,
0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},i||{}))};n.Cube.prototype=Object.create(n.Model.prototype);n.Sphere=function(i){var f=i.nlat||10,c=i.nlong||10,g=i.radius||1,h=pi-0,k=2*pi-0,r=[],u=[],v=[],a=[];if(typeof g=="number"){var b=g;g=function(){return b}}for(var d=0;d<=c;d++)for(var j=0;j<=f;j++){var l=j/f,o=d/c,p=k*l,w=h*o,y=sin(p),x=cos(p);p=sin(w);var z=cos(w);w=x*p;x=z;y*=p;p=g(w,x,y,l,o);r.push(p*w,p*x,
p*y);u.push(w,x,y);v.push(l,o)}g=f+1;for(j=0;j<f;j++)for(d=0;d<c;d++){a.push(d*g+j,d*g+j+1,(d+1)*g+j);a.push((d+1)*g+j,d*g+j+1,(d+1)*g+j+1)}n.Model.call(this,s.extend({vertices:r,indices:a,normals:u,texCoords:v},i||{}))};n.Sphere.prototype=Object.create(n.Model.prototype);n.TruncatedCone=function(i){var f=i.bottomRadius||0,c=i.topRadius||0,g=i.height||1,h=i.nradial||10,k=i.nvertical||10,r=!!i.topCap,u=!!i.bottomCap,v=(r?2:0)+(u?2:0),a=[],b=[],d=[],j=[],l=h+1,o=Math.atan2(f-c,g),p=Math,w=p.sin,y=p.cos;
p=p.PI;var x=y(o);o=w(o);u=k+(u?2:0);for(r=r?-2:0;r<=u;r++){var z=r/k,D=g*z,C;if(r<0){D=0;z=1;C=f}else if(r>k){D=g;z=1;C=c}else C=f+(c-f)*(r/k);if(r==-2||r==k+2)z=C=0;D-=g/2;for(var B=0;B<l;B++){var E=w(B*p*2/h),F=y(B*p*2/h);a.push(E*C,D,F*C);b.push(r<0||r>k?0:E*x,r<0?-1:r>k?1:o,r<0||r>k?0:F*x);d.push(B/h,z)}}for(r=0;r<k+v;r++)for(B=0;B<h;B++)j.push(l*(r+0)+0+B,l*(r+0)+1+B,l*(r+1)+1+B,l*(r+0)+0+B,l*(r+1)+1+B,l*(r+1)+0+B);n.Model.call(this,s.extend({vertices:a,normals:b,texCoords:d,indices:j},i||{}))};
n.TruncatedCone.prototype=Object.create(n.Model.prototype);n.Cone=function(i){i.topRadius=0;i.topCap=!!i.cap;i.bottomCap=!!i.cap;i.bottomRadius=i.radius||3;n.TruncatedCone.call(this,i)};n.Cone.prototype=Object.create(n.TruncatedCone.prototype);n.Cylinder=function(i){i.bottomRadius=i.radius;i.topRadius=i.radius;n.TruncatedCone.call(this,i)};n.Cylinder.prototype=Object.create(n.TruncatedCone.prototype);PhiloGL.O3D=n})();(function(){var t={Vertex:{},Fragment:{}},q=t.Fragment;t.Vertex.Default="#define LIGHT_MAX 50\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec2 texCoord1;\nuniform mat4 modelViewMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 normalMatrix;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nvarying vec4 vColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nvec4 transformedNormal = normalMatrix * vec4(normal, 1.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nvColor = color;\nvTexCoord = texCoord1;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";
q.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool enablePicking;\nuniform vec3 pickColor;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif(!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif(enablePicking) {\ngl_FragColor = vec4(pickColor, 1.0);\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
PhiloGL.Shaders=t})();(function(){var t=PhiloGL.Vec3,q=PhiloGL.Mat4,n=function(i,f,c){c=s.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},c||{});this.program=i;this.camera=f;this.models=[];this.config=c;this.setupPicking()};n.prototype={add:function(){for(var i=0,f=this.models,c=arguments.length;i<c;i++){var g=arguments[i];g.id=g.id||n.id++;f.push(g);this.defineBuffers(g)}},defineBuffers:function(i){var f=this.program;
i.setVertices(f,true);i.setColors(f,true);i.setNormals(f,true);i.setTexCoords(f,true);i.setIndices(f,true)},beforeRender:function(){this.setupLighting();this.setupEffects();var i=this.camera,f=this.program;f.setUniform("projectionMatrix",i.projection);f.setUniform("viewMatrix",i.modelView)},setupLighting:function(){var i=this.program,f=this.config.lights,c=f.ambient,g=f.directional,h=g.color,k=g.direction,r=f.enable;g=f.points&&s.splat(f.points)||[];var u=g.length,v=[],a=[],b=[],d=[];k=t.unit(k).$scale(-1);
i.setUniform("enableLights",r);if(f.enable){i.setUniform("ambientColor",[c.r,c.g,c.b]);i.setUniform("directionalColor",[h.r,h.g,h.b]);i.setUniform("lightingDirection",[k.x,k.y,k.z])}i.setUniform("numberPoints",u);for(f=0;f<u;f++){k=g[f];c=k.position;h=k.color||k.diffuse;k=k.specular;v.push(c.x,c.y,c.z);a.push(h.r,h.g,h.b);b.push(+!!k);k?d.push(k.r,k.g,k.b):d.push(0,0,0)}i.setUniforms({pointLocation:v,pointColor:a});i.setUniforms({enableSpecular:b,pointSpecularColor:d})},setupEffects:function(){var i=
this.program,f=this.config.effects.fog,c=f.color||{r:0.5,g:0.5,b:0.5};f?i.setUniforms({hasFog:true,fogNear:f.near,fogFar:f.far,fogColor:[c.r,c.g,c.b]}):i.setUniform("hasFog",false)},render:function(i){var f=this.program,c=this.camera,g=s.merge({onBeforeRender:s.empty,onAfterRender:s.empty},i||{});this.beforeRender();this.models.forEach(function(h,k){if(h.display){h.onBeforeRender(f,c);g.onBeforeRender(h,k);this.renderObject(h);g.onAfterRender(h,k);h.onAfterRender(f,c)}},this)},renderToTexture:function(i,
f){var c=this.program,g=c.textures[i+"-texture"];c=c.textureMemo[i+"-texture"];this.render(f);m.bindTexture(c.textureType,g);m.generateMipmap(c.textureType);m.bindTexture(c.textureType,null)},renderObject:function(i){var f=this.program,c=this.camera,g=new q;i.setUniforms(f);i.setShininess(f);i.setVertices(f);i.setColors(f);i.setNormals(f);i.setTextures(f);i.setTexCoords(f);i.setIndices(f);g.mulMat42(c.modelView,i.matrix);f.setUniform("modelViewMatrix",g);f.setUniform("normalMatrix",g.invert().$transpose());
if(i.render)i.render(m,f,c);else i.indices?m.drawElements(i.drawType!==undefined?m.get(i.drawType):m.TRIANGLES,i.indices.length,m.UNSIGNED_SHORT,0):m.drawArrays(m.get(i.drawType||"TRIANGLES"),0,i.toFloat32Array("vertices").length/3);i.unsetVertices(f);i.unsetColors(f);i.unsetNormals(f);i.unsetTexCoords(f);i.unsetIndices(f)},setupPicking:function(){var i=this.program;i.setFrameBuffer("$picking",{width:1,height:1,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",
value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:true});i.setFrameBuffer("$picking",false)},pick:function(i,f){var c={},g=this.program,h=this.config,k=h.lights.enable,r=h.effects.fog,u=m.canvas.width,v=m.canvas.height,a=[];s.time();var b=new Uint8Array(4),d=0,j;h.lights.enable=false;h.effects.fog=false;g.setUniform("enablePicking",true);g.setFrameBuffer("$picking",true);m.disable(m.BLEND);m.viewport(-i,f-v,u,v);m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT);m.readPixels(0,0,1,1,m.RGBA,m.UNSIGNED_BYTE,
b);j=b[0]+b[1]*256+b[2]*65536;this.renderToTexture("$picking",{onBeforeRender:function(l,o){if(o==j)d=1;var p=o+d;a[0]=p%256;a[1]=(p/256>>0)%256;a[2]=(p/65536>>0)%256;g.setUniform("pickColor",[a[0]/255,a[1]/255,a[2]/255]);c[String(a)]=l}});m.readPixels(0,0,1,1,m.RGBA,m.UNSIGNED_BYTE,b);u=c[String([b[0],b[1],b[2]])];g.setFrameBuffer("$picking",false);g.setUniform("enablePicking",false);h.lights.enable=k;h.effects.fog=r;return u&&u.pickable&&u}};n.id=s.time();n.MAX_TEXTURES=3;n.MAX_POINT_LIGHTS=3;PhiloGL.Scene=
n})();(function(){function t(q,n){for(var i=this.workers=[];n--;)i.push(new Worker(q))}t.prototype={map:function(q){var n=this.workers,i=this.configs=[],f=0;for(n=n.length;f<n;f++)i.push(q&&q(f));return this},reduce:function(q){for(var n=q.reduceFn,i=this.workers,f=this.configs,c=i.length,g=q.initialValue,h=function(v){c--;g=g===undefined?v.data:n(g,v.data);if(c==0)q.onComplete(g)},k=0,r=c;k<r;k++){var u=i[k];u.onmessage=h;u.postMessage(f[k])}return this}};PhiloGL.WorkerGroup=t})();(function(){var t=
function(f){this.opt=s.merge({duration:1E3,transition:function(c){return c},onCompute:s.empty,onComplete:s.empty},f||{})};t.prototype={timer:null,time:null,start:function(f){this.opt=s.merge(this.opt,f||{});this.time=s.time();this.animating=true},step:function(){if(this.animating){var f=s.time(),c=this.time,g=this.opt;if(f<c+g.duration){f=g.transition((f-c)/g.duration);g.onCompute.call(this,f)}else{this.animating=false;g.onCompute.call(this,1);g.onComplete.call(this)}}}};t.compute=function(f,c,g){return f+
(c-f)*g};t.Transition={linear:function(f){return f}};var q=t.Transition;(function(){var f=function(h,k){k=s.splat(k);return s.extend(h,{easeIn:function(r){return h(r,k)},easeOut:function(r){return 1-h(1-r,k)},easeInOut:function(r){return r<=0.5?h(2*r,k)/2:(2-h(2*(1-r),k))/2}})},c={Pow:function(h,k){return Math.pow(h,k[0]||6)},Expo:function(h){return Math.pow(2,8*(h-1))},Circ:function(h){return 1-Math.sin(Math.acos(h))},Sine:function(h){return 1-Math.sin((1-h)*Math.PI/2)},Back:function(h,k){k=k[0]||
1.618;return Math.pow(h,2)*((k+1)*h-k)},Bounce:function(h){for(var k,r=0,u=1;;r+=u,u/=2)if(h>=(7-4*r)/11){k=u*u-Math.pow((11-6*r-11*h)/4,2);break}return k},Elastic:function(h,k){return Math.pow(2,10*--h)*Math.cos(20*h*Math.PI*(k[0]||1)/3)}},g;for(g in c)q[g]=f(c[g]);["Quad","Cubic","Quart","Quint"].forEach(function(h,k){q[h]=f(function(r){return Math.pow(r,[k+2])})})})();var n=self||window;if(n){var i=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime",
"animationStartTime"].forEach(function(f){if(f in n){t.animationTime=function(){return n[f]};i=true}});if(!i)t.animationTime=s.time;i=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(f){if(f in n){t.requestAnimationFrame=function(c){n[f](function(){c()})};i=true}});if(!i)t.requestAnimationFrame=function(f){setTimeout(function(){f()},1E3/60)}}PhiloGL.Fx=t})()})();
