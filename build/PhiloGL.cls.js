/*

 Copyright (c) 2011 Sencha Inc. - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
(function(){function u(x){return document.getElementById(x)}this.PhiloGL=null;(function(){PhiloGL=function(x,y){function q(r,B,t){var z=r.canvas,a=new PhiloGL.Camera(d.fov,z.width/z.height,d.near,d.far,d);a.update();var b=new PhiloGL.Scene(B,a,c);V=new PhiloGL.WebGL.Application({gl:r,canvas:z,program:B,scene:b,camera:a});B.$$family=="program"&&B.use();g&&PhiloGL.Events.create(V,u.extend(g,{bind:V}));if(j.src.length)new PhiloGL.IO.Textures(u.extend(j,{onComplete:function(){t(V)}}));else t(V)}y=u.merge({context:{},
camera:{fov:45,near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:u.empty,onError:u.empty},y||{});var i=y.context,d=y.camera,g=y.events,j=y.textures,h=u.splat(y.program),c=y.scene;o=PhiloGL.WebGL.getContext(x,i);if(!o){y.onError("The WebGL context couldn't been initialized");return null}var k={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},m=h.length,n=function(){var r=m,B={},t=false;
return{onSuccess:function(z,a){B[a.id||m-r]=z;r--;if(r==0&&!t)q(o,m==1?z:B,function(b){y.onLoad(b)})},onError:function(){r--;y.onError(y.id);t=true}}}();h.forEach(function(r){var B=r.from,t;for(t in k)if(B==t){program=PhiloGL.Program[k[t]](u.extend(n,r));break}if(program)n.onSuccess(program,r)})}})();PhiloGL.unpack=function(x){x=x||aa;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx"].forEach(function(y){x[y]=PhiloGL[y]})};PhiloGL.version="1.2.1";
var o,V,aa=this;u.empty=function(){};u.time=Date.now||function(){return+new Date};u.uid=function(){var x=u.time();return function(){return x++}}();u.extend=function(x,y){for(var q in y)x[q]=y[q];return x};u.type=function(){var x=Object.prototype.toString;return function(y){var q;q=x.call(y);q=q.substr(8,q.length-9).toLowerCase();if(q!="object")return q;if(y.$$family)return y.$$family;return y&&y.nodeName&&y.nodeType==1?"element":q}}();(function(){function x(y){var q=u.type(y);if(q=="object"){q={};
for(var i in y)q[i]=x(y[i]);return q}else if(q=="array"){q=[];i=0;for(var d=y.length;i<d;i++)q[i]=x(y[i]);return q}else return y}u.merge=function(){for(var y={},q=0,i=arguments.length;q<i;q++){var d=arguments[q];if(u.type(d)=="object")for(var g in d){var j=d[g],h=y[g];y[g]=h&&u.type(j)=="object"&&u.type(h)=="object"?u.merge(h,j):x(j)}}return y}})();u.splat=function(){var x=Array.isArray;return function(y){return x(y)&&y||[y]}}();(function(){function x(q){for(var i in q)this[i]=q[i];this.buffers={};
this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}var y={getContext:function(q,i){q=typeof q=="string"?u(q):q;var d;(d=q.getContext("experimental-webgl",i))||(d=q.getContext("webgl",i));if(d&&i&&i.debug){o={};for(var g in d){var j=d[g];o[g]=typeof j=="function"?function(h,c){return function(){console.log(h,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var k=c.apply(d,
arguments)}catch(m){throw h+" "+m;}for(var n=[],r;(r=d.getError())!==d.NO_ERROR;)n.push(r);if(n.length)throw n.join();return k}}(g,j):j}}else o=d;if(o)o.get=function(h){return typeof h=="string"?o[h]:h};return o}};x.prototype={$$family:"application",setBuffer:function(q,i,d){if(d===false||d===null){(d=this.bufferMemo[i])&&o.bindBuffer(d.bufferType,null);var g=d&&d.attribute||i;q=q.attributes[g];q!==undefined&&o.disableVertexAttribArray(q)}else{d=u.merge({bufferType:o.ARRAY_BUFFER,size:1,dataType:o.FLOAT,
stride:0,offset:0,drawType:o.STATIC_DRAW},this.bufferMemo[i]||{},d||{});g=d.attribute||i;var j=d.bufferType,h=i in this.buffers,c=h?this.buffers[i]:o.createBuffer(),k="value"in d,m=d.value,n=d.size,r=d.dataType,B=d.stride,t=d.offset,z=d.drawType;q=q.attributes[g];var a=q!==undefined;h||(this.buffers[i]=c);a&&o.enableVertexAttribArray(q);o.bindBuffer(j,c);k&&o.bufferData(j,m,z);a&&o.vertexAttribPointer(q,n,r,false,B,t);delete d.value;this.bufferMemo[i]=d;if(a)this.bufferMemo[g]=d;return this}},setBuffers:function(q,
i){for(var d in i)this.setBuffer(q,d,i[d]);return this},setFrameBuffer:function(q,i){if(typeof i!="object")o.bindFramebuffer(o.FRAMEBUFFER,i?this.frameBuffers[q]:null);else{i=u.merge({width:0,height:0,bindToTexture:false,textureOptions:{attachment:o.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:o.DEPTH_ATTACHMENT}},this.frameBufferMemo[q]||{},i||{});var d=i.bindToTexture,g=i.bindToRenderBuffer,j=q in this.frameBuffers,h=j?this.frameBuffers[q]:o.createFramebuffer(o.FRAMEBUFFER);
o.bindFramebuffer(o.FRAMEBUFFER,h);j||(this.frameBuffers[q]=h);if(d){d=u.merge({data:{width:i.width,height:i.height}},u.type(d)=="object"?d:{});j=q+"-texture";h=i.textureOptions;this.setTexture(j,d);o.framebufferTexture2D(o.FRAMEBUFFER,h.attachment,this.textureMemo[j].textureType,this.textures[j],0)}if(g){g=u.merge({width:i.width,height:i.height},u.type(g)=="object"?g:{});d=q+"-renderbuffer";j=i.renderBufferOptions;this.setRenderBuffer(d,g);o.framebufferRenderbuffer(o.FRAMEBUFFER,j.attachment,o.RENDERBUFFER,
this.renderBuffers[d])}o.bindTexture(o.TEXTURE_2D,null);o.bindRenderbuffer(o.RENDERBUFFER,null);o.bindFramebuffer(o.FRAMEBUFFER,null);this.frameBufferMemo[q]=i;return this}},setFrameBuffers:function(q){for(var i in q)this.setFrameBuffer(i,q[i]);return this},setRenderBuffer:function(q,i){if(typeof i!="object")o.bindRenderbuffer(o.RENDERBUFFER,i?this.renderBufferMemo[q]:null);else{i=u.merge({storageType:o.DEPTH_COMPONENT16,width:0,height:0},this.renderBufferMemo[q]||{},i||{});var d=q in this.renderBuffers,
g=d?this.renderBuffers[q]:o.createRenderbuffer(o.RENDERBUFFER);d||(this.renderBuffers[q]=g);o.bindRenderbuffer(o.RENDERBUFFER,g);o.renderbufferStorage(o.RENDERBUFFER,i.storageType,i.width,i.height);this.renderBufferMemo[q]=i;return this}},setRenderBuffers:function(q){for(var i in q)this.setRenderBuffer(i,q[i]);return this},setTexture:function(q,i){if(!i||typeof i!="object"){o.activeTexture(i||o.TEXTURE0);o.bindTexture(this.textureMemo[q].textureType||o.TEXTURE_2D,this.textures[q])}else{i=u.merge({textureType:o.TEXTURE_2D,
pixelStore:[{name:o.UNPACK_FLIP_Y_WEBGL,value:true}],parameters:[{name:o.TEXTURE_MAG_FILTER,value:o.NEAREST},{name:o.TEXTURE_MIN_FILTER,value:o.NEAREST}],data:{format:o.RGBA,value:false,width:0,height:0,border:0}},this.textureMemo[q]||{},i||{});var d="textureType"in i?i.textureType:o.TEXTURE_2D,g=q in this.textures,j=g?this.textures[q]:o.createTexture(),h=i.pixelStore,c=i.parameters,k=i.data,m=!!i.data.value;g||(this.textures[q]=j);o.bindTexture(d,j);g||h.forEach(function(n){n.name=typeof n.name==
"string"?o[n.name]:n.name;o.pixelStorei(n.name,n.value)});if(m)o.texImage2D(d,0,k.format,k.format,o.UNSIGNED_BYTE,k.value);else if(k.width||k.height)o.texImage2D(d,0,k.format,k.width,k.height,k.border,k.format,o.UNSIGNED_BYTE,null);g||c.forEach(function(n){n.name=o.get(n.name);n.value=o.get(n.value);o.texParameteri(d,n.name,n.value);n.generateMipmap&&o.generateMipmap(d)});delete i.data;this.textureMemo[q]=i;return this}},setTextures:function(q){for(var i in q)this.setTexture(i,q[i]);return this},
use:function(q){o.useProgram(q.program);this.usedProgram=q;return this}};y.Application=x;(function(){try{var q=document.createElement("canvas");PhiloGL.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(q.getContext("webgl")||q.getContext("experimental-webgl")))}}catch(i){PhiloGL.hasWebGL=function(){return false}}})();PhiloGL.WebGL=y})();(function(){function x(a){return{get:function(){return this[a]},set:function(b){this[a]=b},configurable:false,enumerable:false}}var y=Math.sqrt,q=Math.sin,
i=Math.cos,d=Math.tan,g=Math.PI,j=Array.prototype.slice,h=this.Float32Array,c=function(){if(!h.call)return Array;try{h.call({},10)}catch(a){return Array}return h}(),k=c!=Array,m=function(a,b,f){if(k){h.call(this,3);this[0]=a||0;this[1]=b||0;this[2]=f||0}else this.push(a||0,b||0,f||0);this.typedContainer=new h(3)};m.create=function(){return new h(3)};m.prototype=Object.create(c.prototype,{$$family:{value:"Vec3"},x:x(0),y:x(1),z:x(2)});var n={setVec3:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},
set:function(a,b,f,l){a[0]=b;a[1]=f;a[2]=l;return a},add:function(a,b){return new m(a[0]+b[0],a[1]+b[1],a[2]+b[2])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a},add2:function(a,b,f){a[0]=b[0]+f[0];a[1]=b[1]+f[1];a[2]=b[2]+f[2];return a},sub:function(a,b){return new m(a[0]-b[0],a[1]-b[1],a[2]-b[2])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return a},sub2:function(a,b,f){a[0]=b[0]-f[0];a[1]=b[1]-f[1];a[2]=b[2]-f[2];return a},scale:function(a,b){return new m(a[0]*b,a[1]*b,
a[2]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;return a},neg:function(a){return new m(-a[0],-a[1],-a[2])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a},unit:function(a){var b=m.norm(a);if(b>0)return m.scale(a,1/b);return m.clone(a)},$unit:function(a){var b=m.norm(a);if(b>0)return m.$scale(a,1/b);return a},cross:function(a,b){var f=a[0],l=a[1],p=a[2],s=b[0],v=b[1],w=b[2];return new m(l*w-p*v,p*s-f*w,f*v-l*s)},$cross:function(a,b){var f=a[0],l=a[1],p=a[2],s=b[0],v=b[1],w=b[2];a[0]=
l*w-p*v;a[1]=p*s-f*w;a[2]=f*v-l*s;return a},distTo:function(a,b){var f=a[0]-b[0],l=a[1]-b[1],p=a[2]-b[2];return y(f*f,l*l,p*p)},distToSq:function(a,b){var f=a[0]-b[0],l=a[1]-b[1],p=a[2]-b[2];return f*f+l*l+p*p},norm:function(a){var b=a[0],f=a[1];a=a[2];return y(b*b+f*f+a*a)},normSq:function(a){var b=a[0],f=a[1];a=a[2];return b*b+f*f+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},clone:function(a){return a.$$family?new m(a[0],a[1],a[2]):m.setVec3(new h(3),a)},toFloat32Array:function(a){var b=
a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}},r=m.prototype,B;for(B in n){m[B]=n[B];r[B]=function(a){return function(){var b=j.call(arguments);b.unshift(this);return m[a].apply(m,b)}}(B)}var t=function(a,b,f,l,p,s,v,w,A,C,D,E,G,I,J,H){c.call(this,16);this.length=16;typeof a=="number"?this.set(a,b,f,l,p,s,v,w,A,C,D,E,G,I,J,H):this.id();this.typedContainer=new h(16)};t.create=function(){return new h(16)};t.prototype=Object.create(c.prototype,{$$family:{value:"Mat4"},n11:x(0),
n21:x(1),n31:x(2),n41:x(3),n12:x(4),n22:x(5),n32:x(6),n42:x(7),n13:x(8),n23:x(9),n33:x(10),n43:x(11),n14:x(12),n24:x(13),n34:x(14),n44:x(15)});n={id:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){return a.$$family?new t(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]):new h(a)},set:function(a,b,f,l,p,s,v,w,A,C,D,E,G,I,J,H,F){a[0]=b;a[1]=s;a[2]=C;a[3]=
I;a[4]=f;a[5]=v;a[6]=D;a[7]=J;a[8]=l;a[9]=w;a[10]=E;a[11]=H;a[12]=p;a[13]=A;a[14]=G;a[15]=F;return a},mulVec3:function(a,b){var f=m.clone(b);return t.$mulVec3(a,f)},$mulVec3:function(a,b){var f=b[0],l=b[1],p=b[2];b[0]=a[0]*f+a[4]*l+a[8]*p+a[12];b[1]=a[1]*f+a[5]*l+a[9]*p+a[13];b[2]=a[2]*f+a[6]*l+a[10]*p+a[14];return b},mulMat42:function(a,b,f){var l=b[0],p=b[4],s=b[8],v=b[12],w=b[1],A=b[5],C=b[9],D=b[13],E=b[2],G=b[6],I=b[10],J=b[14],H=b[3],F=b[7],M=b[11];b=b[15];var K=f[0],L=f[4],O=f[8],Q=f[12],P=
f[1],R=f[5],U=f[9],W=f[13],S=f[2],T=f[6],X=f[10],N=f[14],Y=f[3],Z=f[7],$=f[11];f=f[15];a[0]=l*K+p*P+s*S+v*Y;a[4]=l*L+p*R+s*T+v*Z;a[8]=l*O+p*U+s*X+v*$;a[12]=l*Q+p*W+s*N+v*f;a[1]=w*K+A*P+C*S+D*Y;a[5]=w*L+A*R+C*T+D*Z;a[9]=w*O+A*U+C*X+D*$;a[13]=w*Q+A*W+C*N+D*f;a[2]=E*K+G*P+I*S+J*Y;a[6]=E*L+G*R+I*T+J*Z;a[10]=E*O+G*U+I*X+J*$;a[14]=E*Q+G*W+I*N+J*f;a[3]=H*K+F*P+M*S+b*Y;a[7]=H*L+F*R+M*T+b*Z;a[11]=H*O+F*U+M*X+b*$;a[15]=H*Q+F*W+M*N+b*f;return a},mulMat4:function(a,b){var f=t.clone(a);return t.mulMat42(f,a,b)},
$mulMat4:function(a,b){return t.mulMat42(a,a,b)},add:function(a,b){var f=t.clone(a);return t.$add(f,b)},$add:function(a,b){a[0]+=b[0];a[4]+=b[4];a[8]+=b[8];a[12]+=b[12];a[1]+=b[1];a[5]+=b[5];a[9]+=b[9];a[13]+=b[13];a[2]+=b[2];a[6]+=b[6];a[10]+=b[10];a[14]+=b[14];a[3]+=b[3];a[7]+=b[7];a[11]+=b[11];a[15]+=b[15];return a},transpose:function(a){a=t.clone(a);return t.$transpose(a)},$transpose:function(a){var b=a[8],f=a[12],l=a[1],p=a[9],s=a[13],v=a[2],w=a[6],A=a[14],C=a[3],D=a[7],E=a[11];a[1]=a[4];a[2]=
b;a[3]=f;a[4]=l;a[6]=p;a[7]=s;a[8]=v;a[9]=w;a[11]=A;a[12]=C;a[13]=D;a[14]=E;return a},rotateAxis:function(a,b,f){a=t.clone(a);return t.$rotateAxis(a,b,f)},$rotateAxis:function(a,b,f){var l=q(b),p=i(b),s=1-p,v=f[0],w=f[1],A=f[2];f=v*v*s+p;b=v*w*s-A*l;var C=v*A*s+w*l,D=w*v*s+A*l,E=w*w*s+p,G=w*A*s-v*l,I=v*A*s-w*l;l=w*A*s+v*l;p=A*A*s+p;s=a[0];v=a[4];w=a[8];A=a[12];var J=a[1],H=a[5],F=a[9],M=a[13],K=a[2],L=a[6],O=a[10],Q=a[14],P=a[3],R=a[7],U=a[11],W=a[15];a[0]=s*f+v*D+w*I;a[4]=s*b+v*E+w*l;a[8]=s*C+v*
G+w*p;a[12]=A;a[1]=J*f+H*D+F*I;a[5]=J*b+H*E+F*l;a[9]=J*C+H*G+F*p;a[13]=M;a[2]=K*f+L*D+O*I;a[6]=K*b+L*E+O*l;a[10]=K*C+L*G+O*p;a[14]=Q;a[3]=P*f+R*D+U*I;a[7]=P*b+R*E+U*l;a[11]=P*C+R*G+U*p;a[15]=W;return a},rotateXYZ:function(a,b,f,l){a=t.clone(a);return t.$rotateXYZ(a,b,f,l)},$rotateXYZ:function(a,b,f,l){var p=a[0],s=a[4],v=a[8],w=a[12],A=a[1],C=a[5],D=a[9],E=a[13],G=a[2],I=a[6],J=a[10],H=a[14],F=i(b),M=i(f),K=i(l);b=q(b);var L=q(f),O=q(l);l=M*K;f=-F*O+b*L*K;var Q=b*O+F*L*K,P=M*O,R=F*K+b*L*O;K=-b*K+
F*L*O;L=-L;b*=M;F*=M;a[0]=p*l+A*f+G*Q;a[4]=s*l+C*f+I*Q;a[8]=v*l+D*f+J*Q;a[12]=w*l+E*f+H*Q;a[1]=p*P+A*R+G*K;a[5]=s*P+C*R+I*K;a[9]=v*P+D*R+J*K;a[13]=w*P+E*R+H*K;a[2]=p*L+A*b+G*F;a[6]=s*L+C*b+I*F;a[10]=v*L+D*b+J*F;a[14]=w*L+E*b+H*F;return a},translate:function(a,b,f,l){a=t.clone(a);return t.$translate(a,b,f,l)},$translate:function(a,b,f,l){a[12]=a[0]*b+a[4]*f+a[8]*l+a[12];a[13]=a[1]*b+a[5]*f+a[9]*l+a[13];a[14]=a[2]*b+a[6]*f+a[10]*l+a[14];a[15]=a[3]*b+a[7]*f+a[11]*l+a[15];return a},scale:function(a,b,
f,l){a=t.clone(a);return t.$scale(a,b,f,l)},$scale:function(a,b,f,l){a[0]*=b;a[4]*=b;a[8]*=b;a[12]*=b;a[1]*=f;a[5]*=f;a[9]*=f;a[13]*=f;a[2]*=l;a[6]*=l;a[10]*=l;a[14]*=l;return a},invert:function(a){a=t.clone(a);return t.$invert(a)},$invert:function(a){var b=a[0],f=a[4],l=a[8],p=a[12],s=a[1],v=a[5],w=a[9],A=a[13],C=a[2],D=a[6],E=a[10],G=a[14],I=a[3],J=a[7],H=a[11],F=a[15],M=b*v-f*s,K=b*w-l*s,L=b*A-p*s,O=f*w-l*v,Q=f*A-p*v,P=l*A-p*w,R=C*J-D*I,U=C*H-E*I,W=C*F-G*I,S=D*H-E*J,T=D*F-G*J,X=E*F-G*H,N=1/(M*
X-K*T+L*S+O*W-Q*U+P*R);a[0]=(+v*X-w*T+A*S)*N;a[4]=(-f*X+l*T-p*S)*N;a[8]=(+J*P-H*Q+F*O)*N;a[12]=(-D*P+E*Q-G*O)*N;a[1]=(-s*X+w*W-A*U)*N;a[5]=(+b*X-l*W+p*U)*N;a[9]=(-I*P+H*L-F*K)*N;a[13]=(+C*P-E*L+G*K)*N;a[2]=(+s*T-v*W+A*R)*N;a[6]=(-b*T+f*W-p*R)*N;a[10]=(+I*Q-J*L+F*M)*N;a[14]=(-C*Q+D*L-G*M)*N;a[3]=(-s*S+v*U-w*R)*N;a[7]=(+b*S-f*U+l*R)*N;a[11]=(-I*O+J*K-H*M)*N;a[15]=(+C*O-D*K+E*M)*N;return a},lookAt:function(a,b,f,l){f=m.sub(b,f);f.$unit();l=m.cross(l,f);l.$unit();var p=m.cross(f,l);p.$unit();return t.set(a,
l[0],l[1],l[2],-l.dot(b),p[0],p[1],p[2],-p.dot(b),f[0],f[1],f[2],-f.dot(b),0,0,0,1)},frustum:function(a,b,f,l,p,s,v){return t.set(a,2*s/(f-b),0,(f+b)/(f-b),0,0,2*s/(p-l),(p+l)/(p-l),0,0,0,-(v+s)/(v-s),-2*v*s/(v-s),0,0,-1,0)},perspective:function(a,b,f,l,p){b=l*d(b*g/360);var s=-b;return t.frustum(a,s*f,b*f,s,b,l,p)},ortho:function(a,b,f,l,p,s,v){var w=f-b,A=p-l,C=v-s;return t.set(a,2/w,0,0,-((f+b)/w),0,2/A,0,-((p+l)/A),0,0,-2/C,-((v+s)/C),0,0,0,1)},toFloat32Array:function(a){var b=a.typedContainer;
if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}};r=t.prototype;for(B in n){t[B]=n[B];r[B]=function(a){return function(){var b=j.call(arguments);b.unshift(this);return t[a].apply(t,b)}}(B)}var z=function(a,b,f,l){c.call(this,4);this[0]=a||0;this[1]=b||0;this[2]=f||0;this[3]=l||0;this.typedContainer=new h(4)};z.create=function(){return new h(4)};n={setQuat:function(a,
b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,f,l,p){a[0]=b||0;a[1]=f||0;a[2]=l||0;a[3]=p||0;return a},clone:function(a){return a.$$family?new z(a[0],a[1],a[2],a[3]):z.setQuat(new h(4),a)},neg:function(a){return new z(-a[0],-a[1],-a[2],-a[3])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];a[3]=-a[3];return a},add:function(a,b){return new z(a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];return a},sub:function(a,b){return new z(a[0]-
b[0],a[1]-b[1],a[2]-b[2],a[3]-b[3])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];a[3]-=b[3];return a},scale:function(a,b){return new z(a[0]*b,a[1]*b,a[2]*b,a[3]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;return a},mulQuat:function(a,b){var f=a[0],l=a[1],p=a[2],s=a[3],v=b[0],w=b[1],A=b[2],C=b[3];return new z(s*v+f*C+l*A-p*w,s*w+l*C+p*v-f*A,s*A+p*C+f*w-l*v,s*C-f*v-l*w-p*A)},$mulQuat:function(a,b){var f=a[0],l=a[1],p=a[2],s=a[3],v=b[0],w=b[1],A=b[2],C=b[3];a[0]=s*v+f*C+l*A-p*w;
a[1]=s*w+l*C+p*v-f*A;a[2]=s*A+p*C+f*w-l*v;a[3]=s*C-f*v-l*w-p*A;return a},divQuat:function(a,b){var f=a[0],l=a[1],p=a[2],s=a[3],v=b[0],w=b[1],A=b[2],C=b[3],D=1/(C*C+v*v+w*w+A*A);return new z((f*C-s*v-l*A+p*w)*D,(f*A-s*w+l*C-p*v)*D,(l*v+p*C-s*A-f*w)*D,(s*C+f*v+l*w+p*A)*D)},$divQuat:function(a,b){var f=a[0],l=a[1],p=a[2],s=a[3],v=b[0],w=b[1],A=b[2],C=b[3],D=1/(C*C+v*v+w*w+A*A);a[0]=(f*C-s*v-l*A+p*w)*D;a[1]=(f*A-s*w+l*C-p*v)*D;a[2]=(l*v+p*C-s*A-f*w)*D;a[3]=(s*C+f*v+l*w+p*A)*D;return a},invert:function(a){var b=
a[0],f=a[1],l=a[2];a=a[3];var p=1/(b*b+f*f+l*l+a*a);return new z(-b*p,-f*p,-l*p,a*p)},$invert:function(a){var b=a[0],f=a[1],l=a[2],p=a[3],s=1/(b*b+f*f+l*l+p*p);a[0]=-b*s;a[1]=-f*s;a[2]=-l*s;a[3]=p*s;return a},norm:function(a){var b=a[0],f=a[1],l=a[2];a=a[3];return y(b*b+f*f+l*l+a*a)},normSq:function(a){var b=a[0],f=a[1],l=a[2];a=a[3];return b*b+f*f+l*l+a*a},unit:function(a){return z.scale(a,1/z.norm(a))},$unit:function(a){return z.$scale(a,1/z.norm(a))},conjugate:function(a){return new z(-a[0],-a[1],
-a[2],a[3])},$conjugate:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a}};r=z.prototype={};for(B in n){z[B]=n[B];r[B]=function(a){return function(){var b=j.call(arguments);b.unshift(this);return z[a].apply(z,b)}}(B)}m.fromQuat=function(a){return new m(a[0],a[1],a[2])};z.fromVec3=function(a,b){return new z(a[0],a[1],a[2],b||0)};z.fromMat4=function(a){var b,f,l;if(a[0]>a[5]&&a[0]>a[10]){b=0;f=1;l=2}else if(a[5]>a[0]&&a[5]>a[10]){b=1;f=2;l=0}else{b=2;f=0;l=1}var p=y(1+a[b*5]-a[f*5]-a[l*5]),s=new z;
s[b]=0.5*p;s[f]=0.5*(a["n"+f+""+b]+a["n"+b+""+f])/p;s[l]=0.5*(a["n"+b+""+l]+a["n"+l+""+b])/p;s[3]=0.5*(a["n"+f+""+l]-a["n"+l+""+f])/p;return s};z.fromXRotation=function(a){return new z(q(a/2),0,0,i(a/2))};z.fromYRotation=function(a){return new z(0,q(a/2),0,i(a/2))};z.fromZRotation=function(a){return new z(0,0,q(a/2),i(a/2))};z.fromAxisRotation=function(a,b){var f=a[0],l=a[1],p=a[2],s=1/y(f*f+l*l+p*p),v=q(b/2),w=i(b/2);return new z(v*f*s,v*l*s,v*p*s,w)};t.fromQuat=function(a){var b=a[3],f=a[0],l=a[1];
a=a[2];return new t(b*b+f*f-l*l-a*a,2*f*l-2*b*a,2*f*a+2*b*l,0,2*f*l+2*b*a,b*b-f*f+l*l-a*a,2*l*a-2*b*f,0,2*f*a-2*b*l,2*l*a+2*b*f,b*b-f*f-l*l+a*a,0,0,0,0,1)};PhiloGL.Vec3=m;PhiloGL.Mat4=t;PhiloGL.Quat=z})();(function(){function x(g){return g!==true?g:false}var y=function(g){var j=function(h){for(var c={x:0,y:0};h&&!/^(?:body|html)$/i.test(h.tagName);){c.x+=h.offsetLeft;c.y+=h.offsetTop;h=h.offsetParent}return c}(g);g=function(h){for(var c={x:0,y:0};h&&!/^(?:body|html)$/i.test(h.tagName);){c.x+=h.scrollLeft;
c.y+=h.scrollTop;h=h.parentNode}return c}(g);return{x:j.x-g.x,y:j.y-g.y}},q={get:function(g,j){return g||(j||window).event},getWheel:function(g){return g.wheelDelta?g.wheelDelta/120:-(g.detail||0)/3},getKey:function(g){var j=g.which||g.keyCode,h;a:{h=d.Keys;for(var c in h)if(h[c]==j){h=c;break a}h=void 0}c=j-111;if(c>0&&c<13)h="f"+c;h=h||String.fromCharCode(j).toLowerCase();return{code:j,key:h,shift:g.shiftKey,control:g.ctrlKey,alt:g.altKey,meta:g.metaKey}},isRightClick:function(g){return g.which==
3||g.button==2},getPos:function(g,j){j=j||window;g=g||j.event;var h=j.document;h=h.documentElement||h.body;if(g.touches&&g.touches.length)g=g.touches[0];return{x:g.pageX||g.clientX+h.scrollLeft,y:g.pageY||g.clientY+h.scrollTop}},stop:function(g){g.stopPropagation&&g.stopPropagation();g.cancelBubble=true;if(g.preventDefault)g.preventDefault();else g.returnValue=false}},i=function(g,j){var h=g.canvas;this.scene=g.scene;this.domElem=h;this.pos=y(h);this.opt=this.callbacks=j;this.size={width:h.width||
h.offsetWidth,height:h.height||h.offsetHeight};this.attachEvents()};i.prototype={hovered:false,pressed:false,touched:false,touchMoved:false,moved:false,attachEvents:function(){var g=this.domElem,j=this;if(this.opt.disableContextMenu)g.oncontextmenu=function(){return false};["mouseup","mousedown","mousemove","mouseover","mouseout","touchstart","touchmove","touchend"].forEach(function(c){g.addEventListener(c,function(k,m){j[c](j.eventInfo(c,k,m))},false)});["keydown","keyup"].forEach(function(c){document.addEventListener(c,
function(k,m){j[c](j.eventInfo(c,k,m))},false)});var h="";h=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";g.addEventListener(h,function(c,k){j.mousewheel(j.eventInfo("mousewheel",c,k))},false)},eventInfo:function(g,j,h){var c=this.domElem,k=this.scene,m=this.opt,n=this.getSize(),r=m.relative,B=m.centerOrigin,t=m.cachePosition&&this.pos||y(c),z=q.get(j,h),a=q.getPos(j,h);j={};h=a.x;c=a.y;if(r){h-=t.x;c-=t.y;if(B){h-=n.width/2;c-=n.height/2;c*=-1}}switch(g){case "mousewheel":j.wheel=
q.getWheel(z);break;case "keydown":u.extend(j,q.getKey(z));break;case "mouseup":j.isRightClick=q.isRightClick(z)}var b;u.extend(j,{x:h,y:c,cache:false,stop:function(){q.stop(z)},getTarget:function(){if(b)return b;return b=!m.picking||k.pick(a.x-t.x,a.y-t.y)||true}});j.event=z;return j},getSize:function(){if(this.cacheSize)return this.size;var g=this.domElem;return{width:g.width||g.offsetWidth,height:g.height||g.offsetHeight}},mouseup:function(g){if(!this.moved)if(g.isRightClick)this.callbacks.onRightClick(g,
this.hovered);else this.callbacks.onClick(g,x(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(g,x(this.pressed));else this.callbacks.onDragCancel(g,x(this.pressed));this.pressed=this.moved=false}},mouseout:function(g){for(var j=g.relatedTarget,h=this.domElem;j&&j.parentNode;){if(h==j.parentNode)return;j=j.parentNode}if(this.hovered){this.callbacks.onMouseLeave(g,this.hovered);this.hovered=false}},mouseover:function(){},mousemove:function(g){if(this.pressed){this.moved=true;
this.callbacks.onDragMove(g,x(this.pressed))}else if(this.hovered){var j=x(g.getTarget());if(!j||j.id!=this.hovered.id){this.callbacks.onMouseLeave(g,this.hovered);if(this.hovered=j)this.callbacks.onMouseEnter(g,this.hovered)}else this.callbacks.onMouseMove(g,this.hovered)}else if(this.hovered=x(g.getTarget()))this.callbacks.onMouseEnter(g,this.hovered)},mousewheel:function(g){this.callbacks.onMouseWheel(g)},mousedown:function(g){this.pressed=g.getTarget();this.callbacks.onDragStart(g,x(this.pressed))},
touchstart:function(g){this.touched=g.getTarget();this.callbacks.onTouchStart(g,x(this.touched))},touchmove:function(g){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(g,x(this.touched))}},touchend:function(g){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(g,x(this.touched));else this.callbacks.onTouchCancel(g,x(this.touched));this.touched=this.touchMoved=false}},keydown:function(g){this.callbacks.onKeyDown(g)},keyup:function(g){this.callbacks.onKeyUp(g)}};var d={};
d.create=function(g,j){j=u.merge({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,onClick:u.empty,onRightClick:u.empty,onDragStart:u.empty,onDragMove:u.empty,onDragEnd:u.empty,onDragCancel:u.empty,onTouchStart:u.empty,onTouchMove:u.empty,onTouchEnd:u.empty,onTouchCancel:u.empty,onMouseMove:u.empty,onMouseEnter:u.empty,onMouseLeave:u.empty,onMouseWheel:u.empty,onKeyDown:u.empty,onKeyUp:u.empty},j||{});var h=j.bind;if(h)for(var c in j)c.match(/^on[a-zA-Z0-9]+$/)&&
function(k,m){j[k]=function(){return m.apply(h,Array.prototype.slice.call(arguments))}}(c,j[c]);new i(g,j)};d.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};PhiloGL.Events=d})();(function(){function x(){return arguments.length==2?{vs:arguments[0],fs:arguments[1]}:arguments[0]||{}}var y=function(d,g,j){var h=d.createShader(j);if(h==null)throw"Error creating the shader with shader type: "+j;d.shaderSource(h,g);d.compileShader(h);if(!d.getShaderParameter(h,
d.COMPILE_STATUS)){g=d.getShaderInfoLog(h);d.deleteShader(h);throw"Error while compiling the shader "+g;}return h},q=function(d,g,j){var h=o.getUniformLocation(d,g.name);d=g.type;var c=false,k=true,m,n;if(g.size>1&&j)switch(d){case o.FLOAT:m=o.uniform1fv;n=Float32Array;k=false;break;case o.INT:case o.BOOL:case o.SAMPLER_2D:case o.SAMPLER_CUBE:m=o.uniform1iv;n=Uint16Array;k=false}if(k)switch(d){case o.FLOAT:m=o.uniform1f;break;case o.FLOAT_VEC2:m=o.uniform2fv;n=j?Float32Array:new Float32Array(2);break;
case o.FLOAT_VEC3:m=o.uniform3fv;n=j?Float32Array:new Float32Array(3);break;case o.FLOAT_VEC4:m=o.uniform4fv;n=j?Float32Array:new Float32Array(4);break;case o.INT:case o.BOOL:case o.SAMPLER_2D:case o.SAMPLER_CUBE:m=o.uniform1i;break;case o.INT_VEC2:case o.BOOL_VEC2:m=o.uniform2iv;n=j?Uint16Array:new Uint16Array(2);break;case o.INT_VEC3:case o.BOOL_VEC3:m=o.uniform3iv;n=j?Uint16Array:new Uint16Array(3);break;case o.INT_VEC4:case o.BOOL_VEC4:m=o.uniform4iv;n=j?Uint16Array:new Uint16Array(4);break;case o.FLOAT_MAT2:c=
true;m=o.uniformMatrix2fv;break;case o.FLOAT_MAT3:c=true;m=o.uniformMatrix3fv;break;case o.FLOAT_MAT4:c=true;m=o.uniformMatrix4fv}m=m.bind(o);return j?function(r){m(h,new n(r))}:c?function(r){m(h,false,r.toFloat32Array())}:n?function(r){n.set(r);m(h,n)}:function(r){m(h,r)};throw"Unknown type: "+d;},i=function(d,g){var j=o,h=j.createProgram();j.attachShader(h,y(j,d,j.VERTEX_SHADER));j.attachShader(h,y(j,g,j.FRAGMENT_SHADER));j.linkProgram(h);if(!j.getProgramParameter(h,j.LINK_STATUS))throw"Error linking the shader: "+
j.getProgramInfoLog(h);if(!h)return false;j={};for(var c={},k=o.getProgramParameter(h,o.ACTIVE_ATTRIBUTES),m=0;m<k;m++){var n=o.getActiveAttrib(h,m),r=n.name;n=o.getAttribLocation(h,n.name);j[r]=n}k=o.getProgramParameter(h,o.ACTIVE_UNIFORMS);for(m=0;m<k;m++){n=o.getActiveUniform(h,m);r=n.name;r=r[r.length-1]=="]"?r.substr(0,r.length-3):r;c[r]=q(h,n,n.name!=r)}this.program=h;this.attributes=j;this.uniforms=c};i.prototype={$$family:"program",setUniform:function(d,g){if(this.uniforms[d])this.uniforms[d](g);
return this},setUniforms:function(d){for(var g in d)this.setUniform(g,d[g]);return this}};["setBuffer","setBuffers","use"].forEach(function(d){i.prototype[d]=function(){var g=Array.prototype.slice.call(arguments);g.unshift(this);V[d].apply(V,g);return this}});["setFrameBuffer","setFrameBuffers","setRenderBuffer","setRenderBuffers","setTexture","setTextures"].forEach(function(d){i.prototype[d]=function(){V[d].apply(V,arguments);return this}});i.fromShaderIds=function(){var d=x.apply({},arguments),
g=u(d.vs);d=u(d.fs);return new i(g.innerHTML,d.innerHTML)};i.fromShaderSources=function(d){d=x.apply({},arguments);return new i(d.vs,d.fs)};i.fromDefaultShaders=function(){var d=x.apply({},arguments),g=PhiloGL.Shaders;return PhiloGL.Program.fromShaderSources(g.Vertex[d.vs||"Default"],g.Fragment[d.fs||"Default"])};i.fromShaderURIs=function(d){d=u.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:u.empty,onError:u.empty},d||{});(new PhiloGL.IO.XHR.Group({urls:[d.path+d.vs,d.path+d.fs],noCache:d.noCache,
onError:function(g){d.onError(g)},onComplete:function(g){d.onSuccess(i.fromShaderSources(g[0],g[1]),d)}})).send()};PhiloGL.Program=i})();(function(){var x={},y=function(d){this.opt=d=u.merge({url:"http://sencha.com/",method:"GET",async:true,noCache:false,sendAsBinary:false,onProgress:u.empty,onSuccess:u.empty,onError:u.empty,onAbort:u.empty,onComplete:u.empty},d||{});this.initXHR()};y.State={};["UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(d,g){y.State[d]=g});y.prototype=
{initXHR:function(){var d=this.req=new XMLHttpRequest,g=this;["Progress","Error","Abort","Load"].forEach(function(j){d.addEventListener(j.toLowerCase(),function(h){g["handle"+j](h)},false)})},send:function(d){var g=this.req,j=this.opt,h=j.async;if(j.noCache)j.url+=(j.url.indexOf("?")>=0?"&":"?")+u.uid();g.open(j.method,j.url,h);if(h)g.onreadystatechange=function(){if(g.readyState==y.State.COMPLETED)if(g.status==200)j.onSuccess(g.responseText);else j.onError(g.status)};j.sendAsBinary?g.sendAsBinary(d||
j.body||null):g.send(d||j.body||null);if(!h)if(g.status==200)j.onSuccess(g.responseText);else j.onError(g.status)},setRequestHeader:function(d,g){this.req.setRequestHeader(d,g);return this},handleProgress:function(d){if(d.lengthComputable)this.opt.onProgress(d,Math.round(d.loaded/d.total*100));else this.opt.onProgress(d,-1)},handleError:function(d){this.opt.onError(d)},handleAbort:function(){this.opt.onAbort(e)},handleLoad:function(d){this.opt.onComplete(d)}};y.Group=function(d){function g(m){return function(n){--c;
d.onError(n,m);if(!c)d.onComplete(k)}}function j(m){return function(n){--c;k[m]=n;d.onSuccess(n,m);if(!c)d.onComplete(k)}}d=u.merge({urls:[],onError:u.empty,onSuccess:u.empty,onComplete:u.empty,method:"GET",async:true,noCache:false,sendAsBinary:false},d||{});var h=u.splat(d.urls),c=h.length,k=Array(c);this.reqs=h.map(function(m,n){return new y({url:m,method:d.method,async:d.async,noCache:d.noCache,sendAsBinary:d.sendAsBinary,body:d.body,onError:g(n),onSuccess:j(n)})})};y.Group.prototype={send:function(){this.reqs.forEach(function(d){d.send()})}};
var q=function(d){d=u.merge({url:"http://sencha.com/",data:{},noCache:false,onComplete:u.empty,callbackKey:"callback"},d||{});var g=q.counter++,j=[],h;for(h in d.data)j.push(h+"="+d.data[h]);j=j.join("&");if(d.noCache)j+=(j.indexOf("?")>=0?"&":"?")+u.uid();j=d.url+(d.url.indexOf("?")>-1?"&":"?")+d.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+g+(j.length>0?"&"+j:"");var c=document.createElement("script");c.type="text/javascript";c.src=j;q.requests["request_"+g]=function(k){d.onComplete(k);c.parentNode&&
c.parentNode.removeChild(c);c.clearAttributes&&c.clearAttributes()};document.getElementsByTagName("head")[0].appendChild(c)};q.counter=0;q.requests={};var i=function(d){d=u.merge({src:[],noCache:false,onProgress:u.empty,onComplete:u.empty},d||{});var g=0,j=d.src.length,h=function(){d.onProgress(Math.round(++g/j*100));if(g==j)d.onComplete(n)},c=function(){if(++g==j)d.onComplete(n)},k=d.noCache,m=u.uid(),n=d.src.map(function(r,B){var t=new Image;t.index=B;t.onload=h;t.onerror=c;t.src=r+(k?(r.indexOf("?")>=
0?"&":"?")+m:"");return t});return n};x.XHR=y;x.JSONP=q;x.Images=i;x.Textures=function(d){d=u.merge({src:[],noCache:false,onComplete:u.empty},d||{});i({src:d.src,noCache:d.noCache,onComplete:function(g){var j={};g.forEach(function(h,c){j[d.src[c]]=u.merge({data:{value:h}},d)});V.setTextures(j);d.onComplete()}})};PhiloGL.IO=x})();(function(){var x=PhiloGL.Vec3,y=PhiloGL.Mat4,q=function(i,d,g,j,h){h=h||{};var c=h.position,k=h.target;h=h.up;this.fov=i;this.near=g;this.far=j;this.aspect=d;this.position=
c&&new x(c.x,c.y,c.z)||new x;this.target=k&&new x(k.x,k.y,k.z)||new x;this.up=h&&new x(h.x,h.y,h.z)||new x(0,1,0);this.projection=(new y).perspective(i,d,g,j);this.modelView=new y};q.prototype={update:function(){this.projection=(new y).perspective(this.fov,this.aspect,this.near,this.far);this.modelView.lookAt(this.position,this.target,this.up)}};PhiloGL.Camera=q})();(function(){function x(c,k){if(c&&c.length<k){for(var m=c[0],n=c[1],r=c[2],B=c[3],t=[m,n,r,B],z=k/c.length,a;--z;){a=z*4;t[a]=m;t[a+
1]=n;t[a+2]=r;t[a+3]=B}return new Float32Array(t)}else return c}var y=PhiloGL.Vec3,q=PhiloGL.Mat4,i=Math.cos,d=Math.sin,g=Math.PI,j=Array.prototype.slice,h={};h.Model=function(c){c=c||{};this.id=c.id||u.uid();this.pickable=!!c.pickable;this.pick=c.pick||function(){return false};if(c.pickingColors)this.pickingColors=c.pickingColors;this.vertices=c.vertices;this.normals=c.normals;this.textures=c.textures&&u.splat(c.textures);this.colors=c.colors;this.indices=c.indices;this.shininess=c.shininess||0;
if(c.texCoords)this.texCoords=c.texCoords;this.uniforms=c.uniforms||{};this.attributes=c.attributes||{};this.render=c.render;this.drawType=c.drawType||"TRIANGLES";this.display="display"in c?c.display:true;this.onBeforeRender=c.onBeforeRender||u.empty;this.onAfterRender=c.onAfterRender||u.empty;if(c.program)this.program=c.program;this.position=new y;this.rotation=new y;this.scale=new y(1,1,1);this.matrix=new q;c.computeCentroids&&this.computeCentroids();c.computeNormals&&this.computeNormals()};h.Model.prototype=
Object.create(null,{vertices:{set:function(c){if(c){var k=c.length;if(c.BYTES_PER_ELEMENT)this.$vertices=c;else if(this.$verticesLength==k)this.$vertices.set(c);else this.$vertices=new Float32Array(c);this.$verticesLength=k}},get:function(){return this.$vertices}},normals:{set:function(c){if(c){var k=c.length;if(c.BYTES_PER_ELEMENT)this.$normals=c;else if(this.$normalsLength==k)this.$normals.set(c);else this.$normals=new Float32Array(c);this.$normalsLength=k}},get:function(){return this.$normals}},
colors:{set:function(c){if(c){var k=c.length;if(c.BYTES_PER_ELEMENT)this.$colors=c;else if(this.$colorsLength==k)this.$colors.set(c);else this.$colors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=k)this.$colors=x(j.call(this.$colors),this.$verticesLength/3*4);this.$colorsLength=this.$colors.length}},get:function(){return this.$colors}},pickingColors:{set:function(c){if(c){var k=c.length;if(c.BYTES_PER_ELEMENT)this.$pickingColors=c;else if(this.$pickingColorsLength==k)this.$pickingColors.set(c);
else this.$pickingColors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=k)this.$pickingColors=x(j.call(this.$pickingColors),this.$verticesLength/3*4);this.$pickingColorsLength=this.$pickingColors.length}},get:function(){return this.$pickingColors}},texCoords:{set:function(c){if(c)if(u.type(c)=="object"){var k={},m;for(m in c){var n=c[m];k[m]=n.BYTES_PER_ELEMENT?n:new Float32Array(n)}this.$texCoords=k}else{k=c.length;if(c.BYTES_PER_ELEMENT)this.$texCoords=c;else if(this.$texCoordsLength==
k)this.$texCoords.set(c);else this.$texCoords=new Float32Array(c);this.$texCoordsLength=k}},get:function(){return this.$texCoords}},indices:{set:function(c){if(c){var k=c.length;if(c.BYTES_PER_ELEMENT)this.$indices=c;else if(this.$indicesLength==k)this.$indices.set(c);else this.$indices=new Uint16Array(c);this.$indicesLength=k}},get:function(){return this.$indices}}});u.extend(h.Model.prototype,{$$family:"model",update:function(){var c=this.matrix,k=this.position,m=this.rotation,n=this.scale;c.id();
c.$translate(k.x,k.y,k.z);c.$rotateXYZ(m.x,m.y,m.z);c.$scale(n.x,n.y,n.z)},computeCentroids:function(){var c=this.vertices,k=[];this.faces.forEach(function(m){var n=[0,0,0],r=0;m.forEach(function(B){B=c[B];n[0]+=B[0];n[1]+=B[1];n[2]+=B[2];r++});n[0]/=r;n[1]/=r;n[2]/=r;k.push(n)});this.centroids=k},computeNormals:function(){var c=this.vertices,k=[];this.faces.forEach(function(m){var n=c[m[0]],r=c[m[1]];m=c[m[2]];n={x:n[0]-r[0],y:n[1]-r[1],z:n[2]-r[2]};y.$cross(n,{x:m[0]-r[0],y:m[1]-r[1],z:m[1]-r[2]});
y.norm(n)>1.0E-6&&y.unit(n);k.push([n.x,n.y,n.z])});this.normals=k}});u.extend(h.Model.prototype,{setUniforms:function(c){c.setUniforms(this.uniforms)},setAttributes:function(c){var k=this.attributes,m;for(m in k){var n=k[m],r=this.id+"-"+m;if(Object.keys(n).length){n.attribute=m;c.setBuffer(r,n);delete n.value}else c.setBuffer(r,true)}},unsetAttributes:function(c){var k=this.attributes,m;for(m in k)c.setBuffer(this.id+"-"+m,false)},setShininess:function(c){c.setUniform("shininess",this.shininess||
0)},setVertices:function(c,k){if(this.vertices)k||this.dynamic?c.setBuffer("vertices-"+this.id,{attribute:"position",value:this.vertices,size:3}):c.setBuffer("vertices-"+this.id)},unsetVertices:function(c){c.setBuffer("vertices-"+this.id,false)},setNormals:function(c,k){if(this.normals)k||this.dynamic?c.setBuffer("normals-"+this.id,{attribute:"normal",value:this.normals,size:3}):c.setBuffer("normals-"+this.id)},unsetNormals:function(c){c.setBuffer("normals-"+this.id,false)},setIndices:function(c,
k){if(this.indices)k||this.dynamic?c.setBuffer("indices-"+this.id,{bufferType:o.ELEMENT_ARRAY_BUFFER,drawType:o.STATIC_DRAW,value:this.indices,size:1}):c.setBuffer("indices-"+this.id)},unsetIndices:function(c){c.setBuffer("indices-"+this.id,false)},setPickingColors:function(c,k){if(this.pickingColors)k||this.dynamic?c.setBuffer("pickingColors-"+this.id,{attribute:"pickingColor",value:this.pickingColors,size:4}):c.setBuffer("pickingColors-"+this.id)},unsetPickingColors:function(c){c.setBuffer("pickingColors-"+
this.id,false)},setColors:function(c,k){if(this.colors)k||this.dynamic?c.setBuffer("colors-"+this.id,{attribute:"color",value:this.colors,size:4}):c.setBuffer("colors-"+this.id)},unsetColors:function(c){c.setBuffer("colors-"+this.id,false)},setTexCoords:function(c,k){if(this.texCoords){var m=this.id;if(k||this.dynamic)u.type(this.texCoords)=="object"?this.textures.forEach(function(n,r){c.setBuffer("texCoords-"+r+"-"+m,{attribute:"texCoord"+(r+1),value:this.texCoords[n],size:2})}):c.setBuffer("texCoords-"+
m,{attribute:"texCoord1",value:this.texCoords,size:2});else u.type(this.texCoords)=="object"?this.textures.forEach(function(n,r){c.setBuffer("texCoords-"+r+"-"+m)}):c.setBuffer("texCoords-"+m)}},unsetTexCoords:function(c){c.setBuffer("texCoords-"+this.id,false)},setTextures:function(c){this.textures=this.textures?u.splat(this.textures):[];for(var k=0,m=this.textures,n=m.length,r=PhiloGL.Scene.MAX_TEXTURES;k<r;k++)if(k<n){c.setUniform("hasTexture"+(k+1),true);c.setUniform("sampler"+(k+1),k);c.setTexture(m[k],
o["TEXTURE"+k])}else c.setUniform("hasTexture"+(k+1),false)}});h.Cube=function(c){h.Model.call(this,u.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,
0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c||{}))};h.Cube.prototype=Object.create(h.Model.prototype);h.Sphere=function(c){var k=c.nlat||10,m=c.nlong||10,n=c.radius||1,r=g-0,B=2*g-0,t=(k+1)*(m+1),z=new Float32Array(t*3),a=new Float32Array(t*3);t=new Float32Array(t*2);var b=new Uint16Array(k*m*6);if(typeof n=="number"){var f=n;n=function(){return f}}for(var l=0;l<=
k;l++)for(var p=0;p<=m;p++){var s=p/m,v=l/k,w=B*s,A=r*v,C=d(w);w=i(w);var D=d(A),E=i(A);A=w*D;w=E;C*=D;D=n(A,w,C,s,v);E=p+l*(m+1);var G=E*3;E*=2;z[G+0]=D*A;z[G+1]=D*w;z[G+2]=D*C;a[G+0]=A;a[G+1]=w;a[G+2]=C;t[E+0]=s;t[E+1]=v}n=k+1;for(p=0;p<k;p++)for(l=0;l<m;l++){E=(p*m+l)*6;b[E+0]=l*n+p;b[E+1]=l*n+p+1;b[E+2]=(l+1)*n+p;b[E+3]=(l+1)*n+p;b[E+4]=l*n+p+1;b[E+5]=(l+1)*n+p+1}h.Model.call(this,u.extend({vertices:z,indices:b,normals:a,texCoords:t},c||{}))};h.Sphere.prototype=Object.create(h.Model.prototype);
h.IcoSphere=function(c){var k=c.iterations||0,m=[],n=[],r=Math.sqrt,B=Math.acos,t=Math.atan2,z=Math.PI,a=z*2;c.onAddVertex=c.onAddVertex||u.empty;var b=(1+r(5))/2,f=r(1+b*b);m.push(-1/f,b/f,0,1/f,b/f,0,-1/f,-b/f,0,1/f,-b/f,0,0,-1/f,b/f,0,1/f,b/f,0,-1/f,-b/f,0,1/f,-b/f,b/f,0,-1/f,b/f,0,1/f,-b/f,0,-1/f,-b/f,0,1/f);n.push(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1);var l=function(){var W={};return function(S,T){S*=
3;T*=3;var X=(S<T?S:T)+"|"+(S>T?S:T);if(X in W)return W[X];var N=(m[S]+m[T])/2,Y=(m[S+1]+m[T+1])/2,Z=(m[S+2]+m[T+2])/2,$=r(N*N+Y*Y+Z*Z);N/=$;Y/=$;Z/=$;m.push(N,Y,Z);return W[X]=m.length/3-1}}();for(b=0;b<k;b++){var p=[],s=0;for(f=n.length;s<f;s+=3){var v=l(n[s],n[s+1]),w=l(n[s+1],n[s+2]),A=l(n[s+2],n[s]);p.push(n[s],v,A,n[s+1],w,v,n[s+2],A,w,v,w,A)}n=p}f=n.length;k=new Float32Array(f*3);l=new Float32Array(f*2);for(b=0;b<f;b+=3){w=n[b];A=n[b+1];var C=n[b+2];p=w*3;s=A*3;v=C*3;w*=2;A*=2;C*=2;var D=m[p],
E=m[p+1],G=m[p+2],I=B(G/r(D*D+E*E+G*G)),J=t(E,D);I/=z;J=1-J/a;var H=m[s],F=m[s+1],M=m[s+2],K=B(M/r(H*H+F*F+M*M)),L=t(F,H);K/=z;L=1-L/a;var O=m[v],Q=m[v+1],P=m[v+2],R=B(P/r(O*O+Q*Q+P*P)),U=t(Q,O);R/=z;U=1-U/a;D=y.cross({x:O-H,y:Q-F,z:P-M},{x:D-H,y:E-F,z:G-M}).$unit();k[p]=k[s]=k[v]=D.x;k[p+1]=k[s+1]=k[v+1]=D.y;k[p+2]=k[s+2]=k[v+2]=D.z;l[w]=J;l[w+1]=I;l[A]=L;l[A+1]=K;l[C]=U;l[C+1]=R}h.Model.call(this,u.extend({vertices:m,indices:n,normals:k,texCoords:l},c||{}))};h.IcoSphere.prototype=Object.create(h.Model.prototype);
h.TruncatedCone=function(c){var k=c.bottomRadius||0,m=c.topRadius||0,n=c.height||1,r=c.nradial||10,B=c.nvertical||10,t=!!c.topCap,z=!!c.bottomCap,a=(t?2:0)+(z?2:0),b=(r+1)*(B+1+a),f=new Float32Array(b*3),l=new Float32Array(b*3);b=new Float32Array(b*2);var p=new Uint16Array(r*(B+a)*6),s=r+1,v=Math,w=v.atan2(k-m,n),A=v.sin,C=v.cos;v=v.PI;var D=C(w);w=A(w);z=B+(z?2:0);var E=0,G=0;for(t=t?-2:0;t<=z;t++){var I=t/B,J=n*I,H;if(t<0){J=0;I=1;H=k}else if(t>B){J=n;I=1;H=m}else H=k+(m-k)*(t/B);if(t==-2||t==B+
2)I=H=0;J-=n/2;for(var F=0;F<s;F++){var M=A(F*v*2/r),K=C(F*v*2/r);f[E+0]=M*H;f[E+1]=J;f[E+2]=K*H;l[E+0]=t<0||t>B?0:M*D;l[E+1]=t<0?-1:t>B?1:w;l[E+2]=t<0||t>B?0:K*D;b[G+0]=F/r;b[G+1]=I;G+=2;E+=3}}for(t=0;t<B+a;t++)for(F=0;F<r;F++){k=(t*r+F)*6;p[k+0]=s*(t+0)+0+F;p[k+1]=s*(t+0)+1+F;p[k+2]=s*(t+1)+1+F;p[k+3]=s*(t+0)+0+F;p[k+4]=s*(t+1)+1+F;p[k+5]=s*(t+1)+0+F}h.Model.call(this,u.extend({vertices:f,normals:l,texCoords:b,indices:p},c||{}))};h.TruncatedCone.prototype=Object.create(h.Model.prototype);h.Cone=
function(c){c.topRadius=0;c.topCap=!!c.cap;c.bottomCap=!!c.cap;c.bottomRadius=c.radius||3;h.TruncatedCone.call(this,c)};h.Cone.prototype=Object.create(h.TruncatedCone.prototype);h.Cylinder=function(c){c.bottomRadius=c.radius;c.topRadius=c.radius;h.TruncatedCone.call(this,c)};h.Cylinder.prototype=Object.create(h.TruncatedCone.prototype);h.Plane=function(c){var k=c.type,m=k.split(","),n=c[m[0]+"len"],r=c[m[1]+"len"],B=c["n"+m[0]]||1;m=c["n"+m[1]]||1;var t=c.offset;numVertices=(B+1)*(m+1);positions=
new Float32Array(numVertices*3);normals=new Float32Array(numVertices*3);texCoords=new Float32Array(numVertices*2);for(var z=i3=i2=0;z<=m;z++)for(var a=0;a<=B;a++){var b=a/B,f=z/m;texCoords[i2+0]=b;texCoords[i2+1]=f;i2+=2;switch(k){case "x,y":positions[i3+0]=n*b-n*0.5;positions[i3+1]=r*f-r*0.5;positions[i3+2]=t;normals[i3+0]=0;normals[i3+1]=0;normals[i3+2]=1;break;case "x,z":positions[i3+0]=n*b-n*0.5;positions[i3+1]=t;positions[i3+2]=r*f-r*0.5;normals[i3+0]=0;normals[i3+1]=1;normals[i3+2]=0;break;
case "y,z":positions[i3+0]=t;positions[i3+1]=n*b-n*0.5;positions[i3+2]=r*f-r*0.5;normals[i3+0]=1;normals[i3+1]=0;normals[i3+2]=0}i3+=3}k=B+1;n=[];for(z=0;z<m;z++)for(a=0;a<B;a++){r=(z*B+a)*6;n[r+0]=(z+0)*k+a;n[r+1]=(z+1)*k+a;n[r+2]=(z+0)*k+a+1;n[r+3]=(z+1)*k+a;n[r+4]=(z+1)*k+a+1;n[r+5]=(z+0)*k+a+1}h.Model.call(this,u.extend({vertices:positions,normals:normals,texCoords:texCoords,indices:n},c))};h.Plane.prototype=Object.create(h.Model.prototype);h.id=u.time();PhiloGL.O3D=h})();(function(){var x={Vertex:{},
Fragment:{}},y=x.Fragment;x.Vertex.Default="#define LIGHT_MAX 40\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec4 pickingColor;\nattribute vec2 texCoord1;\nuniform mat4 modelViewMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 normalMatrix;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nvec4 transformedNormal = normalMatrix * vec4(normal, 1.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nvColor = color;\nvPickingColor = pickingColor;\nvTexCoord = texCoord1;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}";
y.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif(!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif(enablePicking) {\nif(hasPickingColors) {\ngl_FragColor = vPickingColor;\n} else {\ngl_FragColor = vec4(pickColor, 1.0);\n}\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
PhiloGL.Shaders=x})();(function(){var x=PhiloGL.Vec3,y=PhiloGL.Mat4,q=function(i,d,g){g=u.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},g||{});this.program=g.program?i[g.program]:i;this.camera=d;this.models=[];this.config=g};q.prototype={add:function(){for(var i=0,d=this.models,g=arguments.length;i<g;i++){var j=arguments[i];j.id=j.id||u.uid();d.push(j);this.defineBuffers(j)}},remove:function(i){var d=this.models;
i=d.indexOf(i);i>-1&&d.splice(i,1)},getProgram:function(i){var d=this.program;if(d.$$family!="program"&&i&&i.program){d=d[i.program];d.use()}return d},defineBuffers:function(i){var d=this.getProgram(i);i.setAttributes(d,true);i.setVertices(d,true);i.setColors(d,true);i.setPickingColors(d,true);i.setNormals(d,true);i.setTexCoords(d,true);i.setIndices(d,true)},beforeRender:function(i){this.setupLighting(i);this.setupEffects(i);var d=this.camera;i.setUniform("projectionMatrix",d.projection);i.setUniform("viewMatrix",
d.modelView)},setupLighting:function(i){var d=this.config.lights,g=d.ambient,j=d.directional,h=j.color,c=j.direction,k=d.enable;d=d.points&&u.splat(d.points)||[];j=d.length;var m=[],n=[],r=[],B=[];c=x.unit([c.x,c.y,c.z]).$scale(-1);i.setUniform("enableLights",k);if(k){i.setUniform("ambientColor",[g.r,g.g,g.b]);i.setUniform("directionalColor",[h.r,h.g,h.b]);i.setUniform("lightingDirection",[c.x,c.y,c.z]);i.setUniform("numberPoints",j);for(g=0;g<j;g++){k=d[g];h=k.position;c=k.color||k.diffuse;k=k.specular;
m.push(h.x,h.y,h.z);n.push(c.r,c.g,c.b);r.push(+!!k);k?B.push(k.r,k.g,k.b):B.push(0,0,0)}i.setUniforms({pointLocation:m,pointColor:n});i.setUniforms({enableSpecular:r,pointSpecularColor:B})}},setupEffects:function(i){var d=this.config.effects.fog,g=d.color||{r:0.5,g:0.5,b:0.5};d?i.setUniforms({hasFog:true,fogNear:d.near,fogFar:d.far,fogColor:[g.r,g.g,g.b]}):i.setUniform("hasFog",false)},render:function(i){i=i||{};var d=this.camera,g=this.program,j=i.renderProgram,h=u.type(g),c=!j&&h=="object",k=u.merge({onBeforeRender:u.empty,
onAfterRender:u.empty},i||{});!c&&this.beforeRender(j||g);this.models.forEach(function(m,n){if(m.display){var r=j||this.getProgram(m);c&&this.beforeRender(r);m.onBeforeRender(r,d);k.onBeforeRender(m,n);this.renderObject(m,r);k.onAfterRender(m,n);m.onAfterRender(r,d)}},this)},renderToTexture:function(i,d){d=d||{};var g=V.textures[i+"-texture"],j=V.textureMemo[i+"-texture"];this.render(d);o.bindTexture(j.textureType,g);o.generateMipmap(j.textureType);o.bindTexture(j.textureType,null)},renderObject:function(i,
d){var g=this.camera,j=new y;i.setUniforms(d);i.setAttributes(d);i.setShininess(d);i.setVertices(d);i.setColors(d);i.setPickingColors(d);i.setNormals(d);i.setTextures(d);i.setTexCoords(d);i.setIndices(d);j.mulMat42(g.modelView,i.matrix);d.setUniform("modelViewMatrix",j);d.setUniform("normalMatrix",j.invert().$transpose());if(i.render)i.render(o,d,g);else i.indices?o.drawElements(i.drawType!==undefined?o.get(i.drawType):o.TRIANGLES,i.indices.length,o.UNSIGNED_SHORT,0):o.drawArrays(i.drawType!==undefined?
o.get(i.drawType):o.TRIANGLES,0,i.vertices.length/3);i.unsetAttributes(d);i.unsetVertices(d);i.unsetColors(d);i.unsetPickingColors(d);i.unsetNormals(d);i.unsetTexCoords(d);i.unsetIndices(d)},setupPicking:function(){var i=PhiloGL.Program.fromDefaultShaders();V.setFrameBuffer("$picking",{width:1,height:1,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:true});V.setFrameBuffer("$picking",false);
this.pickingProgram=i},pick:function(i,d){this.pickingProgram||this.setupPicking();var g={},j=[],h=V.usedProgram,c=this.pickingProgram,k=this.config,m=k.lights.enable,n=k.effects.fog,r=o.canvas.width,B=o.canvas.height,t=[],z=new Uint8Array(4),a=0,b;k.lights.enable=false;k.effects.fog=false;c.use();V.setFrameBuffer("$picking",true);c.setUniform("enablePicking",true);o.disable(o.BLEND);o.viewport(-i,d-B,r,B);o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);o.readPixels(0,0,1,1,o.RGBA,o.UNSIGNED_BYTE,
z);b=z[0]+z[1]*256+z[2]*65536;this.renderToTexture("$picking",{renderProgram:c,onBeforeRender:function(p,s){if(s==b)a=1;var v=s+a,w=!!p.pickingColors;c.setUniform("hasPickingColors",w);if(w)j.push(p);else{t[0]=v%256;t[1]=(v/256>>0)%256;t[2]=(v/65536>>0)%256;c.setUniform("pickColor",[t[0]/255,t[1]/255,t[2]/255]);g[t.join()]=p}}});o.readPixels(0,0,1,1,o.RGBA,o.UNSIGNED_BYTE,z);r=[z[0],z[1],z[2]].join();r=g[r];if(!r)for(var f=0,l=j.length;f<l;f++){r=j[f];B=r.pick(z);if(B!==false)r.$pickingIndex=B;else r=
false}V.setFrameBuffer("$picking",false);c.setUniform("enablePicking",false);k.lights.enable=m;k.effects.fog=n;h&&h.use();return r&&r.pickable&&r}};q.MAX_TEXTURES=3;q.MAX_POINT_LIGHTS=50;PhiloGL.Scene=q})();(function(){function x(y,q){for(var i=this.workers=[];q--;)i.push(new Worker(y))}x.prototype={map:function(y){var q=this.workers,i=this.configs=[],d=0;for(q=q.length;d<q;d++)i.push(y&&y(d));return this},reduce:function(y){for(var q=y.reduceFn,i=this.workers,d=this.configs,g=i.length,j=y.initialValue,
h=function(n){g--;j=j===undefined?n.data:q(j,n.data);if(g==0)y.onComplete(j)},c=0,k=g;c<k;c++){var m=i[c];m.onmessage=h;m.postMessage(d[c])}return this}};PhiloGL.WorkerGroup=x})();(function(){var x=function(d){this.opt=u.merge({duration:1E3,transition:function(g){return g},onCompute:u.empty,onComplete:u.empty},d||{})};x.prototype={timer:null,time:null,start:function(d){this.opt=u.merge(this.opt,d||{});this.time=u.time();this.animating=true},step:function(){if(this.animating){var d=u.time(),g=this.time,
j=this.opt;if(d<g+j.duration){d=j.transition((d-g)/j.duration);j.onCompute.call(this,d)}else{this.animating=false;j.onCompute.call(this,1);j.onComplete.call(this)}}}};x.compute=function(d,g,j){return d+(g-d)*j};x.Transition={linear:function(d){return d}};var y=x.Transition;(function(){var d=function(h,c){c=u.splat(c);return u.extend(h,{easeIn:function(k){return h(k,c)},easeOut:function(k){return 1-h(1-k,c)},easeInOut:function(k){return k<=0.5?h(2*k,c)/2:(2-h(2*(1-k),c))/2}})},g={Pow:function(h,c){return Math.pow(h,
c[0]||6)},Expo:function(h){return Math.pow(2,8*(h-1))},Circ:function(h){return 1-Math.sin(Math.acos(h))},Sine:function(h){return 1-Math.sin((1-h)*Math.PI/2)},Back:function(h,c){c=c[0]||1.618;return Math.pow(h,2)*((c+1)*h-c)},Bounce:function(h){for(var c,k=0,m=1;;k+=m,m/=2)if(h>=(7-4*k)/11){c=m*m-Math.pow((11-6*k-11*h)/4,2);break}return c},Elastic:function(h,c){return Math.pow(2,10*--h)*Math.cos(20*h*Math.PI*(c[0]||1)/3)}},j;for(j in g)y[j]=d(g[j]);["Quad","Cubic","Quart","Quint"].forEach(function(h,
c){y[h]=d(function(k){return Math.pow(k,[c+2])})})})();var q=self||window;if(q){var i=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(d){if(d in q){x.animationTime=function(){return q[d]};i=true}});if(!i)x.animationTime=u.time;i=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(d){if(d in q){x.requestAnimationFrame=function(g){q[d](function(){g()})};
i=true}});if(!i)x.requestAnimationFrame=function(d){setTimeout(function(){d()},1E3/60)}}PhiloGL.Fx=x})()})();
