/*

 Copyright (c) 2011 Nicolas Garcia Belmonte (http://philogb.github.com/)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
(function(){function u(z){return document.getElementById(z)}this.Octant=null;(function(){Octant=function(z,x){function i(s,B,t){var w=s.canvas,a=new Octant.Camera(d.fov,w.width/w.height,d.near,d.far,d);a.update();var b=new Octant.Scene(B,a,c);T=new Octant.WebGL.Application({gl:s,canvas:w,program:B,scene:b,camera:a});B.$$family=="program"&&B.use();h&&Octant.Events.create(T,u.extend(h,{bind:T}));if(l.src.length)new Octant.IO.Textures(u.extend(l,{onComplete:function(){t(T)}}));else t(T)}x=u.merge({context:{},
camera:{fov:45,near:0.1,far:500},program:{from:"defaults",vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:u.empty,onError:u.empty},x||{});var j=x.context,d=x.camera,h=x.events,l=x.textures,g=u.splat(x.program),c=x.scene;p=Octant.WebGL.getContext(z,j);if(!p){x.onError("The WebGL context couldn't been initialized");return null}var n={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},m=g.length,o=function(){var s=m,B={},t=false;
return{onSuccess:function(w,a){B[a.id||m-s]=w;s--;if(s==0&&!t)i(p,m==1?w:B,function(b){x.onLoad(b)})},onError:function(){s--;x.onError(x.id);t=true}}}();g.forEach(function(s){var B=s.from,t;for(t in n)if(B==t){program=Octant.Program[n[t]](u.extend(o,s));break}if(program)o.onSuccess(program,s)})}})();Octant.unpack=function(z){z=z||aa;["Vec3","Mat4","Quat","Camera","Program","WebGL","O3D","Scene","Shaders","IO","Events","WorkerGroup","Fx"].forEach(function(x){z[x]=Octant[x]})};Octant.version="1.2.1";
var p,T,aa=this;u.empty=function(){};u.time=Date.now||function(){return+new Date};u.uid=function(){var z=u.time();return function(){return z++}}();u.extend=function(z,x){for(var i in x)z[i]=x[i];return z};u.type=function(){var z=Object.prototype.toString;return function(x){var i;i=z.call(x);i=i.substr(8,i.length-9).toLowerCase();if(i!="object")return i;if(x.$$family)return x.$$family;return x&&x.nodeName&&x.nodeType==1?"element":i}}();(function(){function z(x){var i=u.type(x);if(i=="object"){i={};
for(var j in x)i[j]=z(x[j]);return i}else if(i=="array"){i=[];j=0;for(var d=x.length;j<d;j++)i[j]=z(x[j]);return i}else return x}u.merge=function(){for(var x={},i=0,j=arguments.length;i<j;i++){var d=arguments[i];if(u.type(d)=="object")for(var h in d){var l=d[h],g=x[h];x[h]=g&&u.type(l)=="object"&&u.type(g)=="object"?u.merge(g,l):z(l)}}return x}})();u.splat=function(){var z=Array.isArray;return function(x){return z(x)&&x||[x]}}();(function(){function z(i){for(var j in i)this[j]=i[j];this.buffers={};
this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo={}}var x={getContext:function(i,j){i=typeof i=="string"?u(i):i;var d;(d=i.getContext("experimental-webgl",j))||(d=i.getContext("webgl",j));if(d&&j&&j.debug){p={};for(var h in d){var l=d[h];p[h]=typeof l=="function"?function(g,c){return function(){console.log(g,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var n=c.apply(d,
arguments)}catch(m){throw g+" "+m;}for(var o=[],s;(s=d.getError())!==d.NO_ERROR;)o.push(s);if(o.length)throw o.join();return n}}(h,l):l}}else p=d;if(p)p.get=function(g){return typeof g=="string"?p[g]:g};return p}};z.prototype={$$family:"application",setBuffer:function(i,j,d){if(d===false||d===null){(d=this.bufferMemo[j])&&p.bindBuffer(d.bufferType,null);var h=d&&d.attribute||j;i=i.attributes[h];i!==undefined&&p.disableVertexAttribArray(i)}else{d=u.merge({bufferType:p.ARRAY_BUFFER,size:1,dataType:p.FLOAT,
stride:0,offset:0,drawType:p.STATIC_DRAW},this.bufferMemo[j]||{},d||{});h=d.attribute||j;var l=d.bufferType,g=j in this.buffers,c=g?this.buffers[j]:p.createBuffer(),n="value"in d,m=d.value,o=d.size,s=d.dataType,B=d.stride,t=d.offset,w=d.drawType;i=i.attributes[h];var a=i!==undefined;g||(this.buffers[j]=c);a&&p.enableVertexAttribArray(i);p.bindBuffer(l,c);n&&p.bufferData(l,m,w);a&&p.vertexAttribPointer(i,o,s,false,B,t);delete d.value;this.bufferMemo[j]=d;if(a)this.bufferMemo[h]=d;return this}},setBuffers:function(i,
j){for(var d in j)this.setBuffer(i,d,j[d]);return this},setFrameBuffer:function(i,j){if(typeof j!="object")p.bindFramebuffer(p.FRAMEBUFFER,j?this.frameBuffers[i]:null);else{j=u.merge({width:0,height:0,bindToTexture:false,textureOptions:{attachment:p.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:p.DEPTH_ATTACHMENT}},this.frameBufferMemo[i]||{},j||{});var d=j.bindToTexture,h=j.bindToRenderBuffer,l=i in this.frameBuffers,g=l?this.frameBuffers[i]:p.createFramebuffer(p.FRAMEBUFFER);
p.bindFramebuffer(p.FRAMEBUFFER,g);l||(this.frameBuffers[i]=g);if(d){d=u.merge({data:{width:j.width,height:j.height}},u.type(d)=="object"?d:{});l=i+"-texture";g=j.textureOptions;this.setTexture(l,d);p.framebufferTexture2D(p.FRAMEBUFFER,g.attachment,this.textureMemo[l].textureType,this.textures[l],0)}if(h){h=u.merge({width:j.width,height:j.height},u.type(h)=="object"?h:{});d=i+"-renderbuffer";l=j.renderBufferOptions;this.setRenderBuffer(d,h);p.framebufferRenderbuffer(p.FRAMEBUFFER,l.attachment,p.RENDERBUFFER,
this.renderBuffers[d])}p.bindTexture(p.TEXTURE_2D,null);p.bindRenderbuffer(p.RENDERBUFFER,null);p.bindFramebuffer(p.FRAMEBUFFER,null);this.frameBufferMemo[i]=j;return this}},setFrameBuffers:function(i){for(var j in i)this.setFrameBuffer(j,i[j]);return this},setRenderBuffer:function(i,j){if(typeof j!="object")p.bindRenderbuffer(p.RENDERBUFFER,j?this.renderBufferMemo[i]:null);else{j=u.merge({storageType:p.DEPTH_COMPONENT16,width:0,height:0},this.renderBufferMemo[i]||{},j||{});var d=i in this.renderBuffers,
h=d?this.renderBuffers[i]:p.createRenderbuffer(p.RENDERBUFFER);d||(this.renderBuffers[i]=h);p.bindRenderbuffer(p.RENDERBUFFER,h);p.renderbufferStorage(p.RENDERBUFFER,j.storageType,j.width,j.height);this.renderBufferMemo[i]=j;return this}},setRenderBuffers:function(i){for(var j in i)this.setRenderBuffer(j,i[j]);return this},setTexture:function(i,j){if(!j||typeof j!="object"){p.activeTexture(j||p.TEXTURE0);p.bindTexture(this.textureMemo[i].textureType||p.TEXTURE_2D,this.textures[i])}else{j=u.merge({textureType:p.TEXTURE_2D,
pixelStore:[{name:p.UNPACK_FLIP_Y_WEBGL,value:true}],parameters:[{name:p.TEXTURE_MAG_FILTER,value:p.NEAREST},{name:p.TEXTURE_MIN_FILTER,value:p.NEAREST}],data:{format:p.RGBA,value:false,width:0,height:0,border:0}},this.textureMemo[i]||{},j||{});var d="textureType"in j?p.get(j.textureType):p.TEXTURE_2D,h="textureTarget"in j?p.get(j.textureTarget):d,l=d==p.TEXTURE_CUBE_MAP,g=i in this.textures,c=g?this.textures[i]:p.createTexture(),n=j.pixelStore,m=j.parameters,o=j.data,s=o.value,B=o.format,t=!!o.value;
g||(this.textures[i]=c);p.bindTexture(d,c);g||n.forEach(function(w){w.name=typeof w.name=="string"?p[w.name]:w.name;p.pixelStorei(w.name,w.value)});if(t)if(l)for(c=0;c<6;++c)p.texSubImage2D(h+c,0,0,0,B,p.UNSIGNED_BYTE,s[c]);else p.texImage2D(h,0,B,B,p.UNSIGNED_BYTE,s);else if(o.width||o.height)p.texImage2D(h,0,B,o.width,o.height,o.border,B,p.UNSIGNED_BYTE,null);g||m.forEach(function(w){w.name=p.get(w.name);w.value=p.get(w.value);p.texParameteri(d,w.name,w.value);w.generateMipmap&&p.generateMipmap(d)});
j.isCube=l;delete j.data;this.textureMemo[i]=j;return this}},setTextures:function(i){for(var j in i)this.setTexture(j,i[j]);return this},use:function(i){p.useProgram(i.program);this.usedProgram=i;return this}};x.Application=z;(function(){try{var i=document.createElement("canvas");Octant.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(i.getContext("webgl")||i.getContext("experimental-webgl")))}}catch(j){Octant.hasWebGL=function(){return false}}})();Octant.WebGL=x})();(function(){function z(a){return{get:function(){return this[a]},
set:function(b){this[a]=b},configurable:false,enumerable:false}}var x=Math.sqrt,i=Math.sin,j=Math.cos,d=Math.tan,h=Math.PI,l=Array.prototype.slice,g=this.Float32Array,c=function(){if(!g.call)return Array;try{g.call({},10)}catch(a){return Array}return g}(),n=c!=Array,m=function(a,b,f){if(n){g.call(this,3);this[0]=a||0;this[1]=b||0;this[2]=f||0}else this.push(a||0,b||0,f||0);this.typedContainer=new g(3)};m.create=function(){return new g(3)};m.prototype=Object.create(c.prototype,{$$family:{value:"Vec3"},
x:z(0),y:z(1),z:z(2)});var o={setVec3:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,f,k){a[0]=b;a[1]=f;a[2]=k;return a},add:function(a,b){return new m(a[0]+b[0],a[1]+b[1],a[2]+b[2])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a},add2:function(a,b,f){a[0]=b[0]+f[0];a[1]=b[1]+f[1];a[2]=b[2]+f[2];return a},sub:function(a,b){return new m(a[0]-b[0],a[1]-b[1],a[2]-b[2])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return a},sub2:function(a,b,f){a[0]=b[0]-
f[0];a[1]=b[1]-f[1];a[2]=b[2]-f[2];return a},scale:function(a,b){return new m(a[0]*b,a[1]*b,a[2]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;return a},neg:function(a){return new m(-a[0],-a[1],-a[2])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a},unit:function(a){var b=m.norm(a);if(b>0)return m.scale(a,1/b);return m.clone(a)},$unit:function(a){var b=m.norm(a);if(b>0)return m.$scale(a,1/b);return a},cross:function(a,b){var f=a[0],k=a[1],q=a[2],r=b[0],v=b[1],y=b[2];return new m(k*
y-q*v,q*r-f*y,f*v-k*r)},$cross:function(a,b){var f=a[0],k=a[1],q=a[2],r=b[0],v=b[1],y=b[2];a[0]=k*y-q*v;a[1]=q*r-f*y;a[2]=f*v-k*r;return a},distTo:function(a,b){var f=a[0]-b[0],k=a[1]-b[1],q=a[2]-b[2];return x(f*f+k*k+q*q)},distToSq:function(a,b){var f=a[0]-b[0],k=a[1]-b[1],q=a[2]-b[2];return f*f+k*k+q*q},norm:function(a){var b=a[0],f=a[1];a=a[2];return x(b*b+f*f+a*a)},normSq:function(a){var b=a[0],f=a[1];a=a[2];return b*b+f*f+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},clone:function(a){return a.$$family?
new m(a[0],a[1],a[2]):m.setVec3(new g(3),a)},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}},s=m.prototype,B;for(B in o){m[B]=o[B];s[B]=function(a){return function(){var b=l.call(arguments);b.unshift(this);return m[a].apply(m,b)}}(B)}var t=function(a,b,f,k,q,r,v,y,A,C,D,E,G,I,J,H){c.call(this,16);this.length=16;typeof a=="number"?this.set(a,b,f,k,q,r,v,y,A,C,D,E,G,I,J,H):this.id();this.typedContainer=new g(16)};t.create=function(){return new g(16)};
t.prototype=Object.create(c.prototype,{$$family:{value:"Mat4"},n11:z(0),n12:z(4),n13:z(8),n14:z(12),n21:z(1),n22:z(5),n23:z(9),n24:z(13),n31:z(2),n32:z(6),n33:z(10),n34:z(14),n41:z(3),n42:z(7),n43:z(11),n44:z(15)});o={id:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){return a.$$family?new t(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]):new g(a)},set:function(a,
b,f,k,q,r,v,y,A,C,D,E,G,I,J,H,F){a[0]=b;a[4]=f;a[8]=k;a[12]=q;a[1]=r;a[5]=v;a[9]=y;a[13]=A;a[2]=C;a[6]=D;a[10]=E;a[14]=G;a[3]=I;a[7]=J;a[11]=H;a[15]=F;return a},mulVec3:function(a,b){var f=m.clone(b);return t.$mulVec3(a,f)},$mulVec3:function(a,b){var f=b[0],k=b[1],q=b[2];b[0]=a[0]*f+a[4]*k+a[8]*q+a[12];b[1]=a[1]*f+a[5]*k+a[9]*q+a[13];b[2]=a[2]*f+a[6]*k+a[10]*q+a[14];return b},mulMat42:function(a,b,f){var k=b[0],q=b[1],r=b[2],v=b[3],y=b[4],A=b[5],C=b[6],D=b[7],E=b[8],G=b[9],I=b[10],J=b[11],H=b[12],
F=b[13],M=b[14];b=b[15];var K=f[0],L=f[1],O=f[2],P=f[3],Q=f[4],U=f[5],V=f[6],W=f[7],R=f[8],S=f[9],X=f[10],N=f[11],Y=f[12],Z=f[13],$=f[14];f=f[15];a[0]=K*k+L*y+O*E+P*H;a[1]=K*q+L*A+O*G+P*F;a[2]=K*r+L*C+O*I+P*M;a[3]=K*v+L*D+O*J+P*b;a[4]=Q*k+U*y+V*E+W*H;a[5]=Q*q+U*A+V*G+W*F;a[6]=Q*r+U*C+V*I+W*M;a[7]=Q*v+U*D+V*J+W*b;a[8]=R*k+S*y+X*E+N*H;a[9]=R*q+S*A+X*G+N*F;a[10]=R*r+S*C+X*I+N*M;a[11]=R*v+S*D+X*J+N*b;a[12]=Y*k+Z*y+$*E+f*H;a[13]=Y*q+Z*A+$*G+f*F;a[14]=Y*r+Z*C+$*I+f*M;a[15]=Y*v+Z*D+$*J+f*b;return a},mulMat4:function(a,
b){var f=t.clone(a);return t.mulMat42(f,a,b)},$mulMat4:function(a,b){return t.mulMat42(a,a,b)},add:function(a,b){var f=t.clone(a);return t.$add(f,b)},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];a[4]+=b[4];a[5]+=b[5];a[6]+=b[6];a[7]+=b[7];a[8]+=b[8];a[9]+=b[9];a[10]+=b[10];a[11]+=b[11];a[12]+=b[12];a[13]+=b[13];a[14]+=b[14];a[15]+=b[15];return a},transpose:function(a){a=t.clone(a);return t.$transpose(a)},$transpose:function(a){var b=a[8],f=a[12],k=a[1],q=a[9],r=a[13],v=a[2],y=a[6],
A=a[14],C=a[3],D=a[7],E=a[11];a[1]=a[4];a[2]=b;a[3]=f;a[4]=k;a[6]=q;a[7]=r;a[8]=v;a[9]=y;a[11]=A;a[12]=C;a[13]=D;a[14]=E;return a},rotateAxis:function(a,b,f){a=t.clone(a);return t.$rotateAxis(a,b,f)},$rotateAxis:function(a,b,f){var k=i(b),q=j(b),r=1-q,v=f[0],y=f[1],A=f[2];f=v*v*r+q;b=v*y*r+A*k;var C=v*A*r-y*k,D=y*v*r-A*k,E=y*y*r+q,G=y*A*r+v*k,I=v*A*r+y*k;k=y*A*r-v*k;q=A*A*r+q;r=a[0];v=a[1];y=a[2];A=a[3];var J=a[4],H=a[5],F=a[6],M=a[7],K=a[8],L=a[9],O=a[10],P=a[11];a[0]=r*f+J*b+K*C;a[1]=v*f+H*b+L*
C;a[2]=y*f+F*b+O*C;a[3]=A*f+M*b+P*C;a[4]=r*D+J*E+K*G;a[5]=v*D+H*E+L*G;a[6]=y*D+F*E+O*G;a[7]=A*D+M*E+P*G;a[8]=r*I+J*k+K*q;a[9]=v*I+H*k+L*q;a[10]=y*I+F*k+O*q;a[11]=A*I+M*k+P*q;return a},rotateXYZ:function(a,b,f,k){a=t.clone(a);return t.$rotateXYZ(a,b,f,k)},$rotateXYZ:function(a,b,f,k){var q=a[0],r=a[1],v=a[2],y=a[3],A=a[4],C=a[5],D=a[6],E=a[7],G=a[8],I=a[9],J=a[10],H=a[11],F=j(b),M=j(f),K=j(k);b=i(b);var L=i(f),O=i(k);k=M*K;f=-F*O+b*L*K;var P=b*O+F*L*K,Q=M*O,U=F*K+b*L*O;K=-b*K+F*L*O;L=-L;b*=M;F*=M;
a[0]=q*k+A*Q+G*L;a[1]=r*k+C*Q+I*L;a[2]=v*k+D*Q+J*L;a[3]=y*k+E*Q+H*L;a[4]=q*f+A*U+G*b;a[5]=r*f+C*U+I*b;a[6]=v*f+D*U+J*b;a[7]=y*f+E*U+H*b;a[8]=q*P+A*K+G*F;a[9]=r*P+C*K+I*F;a[10]=v*P+D*K+J*F;a[11]=y*P+E*K+H*F;return a},translate:function(a,b,f,k){a=t.clone(a);return t.$translate(a,b,f,k)},$translate:function(a,b,f,k){a[12]=a[0]*b+a[4]*f+a[8]*k+a[12];a[13]=a[1]*b+a[5]*f+a[9]*k+a[13];a[14]=a[2]*b+a[6]*f+a[10]*k+a[14];a[15]=a[3]*b+a[7]*f+a[11]*k+a[15];return a},scale:function(a,b,f,k){a=t.clone(a);return t.$scale(a,
b,f,k)},$scale:function(a,b,f,k){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;a[4]*=f;a[5]*=f;a[6]*=f;a[7]*=f;a[8]*=k;a[9]*=k;a[10]*=k;a[11]*=k;return a},invert:function(a){a=t.clone(a);return t.$invert(a)},$invert:function(a){var b=a[0],f=a[1],k=a[2],q=a[3],r=a[4],v=a[5],y=a[6],A=a[7],C=a[8],D=a[9],E=a[10],G=a[11],I=a[12],J=a[13],H=a[14],F=a[15],M=b*v-f*r,K=b*y-k*r,L=b*A-q*r,O=f*y-k*v,P=f*A-q*v,Q=k*A-q*y,U=C*J-D*I,V=C*H-E*I,W=C*F-G*I,R=D*H-E*J,S=D*F-G*J,X=E*F-G*H,N=1/(M*X-K*S+L*R+O*W-P*V+Q*U);a[0]=(+v*X-y*S+
A*R)*N;a[1]=(-f*X+k*S-q*R)*N;a[2]=(+J*Q-H*P+F*O)*N;a[3]=(-D*Q+E*P-G*O)*N;a[4]=(-r*X+y*W-A*V)*N;a[5]=(+b*X-k*W+q*V)*N;a[6]=(-I*Q+H*L-F*K)*N;a[7]=(+C*Q-E*L+G*K)*N;a[8]=(+r*S-v*W+A*U)*N;a[9]=(-b*S+f*W-q*U)*N;a[10]=(+I*P-J*L+F*M)*N;a[11]=(-C*P+D*L-G*M)*N;a[12]=(-r*R+v*V-y*U)*N;a[13]=(+b*R-f*V+k*U)*N;a[14]=(-I*O+J*K-H*M)*N;a[15]=(+C*O-D*K+E*M)*N;return a},lookAt:function(a,b,f,k){f=m.sub(b,f);f.$unit();k=m.cross(k,f);k.$unit();var q=m.cross(f,k);q.$unit();return t.set(a,k[0],k[1],k[2],-k.dot(b),q[0],q[1],
q[2],-q.dot(b),f[0],f[1],f[2],-f.dot(b),0,0,0,1)},frustum:function(a,b,f,k,q,r,v){var y=f-b,A=q-k,C=v-r;a[0]=r*2/y;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=r*2/A;a[6]=0;a[7]=0;a[8]=(f+b)/y;a[9]=(q+k)/A;a[10]=-(v+r)/C;a[11]=-1;a[12]=0;a[13]=0;a[14]=-(v*r*2)/C;a[15]=0;return a},perspective:function(a,b,f,k,q){b=k*d(b*h/360);var r=-b;return t.frustum(a,r*f,b*f,r,b,k,q)},ortho:function(a,b,f,k,q,r,v){var y=f-b,A=q-k,C=v-r;a[0]=2/y;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2/A;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=-2/C;a[11]=
0;a[12]=-(b+f)/y;a[13]=-(q+k)/A;a[14]=-(v+r)/C;a[15]=1;return a},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}};s=t.prototype;for(B in o){t[B]=o[B];s[B]=function(a){return function(){var b=l.call(arguments);b.unshift(this);return t[a].apply(t,b)}}(B)}var w=function(a,b,f,k){c.call(this,4);this[0]=a||
0;this[1]=b||0;this[2]=f||0;this[3]=k||0;this.typedContainer=new g(4)};w.create=function(){return new g(4)};o={setQuat:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,f,k,q){a[0]=b||0;a[1]=f||0;a[2]=k||0;a[3]=q||0;return a},clone:function(a){return a.$$family?new w(a[0],a[1],a[2],a[3]):w.setQuat(new g(4),a)},neg:function(a){return new w(-a[0],-a[1],-a[2],-a[3])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];a[3]=-a[3];return a},add:function(a,b){return new w(a[0]+
b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];return a},sub:function(a,b){return new w(a[0]-b[0],a[1]-b[1],a[2]-b[2],a[3]-b[3])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];a[3]-=b[3];return a},scale:function(a,b){return new w(a[0]*b,a[1]*b,a[2]*b,a[3]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;return a},mulQuat:function(a,b){var f=a[0],k=a[1],q=a[2],r=a[3],v=b[0],y=b[1],A=b[2],C=b[3];return new w(r*v+f*C+k*A-q*y,r*y+k*C+
q*v-f*A,r*A+q*C+f*y-k*v,r*C-f*v-k*y-q*A)},$mulQuat:function(a,b){var f=a[0],k=a[1],q=a[2],r=a[3],v=b[0],y=b[1],A=b[2],C=b[3];a[0]=r*v+f*C+k*A-q*y;a[1]=r*y+k*C+q*v-f*A;a[2]=r*A+q*C+f*y-k*v;a[3]=r*C-f*v-k*y-q*A;return a},divQuat:function(a,b){var f=a[0],k=a[1],q=a[2],r=a[3],v=b[0],y=b[1],A=b[2],C=b[3],D=1/(C*C+v*v+y*y+A*A);return new w((f*C-r*v-k*A+q*y)*D,(f*A-r*y+k*C-q*v)*D,(k*v+q*C-r*A-f*y)*D,(r*C+f*v+k*y+q*A)*D)},$divQuat:function(a,b){var f=a[0],k=a[1],q=a[2],r=a[3],v=b[0],y=b[1],A=b[2],C=b[3],
D=1/(C*C+v*v+y*y+A*A);a[0]=(f*C-r*v-k*A+q*y)*D;a[1]=(f*A-r*y+k*C-q*v)*D;a[2]=(k*v+q*C-r*A-f*y)*D;a[3]=(r*C+f*v+k*y+q*A)*D;return a},invert:function(a){var b=a[0],f=a[1],k=a[2];a=a[3];var q=1/(b*b+f*f+k*k+a*a);return new w(-b*q,-f*q,-k*q,a*q)},$invert:function(a){var b=a[0],f=a[1],k=a[2],q=a[3],r=1/(b*b+f*f+k*k+q*q);a[0]=-b*r;a[1]=-f*r;a[2]=-k*r;a[3]=q*r;return a},norm:function(a){var b=a[0],f=a[1],k=a[2];a=a[3];return x(b*b+f*f+k*k+a*a)},normSq:function(a){var b=a[0],f=a[1],k=a[2];a=a[3];return b*
b+f*f+k*k+a*a},unit:function(a){return w.scale(a,1/w.norm(a))},$unit:function(a){return w.$scale(a,1/w.norm(a))},conjugate:function(a){return new w(-a[0],-a[1],-a[2],a[3])},$conjugate:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a}};s=w.prototype={};for(B in o){w[B]=o[B];s[B]=function(a){return function(){var b=l.call(arguments);b.unshift(this);return w[a].apply(w,b)}}(B)}m.fromQuat=function(a){return new m(a[0],a[1],a[2])};w.fromVec3=function(a,b){return new w(a[0],a[1],a[2],b||0)};w.fromMat4=
function(a){var b,f,k;if(a[0]>a[5]&&a[0]>a[10]){b=0;f=1;k=2}else if(a[5]>a[0]&&a[5]>a[10]){b=1;f=2;k=0}else{b=2;f=0;k=1}var q=x(1+a[b*5]-a[f*5]-a[k*5]),r=new w;r[b]=0.5*q;r[f]=0.5*(a["n"+f+""+b]+a["n"+b+""+f])/q;r[k]=0.5*(a["n"+b+""+k]+a["n"+k+""+b])/q;r[3]=0.5*(a["n"+f+""+k]-a["n"+k+""+f])/q;return r};w.fromXRotation=function(a){return new w(i(a/2),0,0,j(a/2))};w.fromYRotation=function(a){return new w(0,i(a/2),0,j(a/2))};w.fromZRotation=function(a){return new w(0,0,i(a/2),j(a/2))};w.fromAxisRotation=
function(a,b){var f=a[0],k=a[1],q=a[2],r=1/x(f*f+k*k+q*q),v=i(b/2),y=j(b/2);return new w(v*f*r,v*k*r,v*q*r,y)};t.fromQuat=function(a){var b=a[3],f=a[0],k=a[1];a=a[2];return new t(b*b+f*f-k*k-a*a,2*f*k-2*b*a,2*f*a+2*b*k,0,2*f*k+2*b*a,b*b-f*f+k*k-a*a,2*k*a-2*b*f,0,2*f*a-2*b*k,2*k*a+2*b*f,b*b-f*f-k*k+a*a,0,0,0,0,1)};Octant.Vec3=m;Octant.Mat4=t;Octant.Quat=w})();(function(){function z(h){return h!==true?h:false}var x=function(h){var l=function(g){for(var c={x:0,y:0};g&&!/^(?:body|html)$/i.test(g.tagName);){c.x+=
g.offsetLeft;c.y+=g.offsetTop;g=g.offsetParent}return c}(h);h=function(g){for(var c={x:0,y:0};g&&!/^(?:body|html)$/i.test(g.tagName);){c.x+=g.scrollLeft;c.y+=g.scrollTop;g=g.parentNode}return c}(h);return{x:l.x-h.x,y:l.y-h.y}},i={get:function(h,l){return h||(l||window).event},getWheel:function(h){return h.wheelDelta?h.wheelDelta/120:-(h.detail||0)/3},getKey:function(h){var l=h.which||h.keyCode,g;a:{g=d.Keys;for(var c in g)if(g[c]==l){g=c;break a}g=void 0}c=l-111;if(c>0&&c<13)g="f"+c;g=g||String.fromCharCode(l).toLowerCase();
return{code:l,key:g,shift:h.shiftKey,control:h.ctrlKey,alt:h.altKey,meta:h.metaKey}},isRightClick:function(h){return h.which==3||h.button==2},getPos:function(h,l){l=l||window;h=h||l.event;var g=l.document;g=g.documentElement||g.body;if(h.touches&&h.touches.length)h=h.touches[0];return{x:h.pageX||h.clientX+g.scrollLeft,y:h.pageY||h.clientY+g.scrollTop}},stop:function(h){h.stopPropagation&&h.stopPropagation();h.cancelBubble=true;if(h.preventDefault)h.preventDefault();else h.returnValue=false}},j=function(h,
l){var g=h.canvas;this.scene=h.scene;this.domElem=g;this.pos=x(g);this.opt=this.callbacks=l;this.size={width:g.width||g.offsetWidth,height:g.height||g.offsetHeight};this.attachEvents()};j.prototype={hovered:false,pressed:false,touched:false,touchMoved:false,moved:false,attachEvents:function(){var h=this.domElem,l=this;if(this.opt.disableContextMenu)h.oncontextmenu=function(){return false};["mouseup","mousedown","mousemove","mouseover","mouseout","touchstart","touchmove","touchend"].forEach(function(c){h.addEventListener(c,
function(n,m){l[c](l.eventInfo(c,n,m))},false)});["keydown","keyup"].forEach(function(c){document.addEventListener(c,function(n,m){l[c](l.eventInfo(c,n,m))},false)});var g="";g=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";h.addEventListener(g,function(c,n){l.mousewheel(l.eventInfo("mousewheel",c,n))},false)},eventInfo:function(h,l,g){var c=this.domElem,n=this.scene,m=this.opt,o=this.getSize(),s=m.relative,B=m.centerOrigin,t=m.cachePosition&&this.pos||x(c),
w=i.get(l,g),a=i.getPos(l,g);l={};g=a.x;c=a.y;if(s){g-=t.x;c-=t.y;if(B){g-=o.width/2;c-=o.height/2;c*=-1}}switch(h){case "mousewheel":l.wheel=i.getWheel(w);break;case "keydown":u.extend(l,i.getKey(w));break;case "mouseup":l.isRightClick=i.isRightClick(w)}var b;u.extend(l,{x:g,y:c,cache:false,stop:function(){i.stop(w)},getTarget:function(){if(b)return b;return b=!m.picking||n.pick(a.x-t.x,a.y-t.y)||true}});l.event=w;return l},getSize:function(){if(this.cacheSize)return this.size;var h=this.domElem;
return{width:h.width||h.offsetWidth,height:h.height||h.offsetHeight}},mouseup:function(h){if(!this.moved)if(h.isRightClick)this.callbacks.onRightClick(h,this.hovered);else this.callbacks.onClick(h,z(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(h,z(this.pressed));else this.callbacks.onDragCancel(h,z(this.pressed));this.pressed=this.moved=false}},mouseout:function(h){for(var l=h.relatedTarget,g=this.domElem;l&&l.parentNode;){if(g==l.parentNode)return;l=l.parentNode}if(this.hovered){this.callbacks.onMouseLeave(h,
this.hovered);this.hovered=false}},mouseover:function(){},mousemove:function(h){if(this.pressed){this.moved=true;this.callbacks.onDragMove(h,z(this.pressed))}else if(this.hovered){var l=z(h.getTarget());if(!l||l.id!=this.hovered.id){this.callbacks.onMouseLeave(h,this.hovered);if(this.hovered=l)this.callbacks.onMouseEnter(h,this.hovered)}else this.callbacks.onMouseMove(h,this.hovered)}else if(this.hovered=z(h.getTarget()))this.callbacks.onMouseEnter(h,this.hovered)},mousewheel:function(h){this.callbacks.onMouseWheel(h)},
mousedown:function(h){this.pressed=h.getTarget();this.callbacks.onDragStart(h,z(this.pressed))},touchstart:function(h){this.touched=h.getTarget();this.callbacks.onTouchStart(h,z(this.touched))},touchmove:function(h){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(h,z(this.touched))}},touchend:function(h){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(h,z(this.touched));else this.callbacks.onTouchCancel(h,z(this.touched));this.touched=this.touchMoved=false}},keydown:function(h){this.callbacks.onKeyDown(h)},
keyup:function(h){this.callbacks.onKeyUp(h)}};var d={};d.create=function(h,l){l=u.merge({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,onClick:u.empty,onRightClick:u.empty,onDragStart:u.empty,onDragMove:u.empty,onDragEnd:u.empty,onDragCancel:u.empty,onTouchStart:u.empty,onTouchMove:u.empty,onTouchEnd:u.empty,onTouchCancel:u.empty,onMouseMove:u.empty,onMouseEnter:u.empty,onMouseLeave:u.empty,onMouseWheel:u.empty,onKeyDown:u.empty,
onKeyUp:u.empty},l||{});var g=l.bind;if(g)for(var c in l)c.match(/^on[a-zA-Z0-9]+$/)&&function(n,m){l[n]=function(){return m.apply(g,Array.prototype.slice.call(arguments))}}(c,l[c]);new j(h,l)};d.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};Octant.Events=d})();(function(){function z(){return arguments.length==2?{vs:arguments[0],fs:arguments[1]}:arguments[0]||{}}var x=function(d,h,l){var g=d.createShader(l);if(g==null)throw"Error creating the shader with shader type: "+
l;d.shaderSource(g,h);d.compileShader(g);if(!d.getShaderParameter(g,d.COMPILE_STATUS)){h=d.getShaderInfoLog(g);d.deleteShader(g);throw"Error while compiling the shader "+h;}return g},i=function(d,h,l){var g=p.getUniformLocation(d,h.name);d=h.type;var c=false,n=true,m,o;if(h.size>1&&l)switch(d){case p.FLOAT:m=p.uniform1fv;o=Float32Array;n=false;break;case p.INT:case p.BOOL:case p.SAMPLER_2D:case p.SAMPLER_CUBE:m=p.uniform1iv;o=Uint16Array;n=false}if(n)switch(d){case p.FLOAT:m=p.uniform1f;break;case p.FLOAT_VEC2:m=
p.uniform2fv;o=l?Float32Array:new Float32Array(2);break;case p.FLOAT_VEC3:m=p.uniform3fv;o=l?Float32Array:new Float32Array(3);break;case p.FLOAT_VEC4:m=p.uniform4fv;o=l?Float32Array:new Float32Array(4);break;case p.INT:case p.BOOL:case p.SAMPLER_2D:case p.SAMPLER_CUBE:m=p.uniform1i;break;case p.INT_VEC2:case p.BOOL_VEC2:m=p.uniform2iv;o=l?Uint16Array:new Uint16Array(2);break;case p.INT_VEC3:case p.BOOL_VEC3:m=p.uniform3iv;o=l?Uint16Array:new Uint16Array(3);break;case p.INT_VEC4:case p.BOOL_VEC4:m=
p.uniform4iv;o=l?Uint16Array:new Uint16Array(4);break;case p.FLOAT_MAT2:c=true;m=p.uniformMatrix2fv;break;case p.FLOAT_MAT3:c=true;m=p.uniformMatrix3fv;break;case p.FLOAT_MAT4:c=true;m=p.uniformMatrix4fv}m=m.bind(p);return l?function(s){m(g,new o(s))}:c?function(s){m(g,false,s.toFloat32Array())}:o?function(s){o.set(s);m(g,o)}:function(s){m(g,s)};throw"Unknown type: "+d;},j=function(d,h){var l=p,g=l.createProgram();l.attachShader(g,x(l,d,l.VERTEX_SHADER));l.attachShader(g,x(l,h,l.FRAGMENT_SHADER));
l.linkProgram(g);if(!l.getProgramParameter(g,l.LINK_STATUS))throw"Error linking the shader: "+l.getProgramInfoLog(g);if(!g)return false;l={};for(var c={},n=p.getProgramParameter(g,p.ACTIVE_ATTRIBUTES),m=0;m<n;m++){var o=p.getActiveAttrib(g,m),s=o.name;o=p.getAttribLocation(g,o.name);l[s]=o}n=p.getProgramParameter(g,p.ACTIVE_UNIFORMS);for(m=0;m<n;m++){o=p.getActiveUniform(g,m);s=o.name;s=s[s.length-1]=="]"?s.substr(0,s.length-3):s;c[s]=i(g,o,o.name!=s)}this.program=g;this.attributes=l;this.uniforms=
c};j.prototype={$$family:"program",setUniform:function(d,h){if(this.uniforms[d])this.uniforms[d](h);return this},setUniforms:function(d){for(var h in d)this.setUniform(h,d[h]);return this}};["setBuffer","setBuffers","use"].forEach(function(d){j.prototype[d]=function(){var h=Array.prototype.slice.call(arguments);h.unshift(this);T[d].apply(T,h);return this}});["setFrameBuffer","setFrameBuffers","setRenderBuffer","setRenderBuffers","setTexture","setTextures"].forEach(function(d){j.prototype[d]=function(){T[d].apply(T,
arguments);return this}});j.fromShaderIds=function(){var d=z.apply({},arguments),h=u(d.vs);d=u(d.fs);return new j(h.innerHTML,d.innerHTML)};j.fromShaderSources=function(d){d=z.apply({},arguments);return new j(d.vs,d.fs)};j.fromDefaultShaders=function(){var d=z.apply({},arguments),h=Octant.Shaders;return Octant.Program.fromShaderSources(h.Vertex[d.vs||"Default"],h.Fragment[d.fs||"Default"])};j.fromShaderURIs=function(d){d=u.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:u.empty,onError:u.empty},
d||{});(new Octant.IO.XHR.Group({urls:[d.path+d.vs,d.path+d.fs],noCache:d.noCache,onError:function(h){d.onError(h)},onComplete:function(h){d.onSuccess(j.fromShaderSources(h[0],h[1]),d)}})).send()};Octant.Program=j})();(function(){var z={},x=function(d){this.opt=d=u.merge({url:"http://octantjs.org/",method:"GET",async:true,noCache:false,sendAsBinary:false,onProgress:u.empty,onSuccess:u.empty,onError:u.empty,onAbort:u.empty,onComplete:u.empty},d||{});this.initXHR()};x.State={};["UNINITIALIZED","LOADING",
"LOADED","INTERACTIVE","COMPLETED"].forEach(function(d,h){x.State[d]=h});x.prototype={initXHR:function(){var d=this.req=new XMLHttpRequest,h=this;["Progress","Error","Abort","Load"].forEach(function(l){d.addEventListener(l.toLowerCase(),function(g){h["handle"+l](g)},false)})},send:function(d){var h=this.req,l=this.opt,g=l.async;if(l.noCache)l.url+=(l.url.indexOf("?")>=0?"&":"?")+u.uid();h.open(l.method,l.url,g);if(g)h.onreadystatechange=function(){if(h.readyState==x.State.COMPLETED)if(h.status==200)l.onSuccess(h.responseText);
else l.onError(h.status)};l.sendAsBinary?h.sendAsBinary(d||l.body||null):h.send(d||l.body||null);if(!g)if(h.status==200)l.onSuccess(h.responseText);else l.onError(h.status)},setRequestHeader:function(d,h){this.req.setRequestHeader(d,h);return this},handleProgress:function(d){if(d.lengthComputable)this.opt.onProgress(d,Math.round(d.loaded/d.total*100));else this.opt.onProgress(d,-1)},handleError:function(d){this.opt.onError(d)},handleAbort:function(){this.opt.onAbort(e)},handleLoad:function(d){this.opt.onComplete(d)}};
x.Group=function(d){function h(m){return function(o){--c;d.onError(o,m);if(!c)d.onComplete(n)}}function l(m){return function(o){--c;n[m]=o;d.onSuccess(o,m);if(!c)d.onComplete(n)}}d=u.merge({urls:[],onError:u.empty,onSuccess:u.empty,onComplete:u.empty,method:"GET",async:true,noCache:false,sendAsBinary:false},d||{});var g=u.splat(d.urls),c=g.length,n=Array(c);this.reqs=g.map(function(m,o){return new x({url:m,method:d.method,async:d.async,noCache:d.noCache,sendAsBinary:d.sendAsBinary,body:d.body,onError:h(o),
onSuccess:l(o)})})};x.Group.prototype={send:function(){for(var d=0,h=this.reqs,l=h.length;d<l;++d)h[d].send()}};var i=function(d){d=u.merge({url:"http://octantjs.org/",data:{},noCache:false,onComplete:u.empty,callbackKey:"callback"},d||{});var h=i.counter++,l=[],g;for(g in d.data)l.push(g+"="+d.data[g]);l=l.join("&");if(d.noCache)l+=(l.indexOf("?")>=0?"&":"?")+u.uid();l=d.url+(d.url.indexOf("?")>-1?"&":"?")+d.callbackKey+"=Octant.IO.JSONP.requests.request_"+h+(l.length>0?"&"+l:"");var c=document.createElement("script");
c.type="text/javascript";c.src=l;i.requests["request_"+h]=function(n){d.onComplete(n);c.parentNode&&c.parentNode.removeChild(c);c.clearAttributes&&c.clearAttributes()};document.getElementsByTagName("head")[0].appendChild(c)};i.counter=0;i.requests={};var j=function(d){d=u.merge({src:[],noCache:false,onProgress:u.empty,onComplete:u.empty},d||{});var h=0,l=d.src.length,g=function(){d.onProgress(Math.round(++h/l*100));if(h==l)d.onComplete(o)},c=function(){if(++h==l)d.onComplete(o)},n=d.noCache,m=u.uid(),
o=d.src.map(function(s,B){var t=new Image;t.index=B;t.onload=g;t.onerror=c;t.src=s+(n?(s.indexOf("?")>=0?"&":"?")+m:"");return t});return o};z.XHR=x;z.JSONP=i;z.Images=j;z.Textures=function(d){d=u.merge({src:[],noCache:false,onComplete:u.empty},d||{});j({src:d.src,noCache:d.noCache,onComplete:function(h){var l={};h.forEach(function(g,c){l[d.src[c]]=u.merge({data:{value:g}},d)});T.setTextures(l);d.onComplete()}})};Octant.IO=z})();(function(){var z=Octant.Vec3,x=Octant.Mat4,i=function(j,d,h,l,g){g=
g||{};var c=g.position,n=g.target;g=g.up;this.fov=j;this.near=h;this.far=l;this.aspect=d;this.position=c&&new z(c.x,c.y,c.z)||new z;this.target=n&&new z(n.x,n.y,n.z)||new z;this.up=g&&new z(g.x,g.y,g.z)||new z(0,1,0);this.projection=(new x).perspective(j,d,h,l);this.view=new x};i.prototype={update:function(){this.projection=(new x).perspective(this.fov,this.aspect,this.near,this.far);this.view.lookAt(this.position,this.target,this.up)}};Octant.Camera=i})();(function(){function z(c,n){if(c&&c.length<
n){for(var m=c[0],o=c[1],s=c[2],B=c[3],t=[m,o,s,B],w=n/c.length,a;--w;){a=w*4;t[a]=m;t[a+1]=o;t[a+2]=s;t[a+3]=B}return new Float32Array(t)}else return c}var x=Octant.Vec3,i=Octant.Mat4,j=Math.cos,d=Math.sin,h=Math.PI,l=Array.prototype.slice,g={};g.Model=function(c){c=c||{};this.id=c.id||u.uid();this.pickable=!!c.pickable;this.pick=c.pick||function(){return false};if(c.pickingColors)this.pickingColors=c.pickingColors;this.vertices=c.vertices;this.normals=c.normals;this.textures=c.textures&&u.splat(c.textures);
this.colors=c.colors;this.indices=c.indices;this.shininess=c.shininess||0;this.reflection=c.reflection||0;this.refraction=c.refraction||0;if(c.texCoords)this.texCoords=c.texCoords;this.uniforms=c.uniforms||{};this.attributes=c.attributes||{};this.render=c.render;this.drawType=c.drawType||"TRIANGLES";this.display="display"in c?c.display:true;this.onBeforeRender=c.onBeforeRender||u.empty;this.onAfterRender=c.onAfterRender||u.empty;if(c.program)this.program=c.program;this.position=new x;this.rotation=
new x;this.scale=new x(1,1,1);this.matrix=new i;c.computeCentroids&&this.computeCentroids();c.computeNormals&&this.computeNormals()};g.Model.prototype=Object.create(null,{vertices:{set:function(c){if(c){var n=c.length;if(c.BYTES_PER_ELEMENT)this.$vertices=c;else if(this.$verticesLength==n)this.$vertices.set(c);else this.$vertices=new Float32Array(c);this.$verticesLength=n}},get:function(){return this.$vertices}},normals:{set:function(c){if(c){var n=c.length;if(c.BYTES_PER_ELEMENT)this.$normals=c;
else if(this.$normalsLength==n)this.$normals.set(c);else this.$normals=new Float32Array(c);this.$normalsLength=n}},get:function(){return this.$normals}},colors:{set:function(c){if(c){var n=c.length;if(c.BYTES_PER_ELEMENT)this.$colors=c;else if(this.$colorsLength==n)this.$colors.set(c);else this.$colors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=n)this.$colors=z(l.call(this.$colors),this.$verticesLength/3*4);this.$colorsLength=this.$colors.length}},get:function(){return this.$colors}},
pickingColors:{set:function(c){if(c){var n=c.length;if(c.BYTES_PER_ELEMENT)this.$pickingColors=c;else if(this.$pickingColorsLength==n)this.$pickingColors.set(c);else this.$pickingColors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=n)this.$pickingColors=z(l.call(this.$pickingColors),this.$verticesLength/3*4);this.$pickingColorsLength=this.$pickingColors.length}},get:function(){return this.$pickingColors}},texCoords:{set:function(c){if(c)if(u.type(c)=="object"){var n={},m;for(m in c){var o=
c[m];n[m]=o.BYTES_PER_ELEMENT?o:new Float32Array(o)}this.$texCoords=n}else{n=c.length;if(c.BYTES_PER_ELEMENT)this.$texCoords=c;else if(this.$texCoordsLength==n)this.$texCoords.set(c);else this.$texCoords=new Float32Array(c);this.$texCoordsLength=n}},get:function(){return this.$texCoords}},indices:{set:function(c){if(c){var n=c.length;if(c.BYTES_PER_ELEMENT)this.$indices=c;else if(this.$indicesLength==n)this.$indices.set(c);else this.$indices=new Uint16Array(c);this.$indicesLength=n}},get:function(){return this.$indices}}});
u.extend(g.Model.prototype,{$$family:"model",update:function(){var c=this.matrix,n=this.position,m=this.rotation,o=this.scale;c.id();c.$translate(n.x,n.y,n.z);c.$rotateXYZ(m.x,m.y,m.z);c.$scale(o.x,o.y,o.z)},computeCentroids:function(){var c=this.vertices,n=[];this.faces.forEach(function(m){var o=[0,0,0],s=0;m.forEach(function(B){B=c[B];o[0]+=B[0];o[1]+=B[1];o[2]+=B[2];s++});o[0]/=s;o[1]/=s;o[2]/=s;n.push(o)});this.centroids=n},computeNormals:function(){var c=this.vertices,n=[];this.faces.forEach(function(m){var o=
c[m[0]],s=c[m[1]];m=c[m[2]];o={x:o[0]-s[0],y:o[1]-s[1],z:o[2]-s[2]};x.$cross(o,{x:m[0]-s[0],y:m[1]-s[1],z:m[1]-s[2]});x.norm(o)>1.0E-6&&x.unit(o);n.push([o.x,o.y,o.z])});this.normals=n}});u.extend(g.Model.prototype,{setUniforms:function(c){c.setUniforms(this.uniforms)},setAttributes:function(c){var n=this.attributes,m;for(m in n){var o=n[m],s=this.id+"-"+m;if(Object.keys(o).length){o.attribute=m;c.setBuffer(s,o);delete o.value}else c.setBuffer(s,true)}},unsetAttributes:function(c){var n=this.attributes,
m;for(m in n)c.setBuffer(this.id+"-"+m,false)},setShininess:function(c){c.setUniform("shininess",this.shininess||0)},setReflection:function(c){this.reflection||this.refraction?c.setUniforms({useReflection:true,refraction:this.refraction,reflection:this.reflection,combine:0}):c.setUniform("useReflection",false)},setVertices:function(c,n){if(this.vertices)n||this.dynamic?c.setBuffer("vertices-"+this.id,{attribute:"position",value:this.vertices,size:3}):c.setBuffer("vertices-"+this.id)},unsetVertices:function(c){c.setBuffer("vertices-"+
this.id,false)},setNormals:function(c,n){if(this.normals)n||this.dynamic?c.setBuffer("normals-"+this.id,{attribute:"normal",value:this.normals,size:3}):c.setBuffer("normals-"+this.id)},unsetNormals:function(c){c.setBuffer("normals-"+this.id,false)},setIndices:function(c,n){if(this.indices)n||this.dynamic?c.setBuffer("indices-"+this.id,{bufferType:p.ELEMENT_ARRAY_BUFFER,drawType:p.STATIC_DRAW,value:this.indices,size:1}):c.setBuffer("indices-"+this.id)},unsetIndices:function(c){c.setBuffer("indices-"+
this.id,false)},setPickingColors:function(c,n){if(this.pickingColors)n||this.dynamic?c.setBuffer("pickingColors-"+this.id,{attribute:"pickingColor",value:this.pickingColors,size:4}):c.setBuffer("pickingColors-"+this.id)},unsetPickingColors:function(c){c.setBuffer("pickingColors-"+this.id,false)},setColors:function(c,n){if(this.colors)n||this.dynamic?c.setBuffer("colors-"+this.id,{attribute:"color",value:this.colors,size:4}):c.setBuffer("colors-"+this.id)},unsetColors:function(c){c.setBuffer("colors-"+
this.id,false)},setTexCoords:function(c,n){if(this.texCoords){var m=this.id;if(n||this.dynamic)u.type(this.texCoords)=="object"?this.textures.forEach(function(o,s){c.setBuffer("texCoords-"+s+"-"+m,{attribute:"texCoord"+(s+1),value:this.texCoords[o],size:2})}):c.setBuffer("texCoords-"+m,{attribute:"texCoord1",value:this.texCoords,size:2});else u.type(this.texCoords)=="object"?this.textures.forEach(function(o,s){c.setBuffer("texCoords-"+s+"-"+m)}):c.setBuffer("texCoords-"+m)}},unsetTexCoords:function(c){c.setBuffer("texCoords-"+
this.id,false)},setTextures:function(c){this.textures=this.textures?u.splat(this.textures):[];for(var n=0,m=this.textures,o=m.length,s=Octant.Scene.MAX_TEXTURES;n<s;n++){if(n<o)if(T.textureMemo[m[n]].isCube){c.setUniform("hasTextureCube"+(n+1),true);c.setTexture(m[n],p["TEXTURE"+(n+5)])}else{c.setUniform("hasTexture"+(n+1),true);c.setTexture(m[n],p["TEXTURE"+n])}else{c.setUniform("hasTextureCube"+(n+1),false);c.setUniform("hasTexture"+(n+1),false)}c.setUniform("sampler"+(n+1),n);c.setUniform("samplerCube"+
(n+1),n+5)}}});g.Cube=function(c){g.Model.call(this,u.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,
0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c||{}))};g.Cube.prototype=Object.create(g.Model.prototype);g.Sphere=function(c){var n=c.nlat||10,m=c.nlong||10,o=c.radius||1,s=h-0,B=2*h-0,t=(n+1)*(m+1),w=new Float32Array(t*3),a=new Float32Array(t*3);t=new Float32Array(t*2);var b=new Uint16Array(n*m*6);if(typeof o=="number"){var f=o;o=function(){return f}}for(var k=0;k<=n;k++)for(var q=0;q<=m;q++){var r=q/m,v=k/n,y=B*
r,A=s*v,C=d(y);y=j(y);var D=d(A),E=j(A);A=y*D;y=E;C*=D;D=o(A,y,C,r,v);E=q+k*(m+1);var G=E*3;E*=2;w[G+0]=D*A;w[G+1]=D*y;w[G+2]=D*C;a[G+0]=A;a[G+1]=y;a[G+2]=C;t[E+0]=r;t[E+1]=v}o=n+1;for(q=0;q<n;q++)for(k=0;k<m;k++){E=(q*m+k)*6;b[E+0]=k*o+q;b[E+1]=k*o+q+1;b[E+2]=(k+1)*o+q;b[E+3]=(k+1)*o+q;b[E+4]=k*o+q+1;b[E+5]=(k+1)*o+q+1}g.Model.call(this,u.extend({vertices:w,indices:b,normals:a,texCoords:t},c||{}))};g.Sphere.prototype=Object.create(g.Model.prototype);g.IcoSphere=function(c){var n=c.iterations||0,
m=[],o=[],s=Math.sqrt,B=Math.acos,t=Math.atan2,w=Math.PI,a=w*2;c.onAddVertex=c.onAddVertex||u.empty;var b=(1+s(5))/2,f=s(1+b*b);m.push(-1/f,b/f,0,1/f,b/f,0,-1/f,-b/f,0,1/f,-b/f,0,0,-1/f,b/f,0,1/f,b/f,0,-1/f,-b/f,0,1/f,-b/f,b/f,0,-1/f,b/f,0,1/f,-b/f,0,-1/f,-b/f,0,1/f);o.push(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1);var k=function(){var W={};return function(R,S){R*=3;S*=3;var X=(R<S?R:S)+"|"+(R>S?R:S);if(X in W)return W[X];
var N=(m[R]+m[S])/2,Y=(m[R+1]+m[S+1])/2,Z=(m[R+2]+m[S+2])/2,$=s(N*N+Y*Y+Z*Z);N/=$;Y/=$;Z/=$;m.push(N,Y,Z);return W[X]=m.length/3-1}}();for(b=0;b<n;b++){var q=[],r=0;for(f=o.length;r<f;r+=3){var v=k(o[r],o[r+1]),y=k(o[r+1],o[r+2]),A=k(o[r+2],o[r]);q.push(o[r],v,A,o[r+1],y,v,o[r+2],A,y,v,y,A)}o=q}f=o.length;n=new Float32Array(f*3);k=new Float32Array(f*2);for(b=0;b<f;b+=3){y=o[b];A=o[b+1];var C=o[b+2];q=y*3;r=A*3;v=C*3;y*=2;A*=2;C*=2;var D=m[q],E=m[q+1],G=m[q+2],I=B(G/s(D*D+E*E+G*G)),J=t(E,D);I/=w;J=
1-J/a;var H=m[r],F=m[r+1],M=m[r+2],K=B(M/s(H*H+F*F+M*M)),L=t(F,H);K/=w;L=1-L/a;var O=m[v],P=m[v+1],Q=m[v+2],U=B(Q/s(O*O+P*P+Q*Q)),V=t(P,O);U/=w;V=1-V/a;D=x.cross({x:O-H,y:P-F,z:Q-M},{x:D-H,y:E-F,z:G-M}).$unit();n[q]=n[r]=n[v]=D.x;n[q+1]=n[r+1]=n[v+1]=D.y;n[q+2]=n[r+2]=n[v+2]=D.z;k[y]=J;k[y+1]=I;k[A]=L;k[A+1]=K;k[C]=V;k[C+1]=U}g.Model.call(this,u.extend({vertices:m,indices:o,normals:n,texCoords:k},c||{}))};g.IcoSphere.prototype=Object.create(g.Model.prototype);g.TruncatedCone=function(c){var n=c.bottomRadius||
0,m=c.topRadius||0,o=c.height||1,s=c.nradial||10,B=c.nvertical||10,t=!!c.topCap,w=!!c.bottomCap,a=(t?2:0)+(w?2:0),b=(s+1)*(B+1+a),f=new Float32Array(b*3),k=new Float32Array(b*3);b=new Float32Array(b*2);var q=new Uint16Array(s*(B+a)*6),r=s+1,v=Math,y=v.atan2(n-m,o),A=v.sin,C=v.cos;v=v.PI;var D=C(y);y=A(y);w=B+(w?2:0);var E=0,G=0;for(t=t?-2:0;t<=w;t++){var I=t/B,J=o*I,H;if(t<0){J=0;I=1;H=n}else if(t>B){J=o;I=1;H=m}else H=n+(m-n)*(t/B);if(t==-2||t==B+2)I=H=0;J-=o/2;for(var F=0;F<r;F++){var M=A(F*v*2/
s),K=C(F*v*2/s);f[E+0]=M*H;f[E+1]=J;f[E+2]=K*H;k[E+0]=t<0||t>B?0:M*D;k[E+1]=t<0?-1:t>B?1:y;k[E+2]=t<0||t>B?0:K*D;b[G+0]=F/s;b[G+1]=I;G+=2;E+=3}}for(t=0;t<B+a;t++)for(F=0;F<s;F++){n=(t*s+F)*6;q[n+0]=r*(t+0)+0+F;q[n+1]=r*(t+0)+1+F;q[n+2]=r*(t+1)+1+F;q[n+3]=r*(t+0)+0+F;q[n+4]=r*(t+1)+1+F;q[n+5]=r*(t+1)+0+F}g.Model.call(this,u.extend({vertices:f,normals:k,texCoords:b,indices:q},c||{}))};g.TruncatedCone.prototype=Object.create(g.Model.prototype);g.Cone=function(c){c.topRadius=0;c.topCap=!!c.cap;c.bottomCap=
!!c.cap;c.bottomRadius=c.radius||3;g.TruncatedCone.call(this,c)};g.Cone.prototype=Object.create(g.TruncatedCone.prototype);g.Cylinder=function(c){c.bottomRadius=c.radius;c.topRadius=c.radius;g.TruncatedCone.call(this,c)};g.Cylinder.prototype=Object.create(g.TruncatedCone.prototype);g.Plane=function(c){var n=c.type,m=n.split(","),o=c[m[0]+"len"],s=c[m[1]+"len"],B=c["n"+m[0]]||1;m=c["n"+m[1]]||1;var t=c.offset;numVertices=(B+1)*(m+1);positions=new Float32Array(numVertices*3);normals=new Float32Array(numVertices*
3);texCoords=new Float32Array(numVertices*2);for(var w=i3=i2=0;w<=m;w++)for(var a=0;a<=B;a++){var b=a/B,f=w/m;texCoords[i2+0]=b;texCoords[i2+1]=f;i2+=2;switch(n){case "x,y":positions[i3+0]=o*b-o*0.5;positions[i3+1]=s*f-s*0.5;positions[i3+2]=t;normals[i3+0]=0;normals[i3+1]=0;normals[i3+2]=1;break;case "x,z":positions[i3+0]=o*b-o*0.5;positions[i3+1]=t;positions[i3+2]=s*f-s*0.5;normals[i3+0]=0;normals[i3+1]=1;normals[i3+2]=0;break;case "y,z":positions[i3+0]=t;positions[i3+1]=o*b-o*0.5;positions[i3+2]=
s*f-s*0.5;normals[i3+0]=1;normals[i3+1]=0;normals[i3+2]=0}i3+=3}n=B+1;o=[];for(w=0;w<m;w++)for(a=0;a<B;a++){s=(w*B+a)*6;o[s+0]=(w+0)*n+a;o[s+1]=(w+1)*n+a;o[s+2]=(w+0)*n+a+1;o[s+3]=(w+1)*n+a;o[s+4]=(w+1)*n+a+1;o[s+5]=(w+0)*n+a+1}g.Model.call(this,u.extend({vertices:positions,normals:normals,texCoords:texCoords,indices:o},c))};g.Plane.prototype=Object.create(g.Model.prototype);g.id=u.time();Octant.O3D=g})();(function(){var z={Vertex:{},Fragment:{}},x=z.Fragment;z.Vertex.Default="#define LIGHT_MAX 40\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec4 pickingColor;\nattribute vec2 texCoord1;\nuniform mat4 viewMatrix;\nuniform mat4 viewInverseMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform mat4 worldInverseMatrix;\nuniform mat4 worldInverseTransposeMatrix;\nuniform mat4 objectMatrix;\nuniform vec3 cameraPosition;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nuniform float refraction;\nuniform bool useReflection;\nvarying vec3 vReflection;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = viewMatrix * vec4(position, 1.0);\nvec4 transformedNormal = worldInverseTransposeMatrix* vec4(normal, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((worldMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nif (useReflection) {\nif (refraction > 0.0) {\nvReflection = refract(normalize(mvPosition.xyz - cameraPosition), transformedNormal.xyz, refraction);\n} else {\nvReflection = reflect(normalize(mvPosition.xyz - cameraPosition), transformedNormal.xyz);\n}\n} else {\nvReflection = normalize(vec3(1.0, 1.0, 1.0));\n}\nvColor = color;\nvPickingColor = pickingColor;\nvTexCoord = texCoord1;\ngl_Position = projectionMatrix * viewMatrix * vec4(position, 1.0);\n}";
x.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvarying vec3 vReflection;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool hasTextureCube1;\nuniform samplerCube samplerCube1;\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\nuniform float reflection;\nuniform int combine;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif (!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif (hasTextureCube1) {\nvec4 cubeColor = textureCube(samplerCube1, normalize(vec3(-vReflection.x, vReflection.yz)));\nif (true || combine == 1) {\ngl_FragColor = vec4(mix(gl_FragColor.xyz, cubeColor.xyz, reflection), 1.0);\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n}\nif (enablePicking) {\nif (hasPickingColors) {\ngl_FragColor = vPickingColor;\n} else {\ngl_FragColor = vec4(pickColor, 1.0);\n}\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
Octant.Shaders=z})();(function(){var z=Octant.Vec3,x=function(i,j,d){d=u.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},d||{});this.program=d.program?i[d.program]:i;this.camera=j;this.models=[];this.config=d};x.prototype={add:function(){for(var i=0,j=this.models,d=arguments.length;i<d;i++){var h=arguments[i];h.id=h.id||u.uid();j.push(h);this.defineBuffers(h)}},remove:function(i){var j=this.models;i=j.indexOf(i);
i>-1&&j.splice(i,1)},getProgram:function(i){var j=this.program;if(j.$$family!="program"&&i&&i.program){j=j[i.program];j.use()}return j},defineBuffers:function(i){var j=this.getProgram(i);i.setAttributes(j,true);i.setVertices(j,true);i.setColors(j,true);i.setPickingColors(j,true);i.setNormals(j,true);i.setTexCoords(j,true);i.setIndices(j,true)},beforeRender:function(i){this.setupLighting(i);this.setupEffects(i);var j=this.camera,d=j.position,h=j.view;j=j.projection;i.setUniforms({cameraPosition:[d.x,
d.y,d.z],projectionMatrix:j,viewMatrix:h,viewProjectionMatrix:h.mulMat4(j),viewInverseMatrix:h.invert()})},setupLighting:function(i){var j=this.config.lights,d=j.ambient,h=j.directional,l=h.color,g=h.direction,c=j.enable;j=j.points&&u.splat(j.points)||[];h=j.length;var n=[],m=[],o=[],s=[];g=z.unit([g.x,g.y,g.z]).$scale(-1);i.setUniform("enableLights",c);if(c){i.setUniform("ambientColor",[d.r,d.g,d.b]);i.setUniform("directionalColor",[l.r,l.g,l.b]);i.setUniform("lightingDirection",[g.x,g.y,g.z]);i.setUniform("numberPoints",
h);for(d=0;d<h;d++){c=j[d];l=c.position;g=c.color||c.diffuse;c=c.specular;n.push(l.x,l.y,l.z);m.push(g.r,g.g,g.b);o.push(+!!c);c?s.push(c.r,c.g,c.b):s.push(0,0,0)}i.setUniforms({pointLocation:n,pointColor:m});i.setUniforms({enableSpecular:o,pointSpecularColor:s})}},setupEffects:function(i){var j=this.config.effects.fog,d=j.color||{r:0.5,g:0.5,b:0.5};j?i.setUniforms({hasFog:true,fogNear:j.near,fogFar:j.far,fogColor:[d.r,d.g,d.b]}):i.setUniform("hasFog",false)},render:function(i){i=i||{};var j=this.camera,
d=this.program,h=i.renderProgram,l=u.type(d);l=!h&&l=="object";i=u.merge({onBeforeRender:u.empty,onAfterRender:u.empty},i||{});!l&&this.beforeRender(h||d);for(var g=0,c=this.models,n=c.length;g<n;++g){var m=c[g];if(m.display){d=h||this.getProgram(m);l&&this.beforeRender(d);m.onBeforeRender(d,j);i.onBeforeRender(m,g);this.renderObject(m,d);i.onAfterRender(m,g);m.onAfterRender(d,j)}}},renderToTexture:function(i,j){j=j||{};var d=T.textures[i+"-texture"],h=T.textureMemo[i+"-texture"];this.render(j);p.bindTexture(h.textureType,
d);p.generateMipmap(h.textureType);p.bindTexture(h.textureType,null)},renderObject:function(i,j){var d=this.camera,h=i.matrix,l=d.view.mulMat4(h),g=l.invert(),c=g.transpose();i.setUniforms(j);i.setAttributes(j);i.setShininess(j);i.setReflection(j);i.setVertices(j);i.setColors(j);i.setPickingColors(j);i.setNormals(j);i.setTextures(j);i.setTexCoords(j);i.setIndices(j);j.setUniforms({objectMatrix:h,worldMatrix:l,worldInverseMatrix:g,worldInverseTransposeMatrix:c});if(i.render)i.render(p,j,d);else i.indices?
p.drawElements(i.drawType!==undefined?p.get(i.drawType):p.TRIANGLES,i.indices.length,p.UNSIGNED_SHORT,0):p.drawArrays(i.drawType!==undefined?p.get(i.drawType):p.TRIANGLES,0,i.vertices.length/3);i.unsetAttributes(j);i.unsetVertices(j);i.unsetColors(j);i.unsetPickingColors(j);i.unsetNormals(j);i.unsetTexCoords(j);i.unsetIndices(j)},setupPicking:function(){var i=Octant.Program.fromDefaultShaders();T.setFrameBuffer("$picking",{width:1,height:1,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},
{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:true});T.setFrameBuffer("$picking",false);this.pickingProgram=i},pick:function(i,j){this.pickingProgram||this.setupPicking();var d={},h=[],l=T.usedProgram,g=this.pickingProgram,c=this.config,n=c.lights.enable,m=c.effects.fog,o=p.canvas.width,s=p.canvas.height,B=[],t=new Uint8Array(4),w=0,a;c.lights.enable=false;c.effects.fog=false;g.use();T.setFrameBuffer("$picking",true);g.setUniform("enablePicking",true);p.disable(p.BLEND);
p.viewport(-i,j-s,o,s);p.clear(p.COLOR_BUFFER_BIT|p.DEPTH_BUFFER_BIT);p.readPixels(0,0,1,1,p.RGBA,p.UNSIGNED_BYTE,t);a=t[0]+t[1]*256+t[2]*65536;this.renderToTexture("$picking",{renderProgram:g,onBeforeRender:function(k,q){if(q==a)w=1;var r=q+w,v=!!k.pickingColors;g.setUniform("hasPickingColors",v);if(v)h.push(k);else{B[0]=r%256;B[1]=(r/256>>0)%256;B[2]=(r/65536>>0)%256;g.setUniform("pickColor",[B[0]/255,B[1]/255,B[2]/255]);d[B.join()]=k}}});p.readPixels(0,0,1,1,p.RGBA,p.UNSIGNED_BYTE,t);o=[t[0],t[1],
t[2]].join();o=d[o];if(!o)for(var b=0,f=h.length;b<f;b++){o=h[b];s=o.pick(t);if(s!==false)o.$pickingIndex=s;else o=false}T.setFrameBuffer("$picking",false);g.setUniform("enablePicking",false);c.lights.enable=n;c.effects.fog=m;l&&l.use();return o&&o.pickable&&o}};x.MAX_TEXTURES=3;x.MAX_POINT_LIGHTS=50;Octant.Scene=x})();(function(){function z(x,i){for(var j=this.workers=[];i--;)j.push(new Worker(x))}z.prototype={map:function(x){var i=this.workers,j=this.configs=[],d=0;for(i=i.length;d<i;d++)j.push(x&&
x(d));return this},reduce:function(x){for(var i=x.reduceFn,j=this.workers,d=this.configs,h=j.length,l=x.initialValue,g=function(o){h--;l=l===undefined?o.data:i(l,o.data);if(h==0)x.onComplete(l)},c=0,n=h;c<n;c++){var m=j[c];m.onmessage=g;m.postMessage(d[c])}return this}};Octant.WorkerGroup=z})();(function(){var z=function(d){this.opt=u.merge({duration:1E3,transition:function(h){return h},onCompute:u.empty,onComplete:u.empty},d||{})};z.prototype={timer:null,time:null,start:function(d){this.opt=u.merge(this.opt,
d||{});this.time=u.time();this.animating=true},step:function(){if(this.animating){var d=u.time(),h=this.time,l=this.opt;if(d<h+l.duration){d=l.transition((d-h)/l.duration);l.onCompute.call(this,d)}else{this.animating=false;l.onCompute.call(this,1);l.onComplete.call(this)}}}};z.compute=function(d,h,l){return d+(h-d)*l};z.Transition={linear:function(d){return d}};var x=z.Transition;(function(){var d=function(g,c){c=u.splat(c);return u.extend(g,{easeIn:function(n){return g(n,c)},easeOut:function(n){return 1-
g(1-n,c)},easeInOut:function(n){return n<=0.5?g(2*n,c)/2:(2-g(2*(1-n),c))/2}})},h={Pow:function(g,c){return Math.pow(g,c[0]||6)},Expo:function(g){return Math.pow(2,8*(g-1))},Circ:function(g){return 1-Math.sin(Math.acos(g))},Sine:function(g){return 1-Math.sin((1-g)*Math.PI/2)},Back:function(g,c){c=c[0]||1.618;return Math.pow(g,2)*((c+1)*g-c)},Bounce:function(g){for(var c,n=0,m=1;;n+=m,m/=2)if(g>=(7-4*n)/11){c=m*m-Math.pow((11-6*n-11*g)/4,2);break}return c},Elastic:function(g,c){return Math.pow(2,10*
--g)*Math.cos(20*g*Math.PI*(c[0]||1)/3)}},l;for(l in h)x[l]=d(h[l]);["Quad","Cubic","Quart","Quint"].forEach(function(g,c){x[g]=d(function(n){return Math.pow(n,[c+2])})})})();var i=self||window;if(i){var j=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(d){if(d in i){z.animationTime=function(){return i[d]};j=true}});if(!j)z.animationTime=u.time;j=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame",
"requestAnimationFrame"].forEach(function(d){if(d in i){z.requestAnimationFrame=function(h){i[d](function(){h()})};j=true}});if(!j)z.requestAnimationFrame=function(d){setTimeout(function(){d()},1E3/60)}}Octant.Fx=z})()})();
